import{d as be,l as Pe,b as y,w as ne,e as t,c as k,F as le,k as ie,n as R,t as S,g as $,f as Qe,y as kt,p as he,A as ds,q as Q,v as T,C as Ye,r as A,o as Et,E as vs,G as Se,H as G,s as b,u as ps,I as fs,i as ue,h as Xe,m as Me,z as Ct,T as hs}from"./index-BLIzrZqt.js";import{a as Oe,c as w,f as ms,e as _s}from"./modal-settings.vue_vue_type_script_setup_true_lang-DLND-TTd.js";const gs=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,Ds=/[\$\+<->\^`\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u0888\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2E50\u2E51\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uAB6A\uAB6B\uFB29\uFBB2-\uFBC2\uFD40-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD833[\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0\uDCB1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFCA]/;function Le(v){switch(v){case 9:case 32:return!0}return!1}function At(v){if(v>=8192&&v<=8202)return!0;switch(v){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function bt(v){return gs.test(v)||Ds.test(v)}function yt(v){switch(v){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function I(v,n,d){this.type=v,this.tag=n,this.attrs=null,this.map=null,this.nesting=d,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}I.prototype.attrIndex=function(n){if(!this.attrs)return-1;const d=this.attrs;for(let h=0,l=d.length;h<l;h++)if(d[h][0]===n)return h;return-1};I.prototype.attrPush=function(n){this.attrs?this.attrs.push(n):this.attrs=[n]};I.prototype.attrSet=function(n,d){const h=this.attrIndex(n),l=[n,d];h<0?this.attrPush(l):this.attrs[h]=l};I.prototype.attrGet=function(n){const d=this.attrIndex(n);let h=null;return d>=0&&(h=this.attrs[d][1]),h};I.prototype.attrJoin=function(n,d){const h=this.attrIndex(n);h<0?this.attrPush([n,d]):this.attrs[h][1]=this.attrs[h][1]+" "+d};function ws(v,n,d){this.src=v,this.env=d,this.tokens=[],this.inlineMode=!1,this.md=n}ws.prototype.Token=I;function W(v,n,d,h){this.src=v,this.md=n,this.env=d,this.tokens=h,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;const l=this.src;for(let m=0,a=0,p=0,f=0,r=l.length,D=!1;a<r;a++){const _=l.charCodeAt(a);if(!D)if(Le(_)){p++,_===9?f+=4-f%4:f++;continue}else D=!0;(_===10||a===r-1)&&(_!==10&&a++,this.bMarks.push(m),this.eMarks.push(a),this.tShift.push(p),this.sCount.push(f),this.bsCount.push(0),D=!1,p=0,f=0,m=a+1)}this.bMarks.push(l.length),this.eMarks.push(l.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}W.prototype.push=function(v,n,d){const h=new I(v,n,d);return h.block=!0,d<0&&this.level--,h.level=this.level,d>0&&this.level++,this.tokens.push(h),h};W.prototype.isEmpty=function(n){return this.bMarks[n]+this.tShift[n]>=this.eMarks[n]};W.prototype.skipEmptyLines=function(n){for(let d=this.lineMax;n<d&&!(this.bMarks[n]+this.tShift[n]<this.eMarks[n]);n++);return n};W.prototype.skipSpaces=function(n){for(let d=this.src.length;n<d;n++){const h=this.src.charCodeAt(n);if(!Le(h))break}return n};W.prototype.skipSpacesBack=function(n,d){if(n<=d)return n;for(;n>d;)if(!Le(this.src.charCodeAt(--n)))return n+1;return n};W.prototype.skipChars=function(n,d){for(let h=this.src.length;n<h&&this.src.charCodeAt(n)===d;n++);return n};W.prototype.skipCharsBack=function(n,d,h){if(n<=h)return n;for(;n>h;)if(d!==this.src.charCodeAt(--n))return n+1;return n};W.prototype.getLines=function(n,d,h,l){if(n>=d)return"";const m=new Array(d-n);for(let a=0,p=n;p<d;p++,a++){let f=0;const r=this.bMarks[p];let D=r,_;for(p+1<d||l?_=this.eMarks[p]+1:_=this.eMarks[p];D<_&&f<h;){const M=this.src.charCodeAt(D);if(Le(M))M===9?f+=4-(f+this.bsCount[p])%4:f++;else if(D-r<this.tShift[p])f++;else break;D++}f>h?m[a]=new Array(f-h+1).join(" ")+this.src.slice(D,_):m[a]=this.src.slice(D,_)}return m.join("")};W.prototype.Token=I;const Fs=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Cs="[a-zA-Z_:][a-zA-Z0-9:._-]*",As="[^\"'=<>`\\x00-\\x20]+",bs="'[^']*'",ys='"[^"]*"',ks="(?:"+As+"|"+bs+"|"+ys+")",Es="(?:\\s+"+Cs+"(?:\\s*=\\s*"+ks+")?)",xs="<[A-Za-z][A-Za-z0-9\\-]*"+Es+"*\\s*\\/?>",$s="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",qs=new RegExp("^(?:"+xs+"|"+$s+")");new RegExp("^</?("+Fs.join("|")+")(?=(\\s|/?>|$))","i"),new RegExp(qs.source+"\\s*$");function Ne(v,n,d,h){this.src=v,this.env=d,this.md=n,this.tokens=h,this.tokens_meta=Array(h.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}Ne.prototype.pushPending=function(){const v=new I("text","",0);return v.content=this.pending,v.level=this.pendingLevel,this.tokens.push(v),this.pending="",v};Ne.prototype.push=function(v,n,d){this.pending&&this.pushPending();const h=new I(v,n,d);let l=null;return d<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),h.level=this.level,d>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],l={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(h),this.tokens_meta.push(l),h};Ne.prototype.scanDelims=function(v,n){const d=this.posMax,h=this.src.charCodeAt(v),l=v>0?this.src.charCodeAt(v-1):32;let m=v;for(;m<d&&this.src.charCodeAt(m)===h;)m++;const a=m-v,p=m<d?this.src.charCodeAt(m):32,f=yt(l)||bt(String.fromCharCode(l)),r=yt(p)||bt(String.fromCharCode(p)),D=At(l),_=At(p),M=!_&&(!r||D||f),te=!D&&(!f||_||r);return{can_open:M&&(n||!te||f),can_close:te&&(n||!M||r),length:a}};Ne.prototype.Token=I;const xt=[];for(let v=0;v<256;v++)xt.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(v){xt[v.charCodeAt(0)]=1});const zs={class:"modal__question-overview-grid"},Bs=["data-index","onClick"],Ss=be({__name:"modal-question-overview",props:{show:{type:Boolean,required:!0},questions:{type:Array,required:!0},currentIndex:{type:Number,required:!0}},emits:["close","jump-to"],setup(v,{emit:n}){const d=v,h=n;function l(p){const f=p.userAnswer,r=p.answer;if(f==null||r===void 0||r===null)return!1;const D=typeof f=="string"?f.charCodeAt(0)-65:-1;return Array.isArray(r)?r.some(_=>_===D):typeof r=="number"?r===D:typeof r=="string"?r.toUpperCase()===f.toUpperCase():(console.warn("无法识别的答案格式:",r,"对比值:",f),!1)}function m(p,f){const r=[];return f===d.currentIndex&&r.push("modal__question-overview-item--current"),p.userAnswer!==null&&p.userAnswer!==void 0&&(r.push("modal__question-overview-item--answered"),l(p)?r.push("modal__question-overview-item--correct"):r.push("modal__question-overview-item--incorrect")),r}function a(p){h("jump-to",p),h("close")}return(p,f)=>(y(),Pe(Oe,{show:v.show,title:"题目总览","content-class":"modal__content--overview",onClose:f[0]||(f[0]=r=>p.$emit("close"))},{default:ne(()=>[t("div",zs,[(y(!0),k(le,null,ie(v.questions,(r,D)=>(y(),k("div",{key:r.id||D,class:R(["modal__question-overview-item",m(r,D)]),"data-index":D,onClick:_=>a(D)},S(r.id||r.number||D+1),11,Bs))),128))])]),_:1},8,["show"]))}}),Ms={class:"modal__statistics-results"},Qs={class:"modal__statistics-results-section"},Ps={class:"modal__statistics-results-card"},Os={class:"modal__statistics-results-score-display"},Ls={class:"modal__statistics-results-score-detail"},Ns=be({__name:"modal-statistics",props:{show:{type:Boolean,required:!0},stats:{type:Object,required:!0,default:()=>({totalQuestions:0,answeredCount:0,correctCount:0,wrongQuestionIds:[]})}},emits:["close","view-wrong","continue","back-home"],setup(v){const n=v,d=$(()=>n.stats.answeredCount>0?Math.round(n.stats.correctCount/n.stats.answeredCount*100):0),h=$(()=>`共${n.stats.totalQuestions}题，已答${n.stats.answeredCount}题，答对${n.stats.correctCount}题，正确率${d.value}%`),l=$(()=>n.stats.wrongQuestionIds.length>0);return(m,a)=>(y(),Pe(Oe,{show:v.show,title:"测验结果","content-class":"modal__content--statistics",onClose:a[3]||(a[3]=p=>m.$emit("close"))},{footer:ne(()=>[l.value?(y(),k("button",{key:0,onClick:a[0]||(a[0]=p=>m.$emit("view-wrong")),class:"modal__button modal__button--danger"},"查看错题")):Qe("",!0),t("button",{onClick:a[1]||(a[1]=p=>m.$emit("continue")),class:"modal__button modal__button--secondary"},"继续"),t("button",{onClick:a[2]||(a[2]=p=>m.$emit("back-home")),class:"modal__button modal__button--primary"},"返回主页")]),default:ne(()=>[t("div",Ms,[t("div",Qs,[a[4]||(a[4]=t("h3",{class:"modal__statistics-results-title"},"总分",-1)),t("div",Ps,[t("div",Os,S(d.value)+"分",1),t("div",Ls,S(h.value),1)])])])]),_:1},8,["show"]))}}),Gs={class:"modal__form-group"},Rs={class:"modal__form-group"},Ts={class:"modal__option-label"},Is={class:"modal__option-content"},Us=["onUpdate:modelValue"],js=["onClick","disabled"],Vs={class:"modal__form-group"},Hs=["value"],Ws={class:"modal__form-group"},Js=be({__name:"modal-question-edit",props:{show:{type:Boolean},question:{}},emits:["close","save"],setup(v,{emit:n}){const d=v,h=n,l=kt({title:"",options:["",""],answer:"A",notes:"",question:""});he(()=>d.question,f=>{if(f){const r=JSON.parse(JSON.stringify(f));typeof r.answer!="string"&&(typeof r.answer=="number"?r.answer=String.fromCharCode(65+r.answer):r.answer="A"),Object.assign(l,r)}},{immediate:!0,deep:!0});function m(){l.options.push("")}function a(f){if(l.options.length>2)if(l.options.splice(f,1),typeof l.answer=="string"){const r=l.answer.charCodeAt(0)-65;(r===f||r>=l.options.length)&&(l.answer="A")}else l.answer="A"}function p(){const f=JSON.parse(JSON.stringify(l));h("save",f)}return(f,r)=>(y(),Pe(Oe,{show:f.show,title:"编辑题目","content-class":"modal__content--edit-question",onClose:r[4]||(r[4]=D=>f.$emit("close"))},{footer:ne(()=>[t("button",{onClick:r[3]||(r[3]=D=>f.$emit("close")),class:"modal__button modal__button--secondary"},"取消"),t("button",{onClick:p,class:"modal__button modal__button--primary"},"保存")]),default:ne(()=>[t("form",{onSubmit:ds(p,["prevent"])},[t("div",Gs,[r[5]||(r[5]=t("label",{for:"question",class:"modal__form-label"},"题目内容",-1)),Q(t("textarea",{id:"question","onUpdate:modelValue":r[0]||(r[0]=D=>l.question=D),class:"modal__form-control",rows:"3",required:""},null,512),[[T,l.question]])]),t("div",Rs,[r[6]||(r[6]=t("label",{class:"modal__form-label"},"选项",-1)),(y(!0),k(le,null,ie(l.options,(D,_)=>(y(),k("div",{key:_,class:"modal__option-row"},[t("div",Ts,S(String.fromCharCode(65+_))+". ",1),t("div",Is,[Q(t("input",{type:"text","onUpdate:modelValue":M=>l.options[_]=M,class:"modal__form-control",required:""},null,8,Us),[[T,l.options[_]]])]),t("button",{type:"button",class:"modal__option-delete",onClick:M=>a(_),disabled:l.options.length<=2},"×",8,js)]))),128)),t("button",{type:"button",class:"modal__add-option-btn",onClick:m},"+ 添加选项")]),t("div",Vs,[r[7]||(r[7]=t("label",{for:"answer",class:"modal__form-label"},"正确答案",-1)),Q(t("select",{id:"answer","onUpdate:modelValue":r[1]||(r[1]=D=>l.answer=D),class:"modal__form-control",required:""},[(y(!0),k(le,null,ie(l.options,(D,_)=>(y(),k("option",{key:_,value:String.fromCharCode(65+_)},S(String.fromCharCode(65+_)),9,Hs))),128))],512),[[Ye,l.answer]])]),t("div",Ws,[r[8]||(r[8]=t("label",{for:"notes",class:"modal__form-label"},"笔记内容 (Markdown)",-1)),Q(t("textarea",{id:"notes","onUpdate:modelValue":r[2]||(r[2]=D=>l.notes=D),class:"modal__form-control",rows:"5"},null,512),[[T,l.notes]])])],32)]),_:1},8,["show"]))}}),Zs={class:"modal__form-group modal__form-group--preset"},Xs={class:"modal__preset-controls"},Ys=["value"],Ks=["disabled"],eo=["disabled"],to={class:"modal__form-group modal__form-group--switch"},so={class:"modal__toggle-switch"},oo={class:"modal__form-group"},uo={class:"modal__form-group"},no={class:"modal__form-group"},lo={class:"modal__form-group modal__form-group--switch"},io={class:"modal__toggle-switch"},ao={class:"modal__form-group modal__form-group--switch"},ro={class:"modal__toggle-switch"},co={class:"modal__form-group modal__form-group--switch"},vo={class:"modal__toggle-switch"},po={class:"modal__form-group"},fo={class:"modal__form-group"},ho={class:"modal__form-input-group"},mo={class:"modal__form-group"},_o={class:"modal__form-group"},go={class:"modal__form-input-group"},Do={key:0,class:"modal__prompt-presets-container"},wo={class:"modal__prompt-presets"},Fo={key:0,class:"modal__prompt-presets-list"},Co=["onClick"],Ao={class:"modal__prompt-preset-name"},bo={class:"modal__prompt-preset-desc"},yo={key:1,class:"modal__prompt-presets-empty"},ko={class:"modal__footer-buttons"},Eo=be({__name:"modal-api-config",props:{show:{type:Boolean}},emits:["close"],setup(v,{emit:n}){const d=v,h=n,l=A([]),m=A(""),a=A({enabled:!1,autoGenerate:!1,streamOutput:!0,autoSync:!1,apiUrl:"",apiKey:"",model:"",systemPrompt:"",temperature:.7,maxTokens:2e3,topP:1}),p=A([]),f=A(!1),r=()=>{l.value=w.getApiPresets(),m.value=w.getActiveApiPresetName(),D(m.value)},D=C=>{const u=l.value.find(x=>x.name===C);if(u){const{name:x,...O}=u;a.value={...O}}else{console.warn(`Preset "${C}" not found when updating local config.`);const x=l.value[0];if(x){const{name:O,...F}=x;a.value={...F},m.value=x.name}else a.value=w.getApiConfig()}},_=()=>{r()};Et(()=>{r(),w.addListener("api",_)}),vs(()=>{w.removeListener("api",_)}),he(()=>d.show,C=>{C&&r()}),he(m,C=>{D(C)});const M=()=>{m.value&&w.setActiveApiPreset(m.value)},te=()=>{const C=prompt("请输入新预设的名称:",`预设 ${l.value.length+1}`);C&&w.addApiPreset(C,m.value)&&G(()=>{m.value=C,w.setActiveApiPreset(C)})},N=()=>{const C=m.value;if(!C)return;const u=prompt(`重命名预设 "${C}" 为:`,C);u&&u!==C&&w.renameApiPreset(C,u)&&G(()=>{r()})},P=()=>{const C=m.value;if(C){if(l.value.length<=1){b("无法删除最后一个预设","warning");return}confirm(`确定要删除预设 "${C}" 吗？`)&&w.deleteApiPreset(C)}};function J(){w.updateApiConfig(a.value),h("close")}const Z=async()=>{if(f.value){f.value=!1;return}try{const C=await fetch("/prompts/index.json");C.ok?(p.value=await C.json(),f.value=!0,G(()=>{const u=x=>{const O=document.querySelector(".modal__prompt-presets"),F=document.querySelector(".modal__button--reset");O&&F&&!O.contains(x.target)&&!F.contains(x.target)&&(f.value=!1,document.removeEventListener("click",u))};setTimeout(()=>{document.addEventListener("click",u)},100)})):b("加载提示词预设列表失败","error")}catch(C){console.error("加载提示词预设列表出错:",C),b("加载提示词预设列表出错","error")}},ae=()=>{a.value.systemPrompt=""},re=()=>{f.value=!1},X=async C=>{try{const u=await fetch(`/prompts/${C.path}`);if(u.ok){const x=await u.json();x.system_prompt?(a.value.systemPrompt=x.system_prompt,x.temperature!==void 0&&(a.value.temperature=x.temperature),x.top_p!==void 0&&(a.value.topP=x.top_p),b(`已加载"${C.name}"提示词预设`,"success")):b("提示词预设格式无效","warning")}else b(`加载"${C.name}"提示词预设失败`,"error")}catch(u){console.error(`加载"${C.name}"提示词预设出错:`,u),b(`加载"${C.name}"提示词预设出错`,"error")}finally{f.value=!1}};return(C,u)=>(y(),Pe(Oe,{title:"API配置",show:C.show,onClose:u[13]||(u[13]=x=>C.$emit("close"))},{default:ne(()=>{var x,O;return[t("div",null,[t("div",Zs,[u[17]||(u[17]=t("label",{for:"preset-select",class:"modal__form-label"},"当前预设",-1)),t("div",Xs,[Q(t("select",{id:"preset-select","onUpdate:modelValue":u[0]||(u[0]=F=>m.value=F),onChange:M,class:"modal__form-control modal__form-control--select"},[(y(!0),k(le,null,ie(l.value,F=>(y(),k("option",{key:F.name,value:F.name},S(F.name),9,Ys))),128))],544),[[Ye,m.value]]),t("button",{class:"modal__button modal__button--icon modal__button--add",onClick:te,title:"添加预设"},u[14]||(u[14]=[t("i",{class:"fas fa-plus"},null,-1)])),t("button",{class:"modal__button modal__button--icon modal__button--rename",onClick:N,title:"重命名预设",disabled:l.value.length<=0},u[15]||(u[15]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Ks),t("button",{class:"modal__button modal__button--icon modal__button--delete",onClick:P,disabled:l.value.length<=1,title:"删除预设"},u[16]||(u[16]=[t("i",{class:"fas fa-trash-alt"},null,-1)]),8,eo)])]),t("div",to,[u[19]||(u[19]=t("label",{for:"api-enabled",class:"modal__form-label"},"启用API",-1)),t("label",so,[Q(t("input",{type:"checkbox",id:"api-enabled","onUpdate:modelValue":u[1]||(u[1]=F=>a.value.enabled=F)},null,512),[[Se,a.value.enabled]]),u[18]||(u[18]=t("span",{class:"modal__toggle-slider"},null,-1))])]),t("div",oo,[u[20]||(u[20]=t("label",{for:"api-url",class:"modal__form-label"},"API地址",-1)),Q(t("input",{type:"text",id:"api-url","onUpdate:modelValue":u[2]||(u[2]=F=>a.value.apiUrl=F),class:"modal__form-control",placeholder:"例如: https://api.openai.com/v1/chat/completions"},null,512),[[T,a.value.apiUrl]])]),t("div",uo,[u[21]||(u[21]=t("label",{for:"api-key",class:"modal__form-label"},"API密钥",-1)),Q(t("input",{type:"password",id:"api-key","onUpdate:modelValue":u[3]||(u[3]=F=>a.value.apiKey=F),class:"modal__form-control",placeholder:"sk-..."},null,512),[[T,a.value.apiKey]])]),t("div",no,[u[22]||(u[22]=t("label",{for:"api-model",class:"modal__form-label"},"模型名称",-1)),Q(t("input",{type:"text",id:"api-model","onUpdate:modelValue":u[4]||(u[4]=F=>a.value.model=F),class:"modal__form-control",placeholder:"例如: gpt-3.5-turbo"},null,512),[[T,a.value.model]])]),t("div",lo,[u[24]||(u[24]=t("label",{for:"auto-generate",class:"modal__form-label"},"自动生成",-1)),t("label",io,[Q(t("input",{type:"checkbox",id:"auto-generate","onUpdate:modelValue":u[5]||(u[5]=F=>a.value.autoGenerate=F)},null,512),[[Se,a.value.autoGenerate]]),u[23]||(u[23]=t("span",{class:"modal__toggle-slider"},null,-1))])]),t("div",ao,[u[26]||(u[26]=t("label",{for:"auto-sync",class:"modal__form-label"},"自动同步",-1)),t("label",ro,[Q(t("input",{type:"checkbox",id:"auto-sync","onUpdate:modelValue":u[6]||(u[6]=F=>a.value.autoSync=F)},null,512),[[Se,a.value.autoSync]]),u[25]||(u[25]=t("span",{class:"modal__toggle-slider"},null,-1))])]),u[35]||(u[35]=t("div",{class:"modal__form-description"},"启用后，AI生成内容后将自动同步到远程仓库 (需配置GitHub)",-1)),t("div",co,[u[28]||(u[28]=t("label",{for:"stream-output",class:"modal__form-label"},"流式输出",-1)),t("label",vo,[Q(t("input",{type:"checkbox",id:"stream-output","onUpdate:modelValue":u[7]||(u[7]=F=>a.value.streamOutput=F)},null,512),[[Se,a.value.streamOutput]]),u[27]||(u[27]=t("span",{class:"modal__toggle-slider"},null,-1))])]),t("div",po,[u[30]||(u[30]=t("label",{for:"system-prompt",class:"modal__form-label"},"系统提示词",-1)),t("div",{class:"modal__prompt-controls"},[t("button",{class:"modal__button modal__button--small modal__button--reset",onClick:Z,title:"加载提示词预设"},u[29]||(u[29]=[t("i",{class:"fas fa-list"},null,-1)]))]),Q(t("textarea",{id:"system-prompt","onUpdate:modelValue":u[8]||(u[8]=F=>a.value.systemPrompt=F),class:"modal__form-control",rows:"3",placeholder:"输入系统提示词"},null,512),[[T,a.value.systemPrompt]])]),t("div",fo,[u[31]||(u[31]=t("label",{for:"temperature",class:"modal__form-label"},"温度 (0-1)",-1)),t("div",ho,[Q(t("input",{type:"range",id:"temperature","onUpdate:modelValue":u[9]||(u[9]=F=>a.value.temperature=F),min:"0",max:"1",step:"0.1"},null,512),[[T,a.value.temperature,void 0,{number:!0}]]),t("span",null,S((x=a.value.temperature)==null?void 0:x.toFixed(1)),1)])]),t("div",mo,[u[32]||(u[32]=t("label",{for:"max-tokens",class:"modal__form-label"},"最大令牌数",-1)),Q(t("input",{type:"number",id:"max-tokens","onUpdate:modelValue":u[10]||(u[10]=F=>a.value.maxTokens=F),min:"1",class:"modal__form-control"},null,512),[[T,a.value.maxTokens,void 0,{number:!0}]])]),t("div",_o,[u[33]||(u[33]=t("label",{for:"top-p",class:"modal__form-label"},"Top P (0-1)",-1)),t("div",go,[Q(t("input",{type:"range",id:"top-p","onUpdate:modelValue":u[11]||(u[11]=F=>a.value.topP=F),min:"0",max:"1",step:"0.1"},null,512),[[T,a.value.topP,void 0,{number:!0}]]),t("span",null,S((O=a.value.topP)==null?void 0:O.toFixed(1)),1)])]),f.value?(y(),k("div",Do,[t("div",wo,[u[34]||(u[34]=t("div",{class:"modal__prompt-presets-header"},"选择提示词预设",-1)),p.value.length>0?(y(),k("div",Fo,[(y(!0),k(le,null,ie(p.value,F=>(y(),k("div",{key:F.name,class:"modal__prompt-preset-item",onClick:me=>X(F)},[t("div",Ao,S(F.name),1),t("div",bo,S(F.description),1)],8,Co))),128))])):(y(),k("div",yo," 未找到提示词预设 ")),t("div",{class:"modal__prompt-presets-actions"},[t("button",{class:"modal__button modal__button--small",onClick:ae},"清空提示词"),t("button",{class:"modal__button modal__button--small",onClick:re},"关闭")])])])):Qe("",!0),t("div",ko,[t("button",{class:"modal__button modal__button--secondary",onClick:u[12]||(u[12]=F=>C.$emit("close"))},"取消"),t("button",{class:"modal__button modal__button--primary",onClick:J},"保存当前预设")])])]}),_:1},8,["show"]))}}),xo={class:"page-quiz__container"},$o={class:"page-quiz__header"},qo={class:"page-quiz__title"},zo={class:"page-quiz__header-actions"},Bo={class:"page-quiz__options-bar"},So={class:"page-quiz__chapter-select"},Mo=["value"],Qo={class:"page-quiz__mode-buttons"},Po={class:"page-quiz__question-id"},Oo=["innerHTML"],Lo=["data-key","onClick"],No={class:"page-quiz__option-text"},Go={class:"page-quiz__option-letter"},Ro=["innerHTML"],To={class:"page-quiz__action-buttons-container"},Io={class:"page-quiz__action-left"},Uo=["disabled"],jo=["disabled"],Vo={class:"page-quiz__action-right"},Ho=["disabled"],Wo=["disabled"],Jo=["disabled"],Zo={class:"page-quiz__progress-footer"},Xo={class:"page-quiz__progress-info"},Yo={class:"page-quiz__accuracy"},Ko={class:"page-quiz__progress-bar-container"},eu={class:"page-quiz__notes-header"},tu={class:"page-quiz__notes-title"},su={key:0,class:"notes-generation-status current"},ou={class:"page-quiz__notes-actions"},uu=["title","disabled"],nu=["disabled","title"],lu={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-edit"},iu={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},au=["disabled","title"],ru={key:0,class:"loading-spinner"},cu={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-zap"},du=["innerHTML"],vu={class:"page-quiz__markdown-toolbar"},pu={key:1,class:"loading-container"},fu={key:2,class:"page-quiz__loading"},_u=be({__name:"page-quiz",setup(v){const n=ps(),d=A(!0),h=A(null),l=A([]),m=A(0),a=A(null),p=A(!1),f=A([]),r=A(!1),D=A("idle"),_=A(null),M=A("all"),te=A([]),N=A(!1),P=A(!1),J=A(""),Z=A(""),ae=A(!1),re=A(!1),X=A(!1),C=A(!1),u=A(!1),x=A(!1),O=A(!1),F=A(null),me=kt({show:!1,message:"",type:"info"}),z=$(()=>w.getQuizSettings()),Ge=$(()=>w.getUiSettings()),_e=$(()=>w.getApiConfig()),Ke=$(()=>Ge.value.darkMode),Re=A(null),$t=A(null),ge=A(null),qt=A(null),et=$(()=>{const s=w.getQuizData(),e=w.getLastLoadedQuiz();return(s==null?void 0:s.title)||(e==null?void 0:e.name)||"测验"}),E=$(()=>m.value>=0&&m.value<l.value.length?l.value[m.value]:null),j=$(()=>{var s,e;return((s=E.value)==null?void 0:s.userAnswer)!==null&&((e=E.value)==null?void 0:e.userAnswer)!==void 0}),Te=$(()=>a.value!==null&&!p.value&&!z.value.reviewMode&&(!j.value||!z.value.lockAnswerAfterSubmit)),Ie=$(()=>j.value&&z.value.lockAnswerAfterSubmit),De=$(()=>{const s=m.value<se.value-1,e=j.value||z.value.reviewMode||z.value.allowSkip;return!p.value&&(s||e)}),ye=$(()=>m.value>0&&!p.value),se=$(()=>l.value.length),we=$(()=>l.value.filter(s=>s.userAnswer!==null&&s.userAnswer!==void 0).length),tt=$(()=>l.value.filter(s=>s.userAnswer!==null&&s.userAnswer!==void 0&&Ee(s.userAnswer,s.answer)).length),zt=$(()=>se.value>0?Math.round(we.value/se.value*100):0),Bt=$(()=>we.value===0?0:Math.round(tt.value/we.value*100)),st=$(()=>({totalQuestions:se.value,answeredCount:we.value,correctCount:tt.value,wrongQuestionIds:f.value.map(String)})),St=$(()=>{if(!E.value)return!1;const s=j.value,e=z.value.showNotesAfterAnswer;return ae.value||!e||z.value.reviewMode||s}),Mt=$(()=>{switch(D.value){case"pending":return"sync-pending";case"success":return"sync-success";case"error":return"sync-error";default:return"sync-idle"}}),Qt=$(()=>{switch(D.value){case"pending":return"同步中...";case"success":return"同步成功";case"error":return"同步失败";default:return"点击同步笔记"}}),ce=$(()=>P.value&&_.value!==null),ot=$(()=>{const s=w.getQuizData(),e=w.getLastLoadedQuiz(),o=!!s||!!(e!=null&&e.name);return{name:(e==null?void 0:e.name)||(s==null?void 0:s.title)||"",source:(e==null?void 0:e.source)||"",isLocal:(e==null?void 0:e.source)==="local",exists:o}});function ut(){n.push("/library")}function nt(){d.value=!0,p.value=!1,r.value=!1,f.value=[],h.value=null,os(),Pt()}function Pt(){d.value=!0,h.value=null;const s=w.getQuizData();if(!s||!s.chapters){h.value="题库数据为空，请返回选择题库",d.value=!1;return}te.value=w.getQuizChapters();const e=w.getQuizConfig();M.value=e.chapterIndex||"all",He(M.value),l.value.length>0?G(()=>{oe(0)}):h.value=`当前章节 "${M.value}" 没有题目`,d.value=!1}async function oe(s){var e;if(s<0||s>=l.value.length){console.warn("无效的问题索引:",s),!p.value&&l.value.length>0&&it();return}m.value=s,a.value=((e=E.value)==null?void 0:e.userAnswer)??null,N.value=!1,await Y(),Re.value&&Re.value.scrollTo({top:0,behavior:"smooth"}),G(()=>{qe()})}function lt(s){p.value||z.value.reviewMode||Ie.value||(a.value=s,j.value&&!z.value.lockAnswerAfterSubmit&&Ot(s),z.value.autoSubmit&&!j.value&&G(ke))}function Ot(s){const e=E.value;if(!e)return;e.userAnswer,e.userAnswer=s,w.updateQuestion(e.id,{userAnswer:s});const o=Ee(s,e.answer),c=String(e.id),i=f.value.indexOf(c),g=i!==-1;!o&&!g?f.value.push(c):o&&g&&f.value.splice(i,1)}function ke(){if(a.value===null||Ie.value)return;const s=E.value;if(!s)return;const e=Ee(a.value,s.answer);if(s.userAnswer!==a.value)if(s.userAnswer=a.value,w.updateQuestion(s.id,{userAnswer:a.value})){w.updateQuizStats({totalAnswered:1,correctCount:e?1:0,wrongCount:e?0:1});const c=String(s.id),i=f.value.indexOf(c);!e&&i===-1?f.value.push(c):e&&i!==-1&&f.value.splice(i,1),w.saveQuizState()}else{console.error("Failed to save user answer via configService for question:",s.id),b("保存答案失败","error");return}z.value.showNotesAfterAnswer&&(ae.value=!0,Y()),z.value.autoNext&&De.value&&setTimeout(Fe,1e3)}function Ue(){ye.value&&oe(m.value-1)}function Fe(){m.value<se.value-1?oe(m.value+1):p.value||b("已经是最后一题了","info")}function Lt(s){s>=0&&s<se.value&&oe(s)}function it(){p.value||(p.value=!0,X.value=!0,localStorage.setItem("lastQuizStats",JSON.stringify({...st.value,timestamp:Date.now(),quizTitle:et.value})))}function Nt(){if(window.confirm("确定要重做本次测验吗？所有答题记录将被清空。")){p.value=!1,f.value=[],a.value=null,r.value=!1;const s=w.getQuizData();s&&(s.chapters.forEach(e=>{e.questions.forEach(o=>{l.value.some(c=>c.id===o.id)&&(o.userAnswer=null)})}),w.setQuizData(s),w.saveQuizState()),He(M.value),m.value=0,l.value.length>0&&oe(0),b("测验已重置","success")}}function Gt(){var o;if(f.value.length===0){b("没有错题记录","info");return}X.value=!1;const e=(((o=w.getQuizData())==null?void 0:o.chapters.flatMap(c=>c.questions))||[]).filter(c=>f.value.includes(String(c.id)));e.length>0?(l.value=e.map(c=>({...c,userAnswer:null})),p.value=!1,r.value=!0,m.value=0,oe(0),b(`已切换到错题回顾 (${e.length}题)`,"info")):b("没有找到错题详情","warning")}function Rt(){var s;N.value=!N.value,N.value&&(J.value=((s=E.value)==null?void 0:s.notes)||"",G(()=>{ge.value&&(ge.value.focus(),de())}))}function Tt(){if(!E.value||!E.value.id)return;const s=J.value;if(w.saveNoteToQuestion(E.value.id,s)){const o=l.value.findIndex(c=>{var i;return c.id===((i=E.value)==null?void 0:i.id)});o>-1&&(l.value[o].notes=s),N.value=!1,G(Y),b("笔记已保存","success")}else b("保存笔记失败","error")}async function Y(){const s=E.value;if(!s){Z.value='<p class="page-quiz__notes-placeholder">请先加载题目</p>';return}const e=s.notes||"",o=ce.value&&_.value===m.value;if(!e&&!o){Z.value='<p class="page-quiz__notes-placeholder">这道题目还没有笔记...</p>';return}try{let c="";o&&!c&&(c='<p class="page-quiz__notes-placeholder">思考中...</p>'),Z.value=c||'<p class="page-quiz__notes-placeholder">这道题目还没有笔记...</p>'}catch(c){console.error("笔记 Markdown 渲染失败:",c),Z.value=`<p class="page-quiz__notes-error">笔记内容解析失败: ${c instanceof Error?c.message:"未知错误"}</p>`}}function Ce(s){const e=ge.value;if(!e)return;const o=e.selectionStart,c=e.selectionEnd,i=e.value,g=i.substring(o,c);let B=s,q=0;const U={"**粗体**":"粗体","*斜体*":"斜体","# 标题":"标题","- 列表项":"列表项","```\\n代码块\\n```":"代码块"};for(const L in U)if(s===L&&g){B=s.replace(U[L],g),L.includes("**")||L.includes("*")?q=L.indexOf(U[L]):L.includes("```")&&(q=L.indexOf(`
`)+1);break}e.value=i.substring(0,o)+B+i.substring(c),J.value=e.value,e.focus(),G(()=>{g&&q>0?(e.selectionStart=o+q,e.selectionEnd=o+q+g.length):e.selectionStart=e.selectionEnd=o+B.length,de()})}function de(){const s=ge.value;s&&(s.style.height="auto",G(()=>{if(s){const e=s.scrollHeight,o=80;s.style.height=`${Math.max(e,o)}px`}}))}async function It(s,e,o){var i,g,B,q,U,L,vt,pt,ft,ht,mt,_t,gt,Dt;if(console.log(`[LOG] 请求生成笔记: 目标索引=${e}, 问题ID=${(s==null?void 0:s.id)??"null"}`),!s){o("",e,"无法获取问题信息");return}const c=w.getApiConfig();if(!c.enabled||!c.apiUrl||!c.apiKey){b("请先启用并配置AI API设置","info"),O.value=!0,o("",e,"API未配置或未启用");return}try{const K=w.getNotesGenerationRequestParams(s);console.log(`[LOG] 发起 API 请求: 索引=${e}, URL=${c.apiUrl}, Model=${K.model}, Stream=${K.stream}`);const V=await fetch(c.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.apiKey}`},body:JSON.stringify(K)});if(!V.ok){const H=await V.text();throw console.error(`[ERROR] API 请求失败: ${V.status} ${V.statusText}`,H),new Error(`API请求失败 (${V.status}): ${V.statusText||H}`)}let ee="";if(K.stream&&V.body){const H=V.body.getReader(),as=new TextDecoder;let Ae="",wt=Date.now();const rs=3e4,We=setInterval(()=>{Date.now()-wt>rs&&(console.warn(`[WARN] 数据流接收超时，可能存在网络问题 (Index: ${e})`),b("网络连接不稳定，笔记生成可能中断","warning"),clearInterval(We),H.cancel("Timeout").catch(console.error),o(ee,e,"数据流接收超时"))},1e4);try{for(;;){const{done:ze,value:cs}=await H.read();if(wt=Date.now(),ze){console.log(`[LOG] 流读取完成 (done) for index ${e}`);break}Ae+=as.decode(cs,{stream:!0});let Je;for(;(Je=Ae.indexOf(`
`))>=0;){const Ze=Ae.slice(0,Je).trim();if(Ae=Ae.slice(Je+1),Ze.startsWith("data: ")){const Be=Ze.substring(6);if(Be==="[DONE]"){console.log(`[LOG] 收到 [DONE] 信号，索引 ${e}`);break}try{const fe=JSON.parse(Be);console.log(`[DEBUG] Raw dataStr (Index ${e}):`,Be),console.log(`[DEBUG] Parsed data (Index ${e}):`,fe);const Ft=((B=(g=(i=fe.choices)==null?void 0:i[0])==null?void 0:g.delta)==null?void 0:B.content)||((L=(U=(q=fe.choices)==null?void 0:q[0])==null?void 0:U.message)==null?void 0:L.content)||((vt=fe.delta)==null?void 0:vt.content)||"";Ft&&(ee+=Ft)}catch(fe){Be.trim()&&console.error("[ERROR] 解析流式 JSON 出错:",fe,"原始行:",Ze,`(Index: ${e})`)}}}}}catch(ze){console.error(`[ERROR] 流读取过程中发生错误 (Index: ${e}):`,ze),o(ee,e,`流处理错误: ${ze.message}`),clearInterval(We);return}finally{clearInterval(We)}console.log(`[LOG] 流处理完成，索引 ${e}. 最终笔记长度: ${ee.length}`),o(ee.trim(),e)}else{const H=await V.json();ee=((ht=(ft=(pt=H.choices)==null?void 0:pt[0])==null?void 0:ft.message)==null?void 0:ht.content)||((_t=(mt=H.choices)==null?void 0:mt[0])==null?void 0:_t.text)||((Dt=(gt=H.content)==null?void 0:gt[0])==null?void 0:Dt.text)||"",console.log(`[LOG] 非流式响应笔记 (Index: ${e}):`,ee.substring(0,100)+"..."),o(ee.trim(),e)}}catch(K){console.error(`[ERROR] 生成笔记失败，索引 ${e}:`,K),o("",e,`笔记生成失败: ${K instanceof Error?K.message:"未知错误"}`)}}function Ut(){!E.value||p.value||(ae.value=!0,dt(m.value,!0))}async function at(){if(D.value!=="pending"){D.value="pending",b("笔记同步中...","info");try{const s=w.getGithubConfig(),e=s.syncQuizName||ot.value.name;if(!e){D.value="error",b("无法确定要同步的题库名称","error");return}await w.pushQuizToGithub(e,s.forceSync)?(D.value="success",b(`题库 "${e}" 已成功同步到GitHub`,"success"),setTimeout(()=>D.value="idle",2e3)):D.value="error"}catch(s){console.error("同步失败:",s),D.value="error",b(`同步失败: ${s instanceof Error?s.message:"未知错误"}`,"error")}finally{D.value==="pending"&&(D.value="idle")}}}function jt(){x.value=!0}function Vt(s){console.log("同步配置已保存:",s),w.updateGithubConfig(s)}async function Ht(s){console.log("同步完成",s);const e=await w.handleQuizSyncComplete(s);if(e&&e.data&&w.getQuizData()){const o=w.getLastLoadedQuiz();o&&o.name===e.quizName&&e.wasOverridden&&(w.setQuizData(e.data),nt(),b(`已更新当前题库: ${e.quizName}`,"success"))}}function Wt(){return w.getApiConfig()}function Jt(){if(!z.value.canEditQuestion||p.value||!E.value){b("当前状态无法编辑题目","warning");return}F.value=JSON.parse(JSON.stringify(E.value)),u.value=!0}function je(){u.value=!1,F.value=null}function Zt(s){if(!F.value||!F.value.id){console.error("无法保存：编辑中的问题或其ID无效"),b("保存题目失败：内部错误","error");return}const e=F.value.id;if(w.updateQuestion(e,s)){const c=l.value.findIndex(i=>i.id===e);c!==-1&&(l.value[c]={...l.value[c],...s}),E.value&&E.value.id,"notes"in s&&Y(),b("题目已更新","success"),je()}else b("更新题目失败","error")}function ve(s,e){if(typeof s=="string"){const o=s.match(/^([A-Z])([.:)]|\s+|$)/i);if(o)return o[1].toUpperCase()}return String.fromCharCode(65+e)}function Xt(s){if(typeof s!="string")return String(s);const e=s.match(/^([A-Z])([.:)]|\s+)/i);return ct(e?s.substring(e[0].length).trim():s)}function Yt(s){const e=E.value;if(!e)return"";const o=["page-quiz__option"],c=a.value===s,i=e.userAnswer===s,g=Ve(e.answer,s),B=j.value,q=z.value.reviewMode,U=z.value.showCorrectAnswerImmediately,L=Ie.value;return c&&!L&&!q&&o.push("page-quiz__option--selected"),(B||q)&&(g?(q||U||i)&&o.push("page-quiz__option--correct"):i&&o.push("page-quiz__option--incorrect")),(L||p.value)&&o.push("page-quiz__option--locked"),o.join(" ")}function Kt(s){const e=E.value;if(!e)return"page-quiz__option-number";const o=Ve(e.answer,s),c=e.userAnswer===s,i=j.value,g=z.value.reviewMode,B=z.value.showCorrectAnswerImmediately,q=["page-quiz__option-number"];return(i||g)&&(o&&(g||B)?q.push("page-quiz__option-number--correct"):c&&!o&&q.push("page-quiz__option-number--incorrect")),q.join(" ")}function Ve(s,e){if(s==null||e==="")return!1;const o=e.charCodeAt(0)-65;return Array.isArray(s)?s.some(c=>c===o):typeof s=="number"?s===o:typeof s=="string"?s.toUpperCase()===e.toUpperCase():(console.warn("无法识别的答案格式:",s,"对比值:",e),!1)}function Ee(s,e){return s==null||e===void 0||e===null?!1:Ve(e,s)}let pe=0,xe=0,$e=!1;function es(s){z.value.swipeGestureEnabled&&s.touches.length===1&&(pe=s.touches[0].clientX,xe=s.touches[0].clientY,$e=!1)}function ts(s){if(!(!z.value.swipeGestureEnabled||pe===0)&&s.touches.length===1){const e=s.touches[0].clientX,o=s.touches[0].clientY,c=pe-e,i=xe-o;Math.abs(c)>Math.abs(i)&&Math.abs(c)>10&&(s.preventDefault(),$e=!0)}}function ss(s){if(!(!z.value.swipeGestureEnabled||pe===0)){if(s.changedTouches.length===1){const e=s.changedTouches[0].clientX,o=s.changedTouches[0].clientY,c=pe-e,i=xe-o,g=window.innerWidth*.15,B=window.innerHeight*.1;($e||Math.abs(c)>g&&Math.abs(i)<B)&&(c>0?De.value&&(Fe(),s.preventDefault()):ye.value&&(Ue(),s.preventDefault()))}pe=0,xe=0,$e=!1}}function rt(s){const e=document.activeElement,o=e&&(e.tagName==="TEXTAREA"||e.tagName==="INPUT"||e.isContentEditable),c=!!document.querySelector(".modal.modal--active");if(s.key==="Escape"&&c){s.preventDefault(),re.value=!1,X.value=!1,C.value=!1,je(),x.value=!1,O.value=!1;return}if(!(o||c))if(s.key>="1"&&s.key<="7"){const i=parseInt(s.key)-1;if(E.value&&i<E.value.options.length){const g=ve(E.value.options[i],i);lt(g),s.preventDefault()}}else s.key===" "?(s.preventDefault(),Te.value?ke():De.value&&j.value&&Fe()):s.key==="ArrowLeft"?ye.value&&(Ue(),s.preventDefault()):s.key==="ArrowRight"?De.value&&(Fe(),s.preventDefault()):s.key==="Enter"&&Te.value&&(ke(),s.preventDefault())}function os(){document.addEventListener("keydown",rt)}function us(){document.removeEventListener("keydown",rt)}function ns(){w.toggleDarkMode(),G(()=>{Y()})}function ls(s,e){var B,q;const o=String(s.id||""),c=String(e.id||""),i=parseInt(((B=o.match(/^\d+/))==null?void 0:B[0])||"",10),g=parseInt(((q=c.match(/^\d+/))==null?void 0:q[0])||"",10);return!isNaN(i)&&!isNaN(g)&&i!==g?i-g:o.localeCompare(c)}function ct(s){return s?s.replace(/^([A-Z])([.:)]|\s)\s*/,"").trim():""}function is(s){return s?s.replace(/^\s*\d+\s*\.\s*/,"").trim():""}function He(s){d.value=!0,h.value=null,console.log(`Filtering questions for chapter: ${s}`);const e=w.getQuizData();if(!e||!e.chapters){l.value=[],h.value="无法加载题库数据",d.value=!1,console.error("Quiz data or chapters not found in configService.");return}let o=[];try{if(s==="all")e.chapters.forEach(i=>{if(i.questions&&Array.isArray(i.questions)){const g=i.questions.map(B=>({...B,chapterTitle:i.title}));o.push(...g)}});else{const i=e.chapters.find(g=>g.title===s);i&&i.questions&&Array.isArray(i.questions)&&(o=i.questions.map(g=>({...g,chapterTitle:i.title})))}const c=1;if(o=o.map((i,g)=>({...i,id:i.id||`gen_${s}_${g}`,title:i.title||i.question||"",question:i.question||i.title||"",options:i.options||[]})),o.sort(ls),z.value.randomMode)for(let i=o.length-1;i>0;i--){const g=Math.floor(Math.random()*(i+1));[o[i],o[g]]=[o[g],o[i]]}o.forEach((i,g)=>{i.number=g+1}),l.value=o,h.value=o.length===0?`章节 "${s}" 下没有题目`:null,f.value=o.filter(i=>i.userAnswer!==null&&i.userAnswer!==void 0&&!Ee(i.userAnswer,i.answer)).map(i=>String(i.id)),w.setQuizConfig({chapterIndex:s}),console.log(`Filtered ${o.length} questions. Random mode: ${z.value.randomMode}`)}catch(c){console.error("Error during question filtering:",c),h.value="过滤题目时发生错误",l.value=[]}finally{d.value=!1}}function dt(s,e){console.log(`[LOG] 请求生成笔记: Index=${s}, Manual=${e}, CurrentGenIndex=${_.value}, isGenerating=${P.value}`);const o=l.value[s];if(!o||p.value){console.warn(`[WARN] 忽略生成请求 (Index: ${s}): 无问题或测验已提交`);return}if(!e&&o.notes&&o.notes.trim()!==""){console.log(`[LOG] 跳过自动生成 (Index: ${s}): 已有笔记`),qe();return}if(P.value||_.value!==null){e&&_.value===s||b(`已有笔记生成任务进行中 (题目 ${_.value!==null?_.value+1:"?"})`,"info"),console.warn(`[WARN] 忽略生成请求 (Index: ${s}): 当前活跃生成 Index: ${_.value}`);return}_.value=s,P.value=!0,ae.value=!0,b(`开始为题目 ${s+1} 生成笔记...`,"info"),o&&(o.notes=""),m.value===s&&Y(),It(o,s,async(i,g,B)=>{console.log(`[LOG] 生成完成: Index=${g}, Expected=${s}, Error=${B||"None"}, Final Length=${i==null?void 0:i.length}`);const q=l.value[g];if(!q){console.warn(`[WARN] Generation completed for index ${g}, but the question object no longer exists.`),_.value===g&&(_.value=null,P.value=!1),qe();return}if(_.value!==g){console.warn(`[WARN] 忽略过时的完成回调 (Completed: ${g}, Active: ${_.value})`);return}try{q.notes=i,q.id?(console.log(`[LOG] 最终保存索引 ${g} 的笔记`),w.saveNoteToQuestion(q.id,i),w.saveQuizState()):console.error(`[ERROR] 无法为索引 ${g} 执行最终保存，缺少问题ID`),console.log(`[LOG] Resetting generation state: activeGenerationIndex from ${_.value} to null`),_.value=null,P.value=!1,m.value===g&&(console.log(`[LOG] Rendering final Markdown for currently viewed index ${g}`),await Y(),await G()),B?b(`题目 ${g+1} 笔记生成失败: ${B}`,"error"):b(`题目 ${g+1} 笔记生成完成`,"success"),!B&&_e.value.autoSync&&!e&&(b("正在自动同步到远程仓库...","info"),at())}catch(U){console.error(`[ERROR] 处理索引 ${g} 的完成回调时出错:`,U),b("处理笔记生成结果时出错","error"),_.value===g&&(_.value=null,P.value=!1)}finally{_.value===g&&(console.warn(`[WARN] Generation state was not reset before finally block for index ${g}. Resetting now.`),_.value=null,P.value=!1),console.log("[LOG] 完成处理结束，检查下一个自动生成。"),qe()}})}function qe(){if(console.log("[LOG] 自动生成检查被调用。"),!_e.value.enabled||!_e.value.autoGenerate||p.value||P.value||_.value!==null){console.log(`[LOG] 自动生成检查跳过: 启用=${_e.value.enabled}, 自动生成=${_e.value.autoGenerate}, 已提交=${p.value}, 生成中=${P.value}, 活动索引=${_.value}`);return}const s=m.value+1;if(console.log(`[LOG] 检查下一索引的自动生成: ${s}`),s<l.value.length){const e=l.value[s];e&&(!e.notes||e.notes.trim()==="")?(console.log(`[LOG] 触发索引 ${s} 的自动生成`),dt(s,!1)):console.log(`[LOG] 跳过索引 ${s} 的自动生成: 问题已有笔记或不存在。`)}else console.log("[LOG] 没有更多问题可自动生成。")}return Et(()=>{nt(),window.addEventListener("resize",de)}),fs(()=>{us(),window.removeEventListener("resize",de)}),he(M,(s,e)=>{s!==e&&(console.log(`章节切换到: ${s}`),m.value=0,a.value=null,p.value=!1,r.value=!1,He(s),l.value.length>0?oe(0):(Z.value="",h.value=`章节 "${s}" 下没有题目`))}),he(J,()=>{N.value&&de()}),he(Ke,()=>{G(()=>{Y()})}),(s,e)=>(y(),k("div",{class:"page-quiz",style:Ct({"--font-family":Ge.value.fontFamily||"sans-serif"})},[t("div",{class:R(["toast",me.type?`toast--${me.type}`:"",me.show?"toast--show":""])},S(me.message),3),t("div",xo,[t("header",$o,[t("button",{class:"page-quiz__back-button",onClick:ut,title:"返回","aria-label":"返回"},e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-arrow-left"},[t("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),t("polyline",{points:"12 19 5 12 12 5"})],-1)])),t("h1",qo,S(et.value),1),t("div",zo,[t("div",{class:R(["page-quiz__theme-toggle",{dark:Ke.value}]),onClick:ns},e[17]||(e[17]=[Xe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sun-icon feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="moon-icon feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>',2)]),2),t("button",{class:"page-quiz__settings-button",onClick:e[0]||(e[0]=o=>C.value=!0),title:"设置","aria-label":"设置"},e[18]||(e[18]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"3"}),t("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})],-1)]))])]),t("div",Bo,[t("div",So,[e[20]||(e[20]=t("span",null,"章节：",-1)),Q(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>M.value=o),class:"page-quiz__select"},[e[19]||(e[19]=t("option",{value:"all"},"全部章节",-1)),(y(!0),k(le,null,ie(te.value,(o,c)=>(y(),k("option",{key:c,value:o},S(o),9,Mo))),128))],512),[[Ye,M.value]])]),t("div",Qo,[e[23]||(e[23]=Xe('<button class="page-quiz__mode-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg><span>刷题模式</span></button>',1)),t("button",{class:"page-quiz__mode-button",onClick:e[2]||(e[2]=o=>re.value=!0)},e[21]||(e[21]=[Xe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg><span>题目总览</span>',2)])),z.value.canEditQuestion?(y(),k("button",{key:0,class:"page-quiz__mode-button edit-button",onClick:Jt},e[22]||(e[22]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})],-1),t("span",null,"编辑题目",-1)]))):Qe("",!0)])]),t("div",{class:"page-quiz__question-area",ref_key:"questionAreaRef",ref:Re,onTouchstart:es,onTouchmove:ts,onTouchend:ss},[ue(hs,{name:"question-fade-slide",mode:"out-in",css:Ge.value.animationEnabled},{default:ne(()=>[E.value?(y(),k("div",{class:"page-quiz__question-content-wrapper",key:E.value.id},[t("div",{class:"page-quiz__question-text",ref_key:"questionTextRef",ref:qt},[t("span",Po,"第"+S(E.value.number||m.value+1)+"题",1),t("span",{innerHTML:is(E.value.question)},null,8,Oo)],512),t("ul",{class:R(["page-quiz__options-list",{"page-quiz--submitted":p.value}])},[(y(!0),k(le,null,ie(E.value.options,(o,c)=>(y(),k("li",{key:c,class:R(["page-quiz__option",Yt(ve(o,c))]),"data-key":ve(o,c),onClick:i=>lt(ve(o,c))},[t("div",No,[t("span",Go,S(ve(o,c)),1),t("span",{innerHTML:Xt(o)},null,8,Ro)]),t("div",{class:R(["page-quiz__option-number",Kt(ve(o,c))])},S(c+1),3)],10,Lo))),128))],2),t("div",To,[t("div",Io,[t("button",{class:"page-quiz__button page-quiz__submit-button",onClick:ke,disabled:!Te.value},e[24]||(e[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-check-circle"},[t("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),t("polyline",{points:"22 4 12 14.01 9 11.01"})],-1),Me(" 提交 "),t("span",{class:"page-quiz__key-hint"},"空格",-1)]),8,Uo),t("button",{class:"page-quiz__button page-quiz__next-button",onClick:Fe,disabled:!De.value},e[25]||(e[25]=[t("span",null,"下一题",-1),t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"9 18 15 12 9 6"})],-1),t("span",{class:"page-quiz__key-hint"},"空格",-1)]),8,jo)]),t("div",Vo,[t("button",{class:"page-quiz__button page-quiz__submit-all-button",onClick:it,disabled:p.value},e[26]||(e[26]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-check-circle"},[t("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),t("polyline",{points:"22 4 12 14.01 9 11.01"})],-1),Me(" 交卷 ")]),8,Ho),t("button",{class:"page-quiz__button page-quiz__nav-button",onClick:Ue,disabled:!ye.value},e[27]||(e[27]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"15 18 9 12 15 6"})],-1),t("span",null,"上一题",-1)]),8,Wo),t("button",{class:"page-quiz__button page-quiz__redo-button",onClick:Nt,disabled:p.value},e[28]||(e[28]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-rotate-ccw"},[t("polyline",{points:"1 4 1 10 7 10"}),t("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})],-1),Me(" 重做 ")]),8,Jo)])]),t("div",Zo,[t("div",Xo,[t("span",null,"进度: "+S(we.value)+"/"+S(se.value),1),t("span",Yo,"正确率: "+S(Bt.value)+"%",1)]),t("div",Ko,[t("div",{class:"page-quiz__progress-bar",style:Ct({width:zt.value+"%"})},null,4)])]),t("div",{class:R(["page-quiz__notes",{"page-quiz__notes--hidden":!St.value}])},[t("div",eu,[t("h3",tu,[e[29]||(e[29]=Me(" 笔记 ")),ce.value?(y(),k("span",su," 题目("+S(_.value!==null?_.value+1:"?")+")生成笔记中... ",1)):Qe("",!0)]),t("div",ou,[t("button",{class:R(["page-quiz__button page-quiz__button--icon sync-status",Mt.value]),title:Qt.value,onClick:at,disabled:D.value==="pending"},e[30]||(e[30]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-refresh-cw"},[t("polyline",{points:"23 4 23 10 17 10"}),t("polyline",{points:"1 20 1 14 7 14"}),t("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})],-1)]),10,uu),t("button",{class:"page-quiz__button page-quiz__button--icon",onClick:Rt,disabled:p.value||P.value,title:N.value?"取消编辑":"编辑笔记"},[N.value?(y(),k("svg",iu,e[32]||(e[32]=[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"},null,-1),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"},null,-1)]))):(y(),k("svg",lu,e[31]||(e[31]=[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"},null,-1),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"},null,-1)])))],8,nu),t("button",{class:R(["page-quiz__button page-quiz__button--icon page-quiz__ai-button icon-only",{"button--loading":ce.value}]),onClick:Ut,disabled:p.value||P.value,title:ce.value?"正在生成笔记...":"AI生成笔记"},[ce.value?(y(),k("span",ru)):(y(),k("svg",cu,e[33]||(e[33]=[t("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},null,-1)])))],10,au),t("button",{class:"page-quiz__button page-quiz__button--icon page-quiz__settings-button",onClick:jt,title:"GitHub仓库设置"},e[34]||(e[34]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-github"},[t("path",{d:"M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"})],-1)])),t("button",{class:"page-quiz__button page-quiz__button--icon page-quiz__settings-button",onClick:e[3]||(e[3]=o=>O.value=!0),title:"API设置"},e[35]||(e[35]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-sliders"},[t("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),t("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),t("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),t("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),t("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),t("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),t("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),t("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),t("line",{x1:"17",y1:"16",x2:"23",y2:"16"})],-1)]))])]),t("div",{ref_key:"notesDisplayRef",ref:$t,class:R(["page-quiz__notes-display markdown-body",{"page-quiz__notes-display--hidden":N.value,generating:ce.value}]),innerHTML:Z.value},null,10,du),t("div",{class:R(["page-quiz__notes-editor",{"page-quiz__notes-editor--hidden":!N.value}])},[t("div",vu,[t("button",{onClick:e[4]||(e[4]=o=>Ce("**粗体**"))},"粗体"),t("button",{onClick:e[5]||(e[5]=o=>Ce("*斜体*"))},"斜体"),t("button",{onClick:e[6]||(e[6]=o=>Ce("# 标题"))},"标题"),t("button",{onClick:e[7]||(e[7]=o=>Ce("- 列表项"))},"列表"),t("button",{onClick:e[8]||(e[8]=o=>Ce("```\\n代码块\\n```"))},"代码")]),Q(t("textarea",{ref_key:"notesTextareaRef",ref:ge,class:"page-quiz__notes-textarea",placeholder:"在此添加笔记...","onUpdate:modelValue":e[9]||(e[9]=o=>J.value=o),onInput:de},null,544),[[T,J.value]]),t("button",{onClick:Tt,class:"page-quiz__button page-quiz__button--primary"},"保存笔记")],2)],2)])):d.value?(y(),k("div",pu,e[36]||(e[36]=[t("div",{class:"loading-spinner"},null,-1),t("p",{class:"loading-text"},"题目加载中...",-1)]))):(y(),k("div",fu,S(h.value||"没有题目数据或加载失败"),1))]),_:1},8,["css"])],544)]),ue(Ss,{show:re.value,questions:l.value,"current-index":m.value,onClose:e[10]||(e[10]=o=>re.value=!1),onJumpTo:Lt},null,8,["show","questions","current-index"]),ue(Ns,{show:X.value,stats:st.value,onClose:e[11]||(e[11]=o=>X.value=!1),onViewWrong:Gt,onContinue:e[12]||(e[12]=o=>X.value=!1),onBackHome:ut},null,8,["show","stats"]),ue(ms,{show:C.value,onClose:e[13]||(e[13]=o=>C.value=!1)},null,8,["show"]),ue(Js,{show:u.value,question:F.value,onClose:je,onSave:Zt},null,8,["show","question"]),ue(_s,{show:x.value,onClose:e[14]||(e[14]=o=>x.value=!1),onSave:Vt,"current-quiz":ot.value,onSyncComplete:Ht},null,8,["show","current-quiz"]),ue(Eo,{show:O.value,onClose:e[15]||(e[15]=o=>O.value=!1),"current-config":Wt()},null,8,["show","current-config"])],4))}});export{_u as default};
