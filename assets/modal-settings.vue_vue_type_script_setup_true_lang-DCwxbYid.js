var et=Object.defineProperty;var tt=(h,e,t)=>e in h?et(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var w=(h,e,t)=>tt(h,typeof e!="symbol"?e+"":e,t);import{g as Re,h as st,s as m,d as fe,c as R,f as j,b as T,w as nt,e as u,t as G,i as ze,n as pe,r as O,o as Le,j as Ne,k as he,l as it,m as rt,p as M,q,v as F,x as I,F as $e,y as le,z as ot,A as at}from"./index-Dhd0yJrT.js";class lt{canParse(e){if(!e||typeof e!="object")return!1;const t=e;if(!Array.isArray(t.chapters)||t.chapters.length===0)return!1;const s=t.chapters[0];if(!s.title||!Array.isArray(s.questions))return!1;if(s.questions.length>0){const n=s.questions[0];if(!n.title||!Array.isArray(n.options))return!1}return!0}parse(e){return e}}class ut{canParse(e){return typeof e=="string"&&!this.isJson(e)}isJson(e){try{return JSON.parse(e),!0}catch{return!1}}parse(e,t){if(typeof e!="string")throw new Error("TextFormatParser只能处理字符串数据");const n=e.split(`
`).filter(a=>a.trim()),i=t?t.replace(/\.(txt|json)$/,""):n[0]||"未命名题库",r=[];let o={title:"默认章节",questions:[]},l=null;for(let a=1;a<n.length;a++){const c=n[a].trim();if(c.startsWith("## "))o.questions.length>0&&r.push(o),o={title:c.substring(3),questions:[]},l=null;else if(c.match(/^\d+\./))l&&o.questions.push(l),l={id:`q-${Date.now()}-${Math.random().toString(36).slice(2)}`,title:c.substring(c.indexOf(".")+1).trim(),options:[],answer:0,explanation:""};else if(c.startsWith("- ")&&l)l.options.push(c.substring(2).trim());else if(c.startsWith("答案:")&&l){const d=c.substring(3).trim();l.answer=parseInt(d)-1||0}else c.startsWith("解析:")&&l&&(l.explanation=c.substring(3).trim())}return l&&o.questions.push(l),o.questions.length>0&&r.push(o),{title:i,chapters:r,description:"从文本导入",lastModified:Date.now()}}}class Ae{canParse(e){if(!e||typeof e!="object")return!1;const t=e;if(Array.isArray(t.questions)&&t.questions.length>0)return!0;if(Array.isArray(e)&&e.length>0){const s=e[0];if(s&&typeof s=="object")return s.question!==void 0||s.title!==void 0||s.stem!==void 0||s.options!==void 0||s.answer!==void 0}return!1}parse(e,t){const s=e;let n=s.title||"题库";t?n=t.replace(/\.(json|txt)$/,""):s.fileName&&typeof s.fileName=="string"?n=s.fileName.replace(/\.(json|txt)$/,""):s.name&&typeof s.name=="string"&&(n=s.name),n.includes("[")&&n.includes("]")&&(n=n.replace(/\[|\]/g,""));const i=[],r={title:"默认章节",questions:[]};return this.processQuestions(s,r),r.questions.length>0&&i.push(r),this.processChapters(s,i),{title:n,description:typeof s.description=="string"?s.description:"导入的题库",author:typeof s.author=="string"?s.author:"",version:typeof s.version=="string"?s.version:"1.0",lastModified:Date.now(),chapters:i.length>0?i:[r]}}processQuestions(e,t){Array.isArray(e.questions)?e.questions.forEach((s,n)=>{if(!s||typeof s!="object")return;const i=s;this.createQuestion(i,n,t)}):Array.isArray(e)&&e.forEach((s,n)=>{if(!s||typeof s!="object")return;const i=s;this.createQuestion(i,n,t)})}processChapters(e,t){Array.isArray(e.chapters)&&e.chapters.length>0&&e.chapters.forEach((s,n)=>{if(!s||typeof s!="object")return;const i=s;if(i.title&&Array.isArray(i.questions)&&i.questions.length>0){const r={title:typeof i.title=="string"?i.title:`第${n+1}章`,questions:[]};i.questions.forEach((o,l)=>{if(!o||typeof o!="object")return;const a=o;this.createQuestion(a,l,r)}),r.questions.length>0&&t.push(r)}})}createQuestion(e,t,s){const n={id:typeof e.id=="string"||typeof e.id=="number"?String(e.id):`q-${Date.now()}-${t}`,title:"",options:[],answer:0,explanation:""};typeof e.question=="string"?n.title=e.question:typeof e.title=="string"?n.title=e.title:typeof e.stem=="string"?n.title=e.stem:typeof e.content=="string"?n.title=e.content:n.title=`第${t+1}题`,(n.title.includes("<p>")||n.title.includes("</p>"))&&(n.title=n.title.replace(/<\/?p>/g,"")),typeof e.analysis=="string"?n.explanation=e.analysis:typeof e.explanation=="string"?n.explanation=e.explanation:typeof e.parse=="string"?n.explanation=e.parse:typeof e.comment=="string"&&(n.explanation=e.comment),n.options=this.extractOptions(e),n.answer=this.extractAnswer(e,n.options.length),s.questions.push(n)}extractOptions(e){if(Array.isArray(e.options))return this.processOptionsArray(e.options);if(e.options&&typeof e.options=="object")return this.processOptionsObject(e.options);if(Array.isArray(e.choices))return this.processOptionsArray(e.choices);if(e.choices&&typeof e.choices=="object")return this.processOptionsObject(e.choices);const t=[],s=["A","B","C","D","E","F","G","H"];for(const n of s)n in e&&typeof e[n]=="string"&&t.push(e[n]);return t.length>=2?t:["选项A","选项B","选项C","选项D"]}processOptionsArray(e){return e.map(t=>{if(typeof t=="string")return t;if(typeof t=="number")return String(t);if(t===null)return"";if(typeof t=="object"){const s=t;if(typeof s.text=="string")return s.text;if(typeof s.content=="string")return s.content;if(typeof s.label=="string")return s.label;if(typeof s.value=="string")return s.value;if(typeof s.option=="string")return s.option;const n=Object.keys(s);return n.length===1&&typeof s[n[0]]=="string"?s[n[0]]:JSON.stringify(t)}return String(t)})}processOptionsObject(e){let t=Object.keys(e);return t=t.sort((s,n)=>/^[A-Z]$/.test(s)&&/^[A-Z]$/.test(n)?s.charCodeAt(0)-n.charCodeAt(0):/^\d+$/.test(s)&&/^\d+$/.test(n)?parseInt(s)-parseInt(n):s.localeCompare(n)),t.map(s=>{const n=e[s];if(typeof n=="string")return n;if(typeof n=="number")return String(n);if(n===null)return"";if(typeof n=="object"){const i=n;return typeof i.text=="string"?i.text:typeof i.content=="string"?i.content:typeof i.label=="string"?i.label:typeof i.value=="string"?i.value:JSON.stringify(n)}return String(n)})}extractAnswer(e,t){let s;return e.answer!==void 0?s=e.answer:e.correct!==void 0?s=e.correct:e.rightAnswer!==void 0?s=e.rightAnswer:e.correctAnswer!==void 0&&(s=e.correctAnswer),this.processAnswer(s,t)}processAnswer(e,t){if(typeof e=="number")return Math.min(Math.max(0,e),t-1);if(typeof e=="string"){if(/^[A-Z]$/.test(e)){const s=e.charCodeAt(0)-65;return Math.min(Math.max(0,s),t-1)}if(/^\d+$/.test(e)){const s=parseInt(e)-1;return Math.min(Math.max(0,s),t-1)}if(/^[A-Z]+$/.test(e))return Array.from(e).map(s=>{const n=s.charCodeAt(0)-65;return Math.min(Math.max(0,n),t-1)});if(e.includes(","))return e.split(",").map(s=>/^[A-Z]$/.test(s)?s.charCodeAt(0)-65:/^\d+$/.test(s)?parseInt(s)-1:0)}return Array.isArray(e)?e.map(s=>{if(typeof s=="number")return Math.min(Math.max(0,s),t-1);if(typeof s=="string"){if(/^[A-Z]$/.test(s))return s.charCodeAt(0)-65;if(/^\d+$/.test(s))return parseInt(s)-1}return 0}):0}}class ct{constructor(){w(this,"parsers",[]);this.register(new lt),this.register(new ut),this.register(new Ae)}register(e){this.parsers.push(e)}parse(e,t){let s=e;if(typeof e=="string")try{s=JSON.parse(e)}catch{}for(const n of this.parsers)if(n.canParse(s))return n.parse(s,t);return new Ae().parse(s,t)}}const Ee=new ct;function pn(h,e){return Ee.parse(h,e)}function de(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let J=de();function Qe(h){J=h}const K={exec:()=>null};function v(h,e=""){let t=typeof h=="string"?h:h.source;const s={replace:(n,i)=>{let r=typeof i=="string"?i:i.source;return r=r.replace(P.caret,"$1"),t=t.replace(n,r),s},getRegex:()=>new RegExp(t,e)};return s}const P={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:h=>new RegExp(`^( {0,3}${h})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}#`),htmlBeginRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}<(?:[a-z].*>|!--)`,"i")},pt=/^(?:[ \t]*(?:\n|$))+/,ht=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,gt=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Y=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,ft=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,me=/(?:[*+-]|\d{1,9}[.)])/,De=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Oe=v(De).replace(/bull/g,me).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),dt=v(De).replace(/bull/g,me).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),be=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,mt=/^[^\n]+/,Se=/(?!\s*\])(?:\\.|[^\[\]\\])+/,bt=v(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Se).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),St=v(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,me).getRegex(),oe="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",ke=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,kt=v("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",ke).replace("tag",oe).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Be=v(be).replace("hr",Y).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",oe).getRegex(),yt=v(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Be).getRegex(),ye={blockquote:yt,code:ht,def:bt,fences:gt,heading:ft,hr:Y,html:kt,lheading:Oe,list:St,newline:pt,paragraph:Be,table:K,text:mt},qe=v("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Y).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",oe).getRegex(),xt={...ye,lheading:dt,table:qe,paragraph:v(be).replace("hr",Y).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",qe).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",oe).getRegex()},wt={...ye,html:v(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",ke).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:K,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:v(be).replace("hr",Y).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Oe).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},vt=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,_t=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Me=/^( {2,}|\\)\n(?!\s*$)/,zt=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ae=/[\p{P}\p{S}]/u,xe=/[\s\p{P}\p{S}]/u,je=/[^\s\p{P}\p{S}]/u,$t=v(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,xe).getRegex(),Ge=/(?!~)[\p{P}\p{S}]/u,At=/(?!~)[\s\p{P}\p{S}]/u,qt=/(?:[^\s\p{P}\p{S}]|~)/u,Ct=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Fe=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Pt=v(Fe,"u").replace(/punct/g,ae).getRegex(),It=v(Fe,"u").replace(/punct/g,Ge).getRegex(),Ue="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Tt=v(Ue,"gu").replace(/notPunctSpace/g,je).replace(/punctSpace/g,xe).replace(/punct/g,ae).getRegex(),Rt=v(Ue,"gu").replace(/notPunctSpace/g,qt).replace(/punctSpace/g,At).replace(/punct/g,Ge).getRegex(),Lt=v("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,je).replace(/punctSpace/g,xe).replace(/punct/g,ae).getRegex(),Nt=v(/\\(punct)/,"gu").replace(/punct/g,ae).getRegex(),Et=v(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Qt=v(ke).replace("(?:-->|$)","-->").getRegex(),Dt=v("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Qt).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),ne=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Ot=v(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",ne).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Je=v(/^!?\[(label)\]\[(ref)\]/).replace("label",ne).replace("ref",Se).getRegex(),Ze=v(/^!?\[(ref)\](?:\[\])?/).replace("ref",Se).getRegex(),Bt=v("reflink|nolink(?!\\()","g").replace("reflink",Je).replace("nolink",Ze).getRegex(),we={_backpedal:K,anyPunctuation:Nt,autolink:Et,blockSkip:Ct,br:Me,code:_t,del:K,emStrongLDelim:Pt,emStrongRDelimAst:Tt,emStrongRDelimUnd:Lt,escape:vt,link:Ot,nolink:Ze,punctuation:$t,reflink:Je,reflinkSearch:Bt,tag:Dt,text:zt,url:K},Mt={...we,link:v(/^!?\[(label)\]\((.*?)\)/).replace("label",ne).getRegex(),reflink:v(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",ne).getRegex()},ge={...we,emStrongRDelimAst:Rt,emStrongLDelim:It,url:v(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},jt={...ge,br:v(Me).replace("{2,}","*").getRegex(),text:v(ge.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},te={normal:ye,gfm:xt,pedantic:wt},Z={normal:we,gfm:ge,breaks:jt,pedantic:Mt},Gt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ce=h=>Gt[h];function E(h,e){if(e){if(P.escapeTest.test(h))return h.replace(P.escapeReplace,Ce)}else if(P.escapeTestNoEncode.test(h))return h.replace(P.escapeReplaceNoEncode,Ce);return h}function Pe(h){try{h=encodeURI(h).replace(P.percentDecode,"%")}catch{return null}return h}function Ie(h,e){var i;const t=h.replace(P.findPipe,(r,o,l)=>{let a=!1,c=o;for(;--c>=0&&l[c]==="\\";)a=!a;return a?"|":" |"}),s=t.split(P.splitPipe);let n=0;if(s[0].trim()||s.shift(),s.length>0&&!((i=s.at(-1))!=null&&i.trim())&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;n<s.length;n++)s[n]=s[n].trim().replace(P.slashPipe,"|");return s}function V(h,e,t){const s=h.length;if(s===0)return"";let n=0;for(;n<s&&h.charAt(s-n-1)===e;)n++;return h.slice(0,s-n)}function Ft(h,e){if(h.indexOf(e[1])===-1)return-1;let t=0;for(let s=0;s<h.length;s++)if(h[s]==="\\")s++;else if(h[s]===e[0])t++;else if(h[s]===e[1]&&(t--,t<0))return s;return-1}function Te(h,e,t,s,n){const i=e.href,r=e.title||null,o=h[1].replace(n.other.outputLinkReplace,"$1");if(h[0].charAt(0)!=="!"){s.state.inLink=!0;const l={type:"link",raw:t,href:i,title:r,text:o,tokens:s.inlineTokens(o)};return s.state.inLink=!1,l}return{type:"image",raw:t,href:i,title:r,text:o}}function Ut(h,e,t){const s=h.match(t.other.indentCodeCompensation);if(s===null)return e;const n=s[1];return e.split(`
`).map(i=>{const r=i.match(t.other.beginningSpace);if(r===null)return i;const[o]=r;return o.length>=n.length?i.slice(n.length):i}).join(`
`)}class ie{constructor(e){w(this,"options");w(this,"rules");w(this,"lexer");this.options=e||J}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const s=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:V(s,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const s=t[0],n=Ut(s,t[3]||"",this.rules);return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let s=t[2].trim();if(this.rules.other.endingHash.test(s)){const n=V(s,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(s=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:V(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let s=V(t[0],`
`).split(`
`),n="",i="";const r=[];for(;s.length>0;){let o=!1;const l=[];let a;for(a=0;a<s.length;a++)if(this.rules.other.blockquoteStart.test(s[a]))l.push(s[a]),o=!0;else if(!o)l.push(s[a]);else break;s=s.slice(a);const c=l.join(`
`),d=c.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${c}`:c,i=i?`${i}
${d}`:d;const f=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,r,!0),this.lexer.state.top=f,s.length===0)break;const S=r.at(-1);if((S==null?void 0:S.type)==="code")break;if((S==null?void 0:S.type)==="blockquote"){const _=S,x=_.raw+`
`+s.join(`
`),y=this.blockquote(x);r[r.length-1]=y,n=n.substring(0,n.length-_.raw.length)+y.raw,i=i.substring(0,i.length-_.text.length)+y.text;break}else if((S==null?void 0:S.type)==="list"){const _=S,x=_.raw+`
`+s.join(`
`),y=this.list(x);r[r.length-1]=y,n=n.substring(0,n.length-S.raw.length)+y.raw,i=i.substring(0,i.length-_.raw.length)+y.raw,s=x.substring(r.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:r,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let s=t[1].trim();const n=s.length>1,i={type:"list",raw:"",ordered:n,start:n?+s.slice(0,-1):"",loose:!1,items:[]};s=n?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=n?s:"[*+-]");const r=this.rules.other.listItemRegex(s);let o=!1;for(;e;){let a=!1,c="",d="";if(!(t=r.exec(e))||this.rules.block.hr.test(e))break;c=t[0],e=e.substring(c.length);let f=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,b=>" ".repeat(3*b.length)),S=e.split(`
`,1)[0],_=!f.trim(),x=0;if(this.options.pedantic?(x=2,d=f.trimStart()):_?x=t[1].length+1:(x=t[2].search(this.rules.other.nonSpaceChar),x=x>4?1:x,d=f.slice(x),x+=t[1].length),_&&this.rules.other.blankLine.test(S)&&(c+=S+`
`,e=e.substring(S.length+1),a=!0),!a){const b=this.rules.other.nextBulletRegex(x),k=this.rules.other.hrRegex(x),g=this.rules.other.fencesBeginRegex(x),A=this.rules.other.headingBeginRegex(x),B=this.rules.other.htmlBeginRegex(x);for(;e;){const Q=e.split(`
`,1)[0];let $;if(S=Q,this.options.pedantic?(S=S.replace(this.rules.other.listReplaceNesting,"  "),$=S):$=S.replace(this.rules.other.tabCharGlobal,"    "),g.test(S)||A.test(S)||B.test(S)||b.test(S)||k.test(S))break;if($.search(this.rules.other.nonSpaceChar)>=x||!S.trim())d+=`
`+$.slice(x);else{if(_||f.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||g.test(f)||A.test(f)||k.test(f))break;d+=`
`+S}!_&&!S.trim()&&(_=!0),c+=Q+`
`,e=e.substring(Q.length+1),f=$.slice(x)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(c)&&(o=!0));let y=null,p;this.options.gfm&&(y=this.rules.other.listIsTask.exec(d),y&&(p=y[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:c,task:!!y,checked:p,loose:!1,text:d,tokens:[]}),i.raw+=c}const l=i.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let a=0;a<i.items.length;a++)if(this.lexer.state.top=!1,i.items[a].tokens=this.lexer.blockTokens(i.items[a].text,[]),!i.loose){const c=i.items[a].tokens.filter(f=>f.type==="space"),d=c.length>0&&c.some(f=>this.rules.other.anyLine.test(f.raw));i.loose=d}if(i.loose)for(let a=0;a<i.items.length;a++)i.items[a].loose=!0;return i}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const s=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:n,title:i}}}table(e){var o;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const s=Ie(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(o=t[3])!=null&&o.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],r={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===n.length){for(const l of n)this.rules.other.tableAlignRight.test(l)?r.align.push("right"):this.rules.other.tableAlignCenter.test(l)?r.align.push("center"):this.rules.other.tableAlignLeft.test(l)?r.align.push("left"):r.align.push(null);for(let l=0;l<s.length;l++)r.header.push({text:s[l],tokens:this.lexer.inline(s[l]),header:!0,align:r.align[l]});for(const l of i)r.rows.push(Ie(l,r.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:r.align[c]})));return r}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const s=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(s)){if(!this.rules.other.endAngleBracket.test(s))return;const r=V(s.slice(0,-1),"\\");if((s.length-r.length)%2===0)return}else{const r=Ft(t[2],"()");if(r>-1){const l=(t[0].indexOf("!")===0?5:4)+t[1].length+r;t[2]=t[2].substring(0,r),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let n=t[2],i="";if(this.options.pedantic){const r=this.rules.other.pedanticHrefTitle.exec(n);r&&(n=r[1],i=r[3])}else i=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(s)?n=n.slice(1):n=n.slice(1,-1)),Te(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){const n=(s[2]||s[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[n.toLowerCase()];if(!i){const r=s[0].charAt(0);return{type:"text",raw:r,text:r}}return Te(s,i,s[0],this.lexer,this.rules)}}emStrong(e,t,s=""){let n=this.rules.inline.emStrongLDelim.exec(e);if(!n||n[3]&&s.match(this.rules.other.unicodeAlphaNumeric))return;if(!(n[1]||n[2]||"")||!s||this.rules.inline.punctuation.exec(s)){const r=[...n[0]].length-1;let o,l,a=r,c=0;const d=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*e.length+r);(n=d.exec(t))!=null;){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(l=[...o].length,n[3]||n[4]){a+=l;continue}else if((n[5]||n[6])&&r%3&&!((r+l)%3)){c+=l;continue}if(a-=l,a>0)continue;l=Math.min(l,l+a+c);const f=[...n[0]][0].length,S=e.slice(0,r+n.index+f+l);if(Math.min(r,l)%2){const x=S.slice(1,-1);return{type:"em",raw:S,text:x,tokens:this.lexer.inlineTokens(x)}}const _=S.slice(2,-2);return{type:"strong",raw:S,text:_,tokens:this.lexer.inlineTokens(_)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let s=t[2].replace(this.rules.other.newLineCharGlobal," ");const n=this.rules.other.nonSpaceChar.test(s),i=this.rules.other.startingSpaceChar.test(s)&&this.rules.other.endingSpaceChar.test(s);return n&&i&&(s=s.substring(1,s.length-1)),{type:"codespan",raw:t[0],text:s}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let s,n;return t[2]==="@"?(s=t[1],n="mailto:"+s):(s=t[1],n=s),{type:"link",raw:t[0],text:s,href:n,tokens:[{type:"text",raw:s,text:s}]}}}url(e){var s;let t;if(t=this.rules.inline.url.exec(e)){let n,i;if(t[2]==="@")n=t[0],i="mailto:"+n;else{let r;do r=t[0],t[0]=((s=this.rules.inline._backpedal.exec(t[0]))==null?void 0:s[0])??"";while(r!==t[0]);n=t[0],t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const s=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:s}}}}class L{constructor(e){w(this,"tokens");w(this,"options");w(this,"state");w(this,"tokenizer");w(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||J,this.options.tokenizer=this.options.tokenizer||new ie,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:P,block:te.normal,inline:Z.normal};this.options.pedantic?(t.block=te.pedantic,t.inline=Z.pedantic):this.options.gfm&&(t.block=te.gfm,this.options.breaks?t.inline=Z.breaks:t.inline=Z.gfm),this.tokenizer.rules=t}static get rules(){return{block:te,inline:Z}}static lex(e,t){return new L(t).lex(e)}static lexInline(e,t){return new L(t).inlineTokens(e)}lex(e){e=e.replace(P.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const s=this.inlineQueue[t];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],s=!1){var n,i,r;for(this.options.pedantic&&(e=e.replace(P.tabCharGlobal,"    ").replace(P.spaceLine,""));e;){let o;if((i=(n=this.options.extensions)==null?void 0:n.block)!=null&&i.some(a=>(o=a.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);const a=t.at(-1);o.raw.length===1&&a!==void 0?a.raw+=`
`:t.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);const a=t.at(-1);(a==null?void 0:a.type)==="paragraph"||(a==null?void 0:a.type)==="text"?(a.raw+=`
`+o.raw,a.text+=`
`+o.text,this.inlineQueue.at(-1).src=a.text):t.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);const a=t.at(-1);(a==null?void 0:a.type)==="paragraph"||(a==null?void 0:a.type)==="text"?(a.raw+=`
`+o.raw,a.text+=`
`+o.raw,this.inlineQueue.at(-1).src=a.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),t.push(o);continue}let l=e;if((r=this.options.extensions)!=null&&r.startBlock){let a=1/0;const c=e.slice(1);let d;this.options.extensions.startBlock.forEach(f=>{d=f.call({lexer:this},c),typeof d=="number"&&d>=0&&(a=Math.min(a,d))}),a<1/0&&a>=0&&(l=e.substring(0,a+1))}if(this.state.top&&(o=this.tokenizer.paragraph(l))){const a=t.at(-1);s&&(a==null?void 0:a.type)==="paragraph"?(a.raw+=`
`+o.raw,a.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(o),s=l.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);const a=t.at(-1);(a==null?void 0:a.type)==="text"?(a.raw+=`
`+o.raw,a.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(o);continue}if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var o,l,a;let s=e,n=null;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(n=this.tokenizer.rules.inline.reflinkSearch.exec(s))!=null;)c.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(n=this.tokenizer.rules.inline.anyPunctuation.exec(s))!=null;)s=s.slice(0,n.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(n=this.tokenizer.rules.inline.blockSkip.exec(s))!=null;)s=s.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let i=!1,r="";for(;e;){i||(r=""),i=!1;let c;if((l=(o=this.options.extensions)==null?void 0:o.inline)!=null&&l.some(f=>(c=f.call({lexer:this},e,t))?(e=e.substring(c.raw.length),t.push(c),!0):!1))continue;if(c=this.tokenizer.escape(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.tag(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.link(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(c.raw.length);const f=t.at(-1);c.type==="text"&&(f==null?void 0:f.type)==="text"?(f.raw+=c.raw,f.text+=c.text):t.push(c);continue}if(c=this.tokenizer.emStrong(e,s,r)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.codespan(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.br(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.del(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.autolink(e)){e=e.substring(c.raw.length),t.push(c);continue}if(!this.state.inLink&&(c=this.tokenizer.url(e))){e=e.substring(c.raw.length),t.push(c);continue}let d=e;if((a=this.options.extensions)!=null&&a.startInline){let f=1/0;const S=e.slice(1);let _;this.options.extensions.startInline.forEach(x=>{_=x.call({lexer:this},S),typeof _=="number"&&_>=0&&(f=Math.min(f,_))}),f<1/0&&f>=0&&(d=e.substring(0,f+1))}if(c=this.tokenizer.inlineText(d)){e=e.substring(c.raw.length),c.raw.slice(-1)!=="_"&&(r=c.raw.slice(-1)),i=!0;const f=t.at(-1);(f==null?void 0:f.type)==="text"?(f.raw+=c.raw,f.text+=c.text):t.push(c);continue}if(e){const f="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return t}}class re{constructor(e){w(this,"options");w(this,"parser");this.options=e||J}space(e){return""}code({text:e,lang:t,escaped:s}){var r;const n=(r=(t||"").match(P.notSpaceStart))==null?void 0:r[0],i=e.replace(P.endingNewline,"")+`
`;return n?'<pre><code class="language-'+E(n)+'">'+(s?i:E(i,!0))+`</code></pre>
`:"<pre><code>"+(s?i:E(i,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,s=e.start;let n="";for(let o=0;o<e.items.length;o++){const l=e.items[o];n+=this.listitem(l)}const i=t?"ol":"ul",r=t&&s!==1?' start="'+s+'"':"";return"<"+i+r+`>
`+n+"</"+i+`>
`}listitem(e){var s;let t="";if(e.task){const n=this.checkbox({checked:!!e.checked});e.loose?((s=e.tokens[0])==null?void 0:s.type)==="paragraph"?(e.tokens[0].text=n+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=n+" "+E(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):t+=n+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",s="";for(let i=0;i<e.header.length;i++)s+=this.tablecell(e.header[i]);t+=this.tablerow({text:s});let n="";for(let i=0;i<e.rows.length;i++){const r=e.rows[i];s="";for(let o=0;o<r.length;o++)s+=this.tablecell(r[o]);n+=this.tablerow({text:s})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),s=e.header?"th":"td";return(e.align?`<${s} align="${e.align}">`:`<${s}>`)+t+`</${s}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${E(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:s}){const n=this.parser.parseInline(s),i=Pe(e);if(i===null)return n;e=i;let r='<a href="'+e+'"';return t&&(r+=' title="'+E(t)+'"'),r+=">"+n+"</a>",r}image({href:e,title:t,text:s}){const n=Pe(e);if(n===null)return E(s);e=n;let i=`<img src="${e}" alt="${s}"`;return t&&(i+=` title="${E(t)}"`),i+=">",i}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:E(e.text)}}class ve{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class N{constructor(e){w(this,"options");w(this,"renderer");w(this,"textRenderer");this.options=e||J,this.options.renderer=this.options.renderer||new re,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ve}static parse(e,t){return new N(t).parse(e)}static parseInline(e,t){return new N(t).parseInline(e)}parse(e,t=!0){var n,i;let s="";for(let r=0;r<e.length;r++){const o=e[r];if((i=(n=this.options.extensions)==null?void 0:n.renderers)!=null&&i[o.type]){const a=o,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){s+=c||"";continue}}const l=o;switch(l.type){case"space":{s+=this.renderer.space(l);continue}case"hr":{s+=this.renderer.hr(l);continue}case"heading":{s+=this.renderer.heading(l);continue}case"code":{s+=this.renderer.code(l);continue}case"table":{s+=this.renderer.table(l);continue}case"blockquote":{s+=this.renderer.blockquote(l);continue}case"list":{s+=this.renderer.list(l);continue}case"html":{s+=this.renderer.html(l);continue}case"paragraph":{s+=this.renderer.paragraph(l);continue}case"text":{let a=l,c=this.renderer.text(a);for(;r+1<e.length&&e[r+1].type==="text";)a=e[++r],c+=`
`+this.renderer.text(a);t?s+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):s+=c;continue}default:{const a='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return s}parseInline(e,t=this.renderer){var n,i;let s="";for(let r=0;r<e.length;r++){const o=e[r];if((i=(n=this.options.extensions)==null?void 0:n.renderers)!=null&&i[o.type]){const a=this.options.extensions.renderers[o.type].call({parser:this},o);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){s+=a||"";continue}}const l=o;switch(l.type){case"escape":{s+=t.text(l);break}case"html":{s+=t.html(l);break}case"link":{s+=t.link(l);break}case"image":{s+=t.image(l);break}case"strong":{s+=t.strong(l);break}case"em":{s+=t.em(l);break}case"codespan":{s+=t.codespan(l);break}case"br":{s+=t.br(l);break}case"del":{s+=t.del(l);break}case"text":{s+=t.text(l);break}default:{const a='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return s}}class X{constructor(e){w(this,"options");w(this,"block");this.options=e||J}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?L.lex:L.lexInline}provideParser(){return this.block?N.parse:N.parseInline}}w(X,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class Jt{constructor(...e){w(this,"defaults",de());w(this,"options",this.setOptions);w(this,"parse",this.parseMarkdown(!0));w(this,"parseInline",this.parseMarkdown(!1));w(this,"Parser",N);w(this,"Renderer",re);w(this,"TextRenderer",ve);w(this,"Lexer",L);w(this,"Tokenizer",ie);w(this,"Hooks",X);this.use(...e)}walkTokens(e,t){var n,i;let s=[];for(const r of e)switch(s=s.concat(t.call(this,r)),r.type){case"table":{const o=r;for(const l of o.header)s=s.concat(this.walkTokens(l.tokens,t));for(const l of o.rows)for(const a of l)s=s.concat(this.walkTokens(a.tokens,t));break}case"list":{const o=r;s=s.concat(this.walkTokens(o.items,t));break}default:{const o=r;(i=(n=this.defaults.extensions)==null?void 0:n.childTokens)!=null&&i[o.type]?this.defaults.extensions.childTokens[o.type].forEach(l=>{const a=o[l].flat(1/0);s=s.concat(this.walkTokens(a,t))}):o.tokens&&(s=s.concat(this.walkTokens(o.tokens,t)))}}return s}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(s=>{const n={...s};if(n.async=this.defaults.async||n.async||!1,s.extensions&&(s.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){const r=t.renderers[i.name];r?t.renderers[i.name]=function(...o){let l=i.renderer.apply(this,o);return l===!1&&(l=r.apply(this,o)),l}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const r=t[i.level];r?r.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),n.extensions=t),s.renderer){const i=this.defaults.renderer||new re(this.defaults);for(const r in s.renderer){if(!(r in i))throw new Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;const o=r,l=s.renderer[o],a=i[o];i[o]=(...c)=>{let d=l.apply(i,c);return d===!1&&(d=a.apply(i,c)),d||""}}n.renderer=i}if(s.tokenizer){const i=this.defaults.tokenizer||new ie(this.defaults);for(const r in s.tokenizer){if(!(r in i))throw new Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;const o=r,l=s.tokenizer[o],a=i[o];i[o]=(...c)=>{let d=l.apply(i,c);return d===!1&&(d=a.apply(i,c)),d}}n.tokenizer=i}if(s.hooks){const i=this.defaults.hooks||new X;for(const r in s.hooks){if(!(r in i))throw new Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;const o=r,l=s.hooks[o],a=i[o];X.passThroughHooks.has(r)?i[o]=c=>{if(this.defaults.async)return Promise.resolve(l.call(i,c)).then(f=>a.call(i,f));const d=l.call(i,c);return a.call(i,d)}:i[o]=(...c)=>{let d=l.apply(i,c);return d===!1&&(d=a.apply(i,c)),d}}n.hooks=i}if(s.walkTokens){const i=this.defaults.walkTokens,r=s.walkTokens;n.walkTokens=function(o){let l=[];return l.push(r.call(this,o)),i&&(l=l.concat(i.call(this,o))),l}}this.defaults={...this.defaults,...n}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return L.lex(e,t??this.defaults)}parser(e,t){return N.parse(e,t??this.defaults)}parseMarkdown(e){return(s,n)=>{const i={...n},r={...this.defaults,...i},o=this.onError(!!r.silent,!!r.async);if(this.defaults.async===!0&&i.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof s>"u"||s===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));r.hooks&&(r.hooks.options=r,r.hooks.block=e);const l=r.hooks?r.hooks.provideLexer():e?L.lex:L.lexInline,a=r.hooks?r.hooks.provideParser():e?N.parse:N.parseInline;if(r.async)return Promise.resolve(r.hooks?r.hooks.preprocess(s):s).then(c=>l(c,r)).then(c=>r.hooks?r.hooks.processAllTokens(c):c).then(c=>r.walkTokens?Promise.all(this.walkTokens(c,r.walkTokens)).then(()=>c):c).then(c=>a(c,r)).then(c=>r.hooks?r.hooks.postprocess(c):c).catch(o);try{r.hooks&&(s=r.hooks.preprocess(s));let c=l(s,r);r.hooks&&(c=r.hooks.processAllTokens(c)),r.walkTokens&&this.walkTokens(c,r.walkTokens);let d=a(c,r);return r.hooks&&(d=r.hooks.postprocess(d)),d}catch(c){return o(c)}}}onError(e,t){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const n="<p>An error occurred:</p><pre>"+E(s.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(s);throw s}}}const U=new Jt;function z(h,e){return U.parse(h,e)}z.options=z.setOptions=function(h){return U.setOptions(h),z.defaults=U.defaults,Qe(z.defaults),z};z.getDefaults=de;z.defaults=J;z.use=function(...h){return U.use(...h),z.defaults=U.defaults,Qe(z.defaults),z};z.walkTokens=function(h,e){return U.walkTokens(h,e)};z.parseInline=U.parseInline;z.Parser=N;z.parser=N.parse;z.Renderer=re;z.TextRenderer=ve;z.Lexer=L;z.lexer=L.lex;z.Tokenizer=ie;z.Hooks=X;z.parse=z;z.options;z.setOptions;z.use;z.walkTokens;z.parseInline;N.parse;L.lex;var Ve=(h=>(h.NORMAL="normal",h.RANDOM="random",h.EXAM="exam",h.WRONG="wrong",h.REVIEW="review",h.RANGE="range",h))(Ve||{}),Zt=(h=>(h.LOCAL="local",h.ONLINE_IMPORT="online-import",h.REMOTE_IMPORT="remote-import",h.ONLINE="online",h.REMOTE="remote",h))(Zt||{}),Vt=(h=>(h.CACHE="cache",h.ONLINE="online",h.REMOTE="remote",h))(Vt||{});const ue="app_settings",He={darkMode:window.matchMedia("(prefers-color-scheme: dark)").matches,themeColor:"default",customColor:"#4caf50",fontSize:14,fontFamily:"sans-serif",animationEnabled:!1},We={autoSubmit:!1,autoNext:!1,allowSkip:!1,showNotesAfterAnswer:!1,lockAnswerAfterSubmit:!1,showCorrectAnswerImmediately:!1,showProgress:!1,swipeGestureEnabled:!1,randomMode:!1,reviewMode:!1,viewWrongAfterAll:!1,canEditQuestion:!1},D={enabled:!1,autoGenerate:!1,streamOutput:!1,autoSync:!1,apiUrl:"",apiKey:"",model:"",systemPrompt:"",temperature:.7,maxTokens:2e3,topP:1},Ke={owner:"",repo:"",branch:"main",path:"",token:"",forceSync:!1,syncQuizName:"",createRemoteRepo:!1},H={uiSettings:He,quizSettings:We,debugEnabled:!1,githubConfig:Ke,lastSyncTimestamp:0,apiPresets:[W(D)],activeApiPresetName:"Default"},ce={chapterIndex:"all",mode:"normal",rangeStart:1,rangeEnd:50,randomize:!1,wrongOnly:!1};function W(h,e="Default"){const t={...D,...h};return{name:e,...t}}class Ht{constructor(){w(this,"settings");w(this,"version","1.0");w(this,"listeners",new Map);w(this,"quizState",Re({quizData:null,config:{...ce},lastLoaded:{name:"",source:""},stats:{totalAnswered:0,correctCount:0,wrongCount:0,dailyActivity:[0,0,0,0,0,0,0]}}));w(this,"state",st(this.quizState));this.settings=this.loadSettings(),this.applyTheme(),this.initQuizFromStorage()}loadSettings(){try{const e=localStorage.getItem(ue);if(e){const t=JSON.parse(e);return this.mergeWithDefaults(t)}return{...H}}catch(e){console.error("加载配置失败:",e);const t={...H};return(!t.apiPresets||t.apiPresets.length===0)&&(t.apiPresets=[W(D)],t.activeApiPresetName="Default"),(!t.activeApiPresetName||!t.apiPresets.some(s=>s.name===t.activeApiPresetName))&&(t.activeApiPresetName=t.apiPresets[0].name),t}}mergeWithDefaults(e){var n;const t=e.apiPresets&&e.apiPresets.length>0?e.apiPresets.map(i=>({...D,...i})):[...H.apiPresets],s=e.activeApiPresetName&&t.some(i=>i.name===e.activeApiPresetName)?e.activeApiPresetName:((n=t[0])==null?void 0:n.name)||"Default";return{uiSettings:{...He,...e.uiSettings},quizSettings:{...We,...e.quizSettings},debugEnabled:e.debugEnabled??H.debugEnabled,githubConfig:{...Ke,...e.githubConfig},lastSyncTimestamp:e.lastSyncTimestamp??0,apiPresets:t,activeApiPresetName:s}}saveSettings(){try{localStorage.setItem(ue,JSON.stringify(this.settings)),this.notifyListeners("settings")}catch(e){console.error("保存配置失败:",e),m("保存配置失败: "+e.message,"error")}}applyTheme(){const{darkMode:e,fontSize:t,fontFamily:s}=this.settings.uiSettings;document.documentElement.setAttribute("theme",e?"dark":"light"),document.documentElement.style.setProperty("--font-size",`${t}px`),document.documentElement.style.setProperty("--font-family",s)}addListener(e,t){var s;this.listeners.has(e)||this.listeners.set(e,[]),(s=this.listeners.get(e))==null||s.push(t)}removeListener(e,t){if(this.listeners.has(e)){const s=this.listeners.get(e),n=(s==null?void 0:s.indexOf(t))??-1;n!==-1&&s&&s.splice(n,1)}}notifyListeners(e){const t=this.listeners.get(e);t&&t.forEach(s=>s()),e!=="settings"&&this.notifyListeners("settings")}getSettings(){const e={...this.settings};return(!e.apiPresets||e.apiPresets.length===0)&&(e.apiPresets=[W(D)],e.activeApiPresetName="Default"),(!e.activeApiPresetName||!e.apiPresets.some(t=>t.name===e.activeApiPresetName))&&(e.activeApiPresetName=e.apiPresets[0].name),e}updateSettings(e,t=!0){var n;const s={...this.settings,...e};Array.isArray(s.apiPresets)||(s.apiPresets=[...this.settings.apiPresets],s.apiPresets.length===0&&(s.apiPresets=[W(D)])),(!s.activeApiPresetName||!s.apiPresets.some(i=>i.name===s.activeApiPresetName))&&(s.activeApiPresetName=((n=s.apiPresets[0])==null?void 0:n.name)||"Default"),this.settings=s,this.saveSettings(),this.applyTheme(),t&&m("设置已保存","success"),this.notifyListeners("settings"),this.notifyListeners("api")}getUiSettings(){return{...this.settings.uiSettings}}updateUiSettings(e,t=!0){this.settings.uiSettings={...this.settings.uiSettings,...e},this.saveSettings(),this.applyTheme(),this.notifyListeners("ui"),t&&m("界面设置已保存","success")}toggleDarkMode(){const e=!this.settings.uiSettings.darkMode;this.updateUiSettings({darkMode:e})}setFontSize(e){this.updateUiSettings({fontSize:e})}getQuizSettings(){return{...this.settings.quizSettings}}updateQuizSettings(e,t=!0){this.settings.quizSettings={...this.settings.quizSettings,...e},this.saveSettings(),this.notifyListeners("quiz"),t&&m("测验设置已保存","success")}getApiConfig(){const e=this.settings.apiPresets.find(n=>n.name===this.settings.activeApiPresetName);if(!e)return console.warn(`活动预设 "${this.settings.activeApiPresetName}" 未找到，返回第一个预设。`),this.settings.apiPresets[0]?{...this.settings.apiPresets[0]}:{...D};const{name:t,...s}=e;return s}updateApiConfig(e,t=!0){const s=this.settings.apiPresets.findIndex(n=>n.name===this.settings.activeApiPresetName);if(s===-1){console.error(`无法更新：活动预设 "${this.settings.activeApiPresetName}" 未找到。`),m("更新API配置失败：未找到活动预设","error");return}this.settings.apiPresets[s]={...this.settings.apiPresets[s],...e},this.saveSettings(),this.notifyListeners("api"),t&&m(`API预设 "${this.settings.activeApiPresetName}" 已保存`,"success")}getApiPresets(){return JSON.parse(JSON.stringify(this.settings.apiPresets))}getActiveApiPresetName(){return this.settings.activeApiPresetName}addApiPreset(e,t){if(!e||e.trim()==="")return m("预设名称不能为空","error"),!1;if(e=e.trim(),this.settings.apiPresets.some(i=>i.name===e))return m(`预设名称 "${e}" 已存在`,"error"),!1;const s=t||this.settings.activeApiPresetName,n=this.settings.apiPresets.find(i=>i.name===s);if(n){const i={...n,name:e};this.settings.apiPresets.push(i)}else{console.error(`无法复制配置：源预设 "${s}" 未找到。将使用默认配置创建。`);const i=W({...D},e);this.settings.apiPresets.push(i)}return this.saveSettings(),this.notifyListeners("api"),m(`已添加预设 "${e}"`,"success"),!0}deleteApiPreset(e){if(this.settings.apiPresets.length<=1)return m("无法删除最后一个预设","warning"),!1;const t=this.settings.apiPresets.findIndex(s=>s.name===e);return t===-1?(m(`未找到要删除的预设 "${e}"`,"error"),!1):(this.settings.apiPresets.splice(t,1),this.settings.activeApiPresetName===e&&(this.settings.activeApiPresetName=this.settings.apiPresets[0].name,this.notifyListeners("api")),this.saveSettings(),this.notifyListeners("api"),m(`已删除预设 "${e}"`,"success"),!0)}setActiveApiPreset(e){return this.settings.apiPresets.some(s=>s.name===e)?(this.settings.activeApiPresetName!==e&&(this.settings.activeApiPresetName=e,this.saveSettings(),this.notifyListeners("api")),!0):(m(`未找到预设 "${e}"`,"error"),!1)}renameApiPreset(e,t){if(!t||t.trim()==="")return m("新预设名称不能为空","error"),!1;if(t=t.trim(),e===t)return!0;if(this.settings.apiPresets.some(n=>n.name===t))return m(`预设名称 "${t}" 已存在`,"error"),!1;const s=this.settings.apiPresets.findIndex(n=>n.name===e);return s===-1?(m(`未找到要重命名的预设 "${e}"`,"error"),!1):(this.settings.apiPresets[s].name=t,this.settings.activeApiPresetName===e&&(this.settings.activeApiPresetName=t),this.saveSettings(),this.notifyListeners("api"),m(`预设 "${e}" 已重命名为 "${t}"`,"success"),!0)}getGithubConfig(){return{...this.settings.githubConfig}}updateGithubConfig(e,t=!0){const s={owner:e.owner??this.settings.githubConfig.owner,repo:e.repo??this.settings.githubConfig.repo,branch:e.branch??this.settings.githubConfig.branch,path:e.path??this.settings.githubConfig.path,token:e.token??this.settings.githubConfig.token,forceSync:e.forceSync??this.settings.githubConfig.forceSync,syncQuizName:e.syncQuizName??this.settings.githubConfig.syncQuizName,createRemoteRepo:e.createRemoteRepo??this.settings.githubConfig.createRemoteRepo};this.settings.githubConfig=s,this.saveSettings(),this.settings.lastSyncTimestamp=Date.now(),this.notifyListeners("github"),t&&m("GitHub设置已保存","success")}getLastSyncTimestamp(){return this.settings.lastSyncTimestamp||0}updateSyncTimestamp(){this.settings.lastSyncTimestamp=Date.now(),this.saveSettings()}isDebugEnabled(){return!!this.settings.debugEnabled}setDebugEnabled(e,t=!0){this.settings.debugEnabled=e,this.saveSettings(),t&&m(e?"调试模式已启用":"调试模式已禁用","info")}exportConfig(){try{const e={timestamp:new Date().toISOString(),version:this.version,exportDate:new Date().toISOString(),generalSettings:{uiSettings:this.settings.uiSettings,debugEnabled:this.settings.debugEnabled},quizSettings:this.settings.quizSettings,apiPresets:this.settings.apiPresets,activeApiPresetName:this.settings.activeApiPresetName,repoSettings:this.settings.githubConfig,stats:{}},t=localStorage.getItem("userStats");t&&(e.stats=JSON.parse(t),e.statisticsData=JSON.parse(t));const s=JSON.stringify(e,null,2),n="data:application/json;charset=utf-8,"+encodeURIComponent(s),i=`elyxira-config-${new Date().toISOString().split("T")[0]}.json`,r=document.createElement("a");return r.setAttribute("href",n),r.setAttribute("download",i),r.click(),m("配置已导出","success"),i}catch(e){throw console.error("导出配置失败:",e),m(`导出配置失败: ${e.message}`,"error"),e}}importConfig(e){try{if(!this.validateConfigData(e))return m("无效的配置文件格式或版本不兼容","error"),!1;const t=e,s={...this.settings};return t.generalSettings&&(t.generalSettings.uiSettings&&(s.uiSettings={...this.settings.uiSettings,...t.generalSettings.uiSettings}),s.debugEnabled="debugEnabled"in t.generalSettings?!!t.generalSettings.debugEnabled:this.settings.debugEnabled),t.quizSettings&&(s.quizSettings={...this.settings.quizSettings,...t.quizSettings}),t.apiPresets&&Array.isArray(t.apiPresets)&&t.apiPresets.length>0&&(s.apiPresets=t.apiPresets.map(n=>{const i=typeof n.name=="string"&&n.name.trim()?n.name.trim():`Imported-${Date.now()}`;return{...D,...n,name:i}}),t.activeApiPresetName&&s.apiPresets.some(n=>n.name===t.activeApiPresetName)?s.activeApiPresetName=t.activeApiPresetName:s.activeApiPresetName=s.apiPresets[0].name),t.repoSettings&&(s.githubConfig={...this.settings.githubConfig,...t.repoSettings}),this.settings=s,this.saveSettings(),this.applyTheme(),(t.stats||t.statisticsData)&&localStorage.setItem("userStats",JSON.stringify(t.stats||t.statisticsData)),this.notifyListeners("settings"),this.notifyListeners("ui"),this.notifyListeners("quiz"),this.notifyListeners("api"),this.notifyListeners("github"),m("配置已成功导入","success"),!0}catch(t){return console.error("导入配置失败:",t),m("导入配置失败："+t.message,"error"),!1}}validateConfigData(e){if(!e||typeof e!="object")return!1;const t=e;return"timestamp"in t&&"version"in t&&typeof t.timestamp=="string"&&typeof t.version=="string"}resetAllSettings(){this.settings={...H},localStorage.removeItem(ue),localStorage.removeItem("userStats"),localStorage.removeItem("quizStats"),localStorage.removeItem("quizData"),localStorage.removeItem("lastLoadedQuiz"),localStorage.removeItem("cachedQuizList"),this.saveSettings(),this.applyTheme(),this.quizState.quizData=null,this.quizState.config={...ce},this.quizState.lastLoaded={name:"",source:""},this.quizState.stats={totalAnswered:0,correctCount:0,wrongCount:0,dailyActivity:[0,0,0,0,0,0,0]},this.notifyListeners("settings"),this.notifyListeners("ui"),this.notifyListeners("quiz"),this.notifyListeners("api"),this.notifyListeners("github"),m("所有设置已重置为默认值","success")}clearQuizCache(){try{let e=0;for(let t=localStorage.length-1;t>=0;t--){const s=localStorage.key(t);s&&(s.startsWith("quizCache_")||s==="cachedQuizList")&&(localStorage.removeItem(s),e++)}return e>0?m(`已清除 ${e} 项题库缓存`,"success"):m("没有找到题库缓存","info"),e>0}catch(e){return console.error("清除题库缓存失败:",e),m(`清除缓存失败: ${e.message}`,"error"),!1}}getCacheStats(){let e=0;const t=[];for(let s=0;s<localStorage.length;s++){const n=localStorage.key(s);if(n){const i=localStorage.getItem(n)||"",r=(n.length+i.length)*2;e+=r,n.startsWith("quizCache_")&&t.push({key:n.replace("quizCache_",""),size:r})}}return{totalSize:e,items:t}}saveQuizToStorage(e,t){const s=`quizCache_${e}`;localStorage.setItem(s,JSON.stringify(t))}loadQuizFromStorage(e){const t=`quizCache_${e}`,s=localStorage.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(n){return console.error(`解析缓存题库失败: ${e}`,n),null}}removeQuizFromStorage(e){const t=`quizCache_${e}`;localStorage.removeItem(t)}saveQuizList(e){localStorage.setItem("cachedQuizList",JSON.stringify(e))}loadQuizList(){const e=localStorage.getItem("cachedQuizList");if(!e)return[];try{return JSON.parse(e)}catch(t){return console.error("解析题库列表失败",t),[]}}saveLastLoadedQuiz(e,t){this.quizState.lastLoaded.name=e,this.quizState.lastLoaded.source=t,localStorage.setItem("lastLoadedQuiz",JSON.stringify({name:e,source:t}))}getLastLoadedQuiz(){if(this.quizState.lastLoaded.name)return{...this.quizState.lastLoaded};const e=localStorage.getItem("lastLoadedQuiz");if(!e)return null;try{return JSON.parse(e)}catch{return null}}clearAllQuizStorage(){this.loadQuizList().forEach(t=>{const s=`quizCache_${t.name}`;localStorage.removeItem(s)}),localStorage.removeItem("cachedQuizList"),localStorage.removeItem("lastLoadedQuiz"),localStorage.removeItem("quizData"),this.quizState.quizData=null,this.quizState.lastLoaded={name:"",source:""},this.quizState.config={...ce},m("已清除所有题库缓存","success")}getQuizData(){return this.quizState.quizData}setQuizData(e){this.quizState.quizData=e}getQuizConfig(){return{...this.quizState.config}}setQuizConfig(e){this.quizState.config={...this.quizState.config,...e},this.saveQuizConfigToStorage()}saveQuizConfigToStorage(){localStorage.setItem("selectedChapter",this.quizState.config.chapterIndex),localStorage.setItem("quizMode",this.quizState.config.mode),localStorage.setItem("rangeStart",this.quizState.config.rangeStart.toString()),localStorage.setItem("rangeEnd",this.quizState.config.rangeEnd.toString())}initQuizFromStorage(){try{const e=localStorage.getItem("quizData");if(e)this.quizState.quizData=JSON.parse(e);else return!1;const t=localStorage.getItem("lastLoadedQuiz");t&&(this.quizState.lastLoaded=JSON.parse(t));const s=localStorage.getItem("selectedChapter");s&&(this.quizState.config.chapterIndex=s);const n=localStorage.getItem("quizMode");n&&Object.values(Ve).includes(n)&&(this.quizState.config.mode=n);const i=localStorage.getItem("rangeStart");i&&(this.quizState.config.rangeStart=parseInt(i));const r=localStorage.getItem("rangeEnd");return r&&(this.quizState.config.rangeEnd=parseInt(r)),this.loadQuizStatsFromStorage(),!0}catch(e){return console.error("从本地存储恢复状态失败:",e),!1}}saveQuizState(){this.quizState.quizData&&(localStorage.setItem("quizData",JSON.stringify(this.quizState.quizData)),this.saveQuizConfigToStorage(),localStorage.setItem("lastLoadedQuiz",JSON.stringify(this.quizState.lastLoaded)),this.quizState.lastLoaded.name&&this.saveQuizToStorage(this.quizState.lastLoaded.name,this.quizState.quizData))}loadQuizStatsFromStorage(){try{const e=localStorage.getItem("quizStats");if(e){const t=JSON.parse(e);this.quizState.stats={...this.quizState.stats,...t}}}catch(e){console.error("加载统计数据失败:",e)}}saveQuizStatsToStorage(){localStorage.setItem("quizStats",JSON.stringify(this.quizState.stats))}updateQuizStats(e){e.totalAnswered!==void 0&&(this.quizState.stats.totalAnswered=e.totalAnswered),e.correctCount!==void 0&&(this.quizState.stats.correctCount=e.correctCount),e.wrongCount!==void 0&&(this.quizState.stats.wrongCount=e.wrongCount);const t=new Date().getDay();this.quizState.stats.dailyActivity[t]++,this.saveQuizStatsToStorage()}getQuizChapters(){return!this.quizState.quizData||!this.quizState.quizData.chapters?[]:this.quizState.quizData.chapters.map(e=>e.title)}getQuizTotalQuestions(){return!this.quizState.quizData||!this.quizState.quizData.chapters?0:this.quizState.quizData.chapters.reduce((e,t)=>{var s;return e+(((s=t.questions)==null?void 0:s.length)||0)},0)}getQuizAnsweredCount(){return this.quizState.stats.totalAnswered}getQuizCorrectCount(){return this.quizState.stats.correctCount}getQuizAccuracyRate(){const e=this.quizState.stats.totalAnswered;return e===0?"0%":Math.round(this.quizState.stats.correctCount/e*100)+"%"}clearCurrentQuiz(){this.quizState.quizData=null,this.quizState.lastLoaded={name:"",source:""},localStorage.removeItem("quizData"),localStorage.removeItem("lastLoadedQuiz")}async syncQuizFromGithub(e){try{const t=this.getGithubConfig();if(!this.validateGithubConfig(t))return m("GitHub配置不完整","error"),null;const s=t.path||"quizzes",n=`https://api.github.com/repos/${t.owner}/${t.repo}/contents/${s}?ref=${t.branch}`,i=await fetch(n,{headers:{Authorization:`token ${t.token}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)return m(`获取远程题库列表失败 (${i.status})`,"error"),null;const r=await i.json(),o=Array.isArray(r)?r.filter(y=>y.type==="file"&&(y.name.endsWith(".json")||y.name.endsWith(".txt"))):[];if(o.length===0)return m("远程仓库中未找到任何题库文件","error"),null;let l=o.find(y=>y.name===`${e}.json`||y.name===`${e}.txt`);if(l||(l=o.find(y=>y.name.toLowerCase().includes(e.toLowerCase()))),!l){if(m(`远程仓库中未找到匹配的题库：${e}`,"error"),o.length>0){const y=o.map(p=>p.name.replace(/\.(json|txt)$/,"")).join(", ");console.info(`远程仓库中可用的题库: ${y}`)}return null}const a=await fetch(l.download_url);if(!a.ok)return m("下载题库内容失败","error"),null;const c=await a.text();let d;try{d=JSON.parse(c)}catch{return m("解析题库数据失败：无效的JSON格式","error"),null}if(!this.validateQuizData(d))return m("无效的题库数据格式","error"),null;const f=l.name.replace(/\.(json|txt)$/,"");this.saveQuizToStorage(f,d);const S=this.loadQuizList(),_=S.findIndex(y=>y.name===f&&y.source==="remote-import"),x={id:`remote-import-${Date.now()}`,name:f,path:"localStorage",source:"remote-import",info:`从GitHub同步：${t.owner}/${t.repo}`,title:d.title||f,lastModified:Date.now(),data:d};return _>=0?S[_]=x:S.push(x),this.saveQuizList(S),this.updateSyncTimestamp(),m(`成功从GitHub同步题库：${f}`,"success"),d}catch(t){return m(`同步题库失败：${t.message}`,"error"),null}}async pushQuizToGithub(e,t){try{const s=this.getGithubConfig();if(!this.validateGithubConfig(s))return m("GitHub配置不完整","error"),!1;const n=this.loadQuizFromStorage(e);if(!n)return m(`本地未找到题库：${e}`,"error"),!1;const i=`quizzes/${e}.json`,r=`https://api.github.com/repos/${s.owner}/${s.repo}/contents/${i}`;let o=null;try{const f=await fetch(`${r}?ref=${s.branch}`,{headers:{Authorization:`token ${s.token}`,Accept:"application/vnd.github.v3+json"}});f.ok&&(o=(await f.json()).sha)}catch{}const l=JSON.stringify(n,null,2),a=btoa(unescape(encodeURIComponent(l))),c={message:o?`更新题库：${e}`:`添加题库：${e}`,content:a,branch:s.branch};o&&(c.sha=o);const d=await fetch(r,{method:"PUT",headers:{Authorization:`token ${s.token}`,"Content-Type":"application/json",Accept:"application/vnd.github.v3+json"},body:JSON.stringify(c)});if(!d.ok){const f=await d.json();return m(`推送题库失败 (${d.status}): ${f.message||"未知错误"}`,"error"),!1}return this.updateSyncTimestamp(),m(`成功推送题库到GitHub：${e}`,"success"),!0}catch(s){return m(`推送题库失败：${s.message}`,"error"),!1}}validateGithubConfig(e){return!!(e.owner&&e.repo&&e.token&&e.branch)}validateQuizData(e){if(!e||typeof e!="object")return!1;const t=e;if(!Array.isArray(t.chapters))return!1;for(const s of t.chapters){if(typeof s!="object"||typeof s.title!="string"||!Array.isArray(s.questions))return!1;for(const n of s.questions)if(typeof n!="object"||typeof n.title!="string"||!Array.isArray(n.options)||n.answer===void 0)return!1}return!0}saveGeneralSettings(e){this.updateUiSettings(e.uiSettings,!1),this.updateQuizSettings(e.quizSettings,!1),this.setDebugEnabled(e.debugEnabled,!1),this.notifyListeners("settings"),m("通用设置已保存","success")}saveNoteToQuestion(e,t){if(!this.quizState.quizData||!e)return!1;const s=this.findQuestionById(e);return s?(s.notes=t,this.saveQuizToStorage(this.quizState.quizData.title,this.quizState.quizData),!0):!1}getNoteByQuestionId(e){if(!e)return"";const t=this.findQuestionById(e);return(t==null?void 0:t.notes)||""}async renderNote(e,t,s){const n=e||"";if(!n&&!t)return{contentHtml:'<p class="page-quiz__notes-placeholder">这道题目还没有笔记...</p>'};let i=n?await s.parse(n):"";return i||(i=t?'<p class="page-quiz__notes-placeholder">思考中...</p>':'<p class="page-quiz__notes-placeholder">这道题目还没有笔记...</p>'),{contentHtml:i}}findQuestionById(e){if(!(!this.quizState.quizData||!e))for(const t of this.quizState.quizData.chapters){const s=t.questions.find(n=>n.id===e);if(s)return s}}formatNote(e){return e.trim()}getNotesGenerationRequestParams(e){const t=this.getApiConfig(),s=t.model||"",n=t.temperature||.7,i=t.maxTokens||2e3,r=t.topP||1,o=t.systemPrompt||"";let l=`<question>
${e.title}

`;if(e.options&&e.options.length>0&&e.options.forEach((d,f)=>{const S=String.fromCharCode(65+f);l+=`${S}. ${d}
`}),e.answer!==void 0){let d="";Array.isArray(e.answer)?d=e.answer.map(f=>typeof f=="number"?String.fromCharCode(65+f):f).join(", "):typeof e.answer=="number"?d=String.fromCharCode(65+e.answer):d=e.answer,l+=`
正确答案: ${d}`}return e.explanation&&(l+=`
解析: ${e.explanation}`),l+=`
</question>
请严格根据提示词生成本题的笔记内容。`,{model:s,messages:[{role:"system",content:o},{role:"user",content:l}],max_tokens:i,temperature:n,top_p:r,stream:t.streamOutput??!1,user:"elyxira-quiz-user"}}parseTextQuiz(e){const t=e.split(`
`).filter(o=>o.trim()),s=t[0]||"未命名题库",n=[];let i={title:"默认章节",questions:[]},r=null;for(let o=1;o<t.length;o++){const l=t[o].trim();if(l.startsWith("## "))i.questions.length>0&&n.push(i),i={title:l.substring(3),questions:[]},r=null;else if(l.match(/^\d+\./))r&&i.questions.push(r),r={id:`q-${Date.now()}-${Math.random().toString(36).slice(2)}`,title:l.substring(l.indexOf(".")+1).trim(),options:[],answer:0,explanation:""};else if(l.startsWith("- ")&&r)r.options.push(l.substring(2).trim());else if(l.startsWith("答案:")&&r){const a=l.substring(3).trim();r.answer=parseInt(a)-1||0}else l.startsWith("解析:")&&r&&(r.explanation=l.substring(3).trim())}return r&&i.questions.push(r),i.questions.length>0&&n.push(i),{title:s,chapters:n,description:"从文本导入",lastModified:Date.now()}}enhancedValidQuizData(e){try{const t=Ee.parse(e);return!t||!Array.isArray(t.chapters)||t.chapters.length===0?(console.error("验证失败: 解析后数据缺少有效章节"),!1):(t.chapters.some(n=>Array.isArray(n.questions)&&n.questions.length>0)||console.warn("解析后数据中没有题目"),!0)}catch(t){return console.error("题库数据验证失败:",t),!1}}async importConfigFromFile(e){return new Promise((t,s)=>{const n=new FileReader;n.onload=i=>{try{if(i.target&&typeof i.target.result=="string"){const r=JSON.parse(i.target.result);this.importConfig(r)?t(!0):s(new Error("Invalid config file format or content."))}else s(new Error("Failed to read file content."))}catch(r){console.error("Error parsing config file:",r),s(new Error("Failed to parse config file. Ensure it is valid JSON."))}},n.onerror=i=>{console.error("Error reading file:",i),s(new Error("Failed to read the selected file."))},n.readAsText(e)})}updateQuestion(e,t){if(!this.quizState.quizData||!e)return!1;for(const s of this.quizState.quizData.chapters){const n=s.questions.findIndex(i=>i.id===e);if(n!==-1)return s.questions[n]={...s.questions[n],...t,id:s.questions[n].id||e.toString()},this.saveQuizState(),!0}return console.warn(`未找到要更新的问题，ID: ${e}`),!1}}const C=new Ht,Wt={class:"modal__header"},Kt={class:"modal__title"},Xt={class:"modal__body"},Yt={key:0,class:"modal__footer"},se=fe({__name:"modal-base",props:{show:Boolean,title:{type:String,default:"提示"},contentClass:{type:String,default:""}},emits:["close"],setup(h){return(e,t)=>h.show?(T(),R("div",{key:0,class:"modal modal--active",onClick:t[1]||(t[1]=nt(s=>e.$emit("close"),["self"]))},[u("div",{class:pe(["modal__content",h.contentClass])},[u("div",Wt,[u("h2",Kt,G(h.title),1),u("button",{class:"modal__close",onClick:t[0]||(t[0]=s=>e.$emit("close")),title:"关闭"},"×")]),u("div",Xt,[ze(e.$slots,"default")]),e.$slots.footer?(T(),R("div",Yt,[ze(e.$slots,"footer")])):j("",!0)],2)])):j("",!0)}}),es={class:"modal__section"},ts={key:0,class:"modal__info-message"},ss={key:1,class:"modal__info-grid"},ns={class:"modal__info-item"},is={class:"modal__info-value"},rs={class:"modal__info-item"},os={class:"modal__info-value"},as={key:0,class:"modal__section"},ls={class:"modal__form-group"},us={key:0,class:"modal__form-group modal__form-group--switch"},cs={class:"modal__toggle-switch"},ps={key:1,class:"modal__form-description"},hs={class:"modal__form-group"},gs={class:"modal__form-group"},fs={class:"modal__form-group"},ds={class:"modal__form-group"},ms={class:"modal__form-group"},bs={class:"modal__form-group modal__form-group--switch"},Ss={class:"modal__toggle-switch"},ks={class:"modal__form-actions"},ys=["disabled"],xs=["disabled"],ws=["disabled"],hn=fe({__name:"modal-quiz-sync",props:{show:{type:Boolean,default:!1},currentQuiz:{type:Object,default:()=>({name:"",source:"",isLocal:!0,exists:!1})}},emits:["close","sync-complete","save"],setup(h,{emit:e}){const t=e,s=h,n={local:"本地题库",online:"在线题库",remote:"远程题库","online-import":"从在线导入","remote-import":"从远程导入"},i=O({owner:"",repo:"",branch:"main",path:"",token:"",forceSync:!0}),r=O(!1),o=O(!0),l=O(""),a=O(!1);function c(k){return k?`syncName_${k}`:null}const d=()=>{var g;const k=C.getGithubConfig();if(i.value={...k},o.value=!!k.forceSync,a.value=!!k.createRemoteRepo,(g=s.currentQuiz)!=null&&g.exists&&s.currentQuiz.name){const A=c(s.currentQuiz.name);A?l.value=localStorage.getItem(A)||s.currentQuiz.name||k.syncQuizName||"":l.value=s.currentQuiz.name||k.syncQuizName||""}else l.value=k.syncQuizName||""};Le(()=>{_(),C.addListener("github",d)}),Ne(()=>{C.removeListener("github",d)}),he(()=>s.currentQuiz,k=>{if(k!=null&&k.exists&&k.name){const g=c(k.name),A=g?localStorage.getItem(g):null;l.value=A||k.name||C.getGithubConfig().syncQuizName||""}else l.value=C.getGithubConfig().syncQuizName||""},{immediate:!0,deep:!0}),he(()=>s.show,k=>{k&&_()},{immediate:!0});const f=it(()=>!!i.value.owner&&!!i.value.repo);function S(k){if(!k)return"未知来源";const g=k.toLowerCase();return n[g]||k||"未知来源"}function _(){var g;const k=C.getGithubConfig();if(i.value={...k},o.value=!!k.forceSync,a.value=!!k.createRemoteRepo,(g=s.currentQuiz)!=null&&g.exists&&s.currentQuiz.name){const A=c(s.currentQuiz.name),B=A?localStorage.getItem(A):null;l.value=B||s.currentQuiz.name||k.syncQuizName||""}else l.value=k.syncQuizName||""}async function x(){if(!f.value){m("请填写必要的配置信息","error");return}r.value=!0;try{const{owner:k,repo:g,branch:A,path:B,token:Q}=i.value,$={};Q&&($.Authorization=`token ${Q}`);const Xe=`https://api.github.com/repos/${k}/${g}/contents/${B}?ref=${A}`,ee=await fetch(Xe,{headers:$});if(!ee.ok){const Ye=await ee.json();throw new Error(`GitHub API错误 (${ee.status}): ${Ye.message||"未知错误"}`)}const _e=await ee.json();Array.isArray(_e)?m(`成功连接到仓库，发现 ${_e.length} 个文件`,"success"):m("连接成功，但路径不是一个目录","warning")}catch(k){m(`连接失败: ${k.message}`,"error")}finally{r.value=!1}}function y(){p(),t("close")}function p(){var g;if(!f.value)return;if((g=s.currentQuiz)!=null&&g.exists&&s.currentQuiz.name){const A=c(s.currentQuiz.name);A&&l.value?localStorage.setItem(A,l.value):A&&localStorage.removeItem(A)}const k={...i.value,forceSync:o.value,syncQuizName:l.value,createRemoteRepo:a.value};C.updateGithubConfig(k),t("save",k)}async function b(){if(!f.value){m("请填写必要的配置信息","error");return}if(!l.value){m("请填写同步题库名称","error");return}r.value=!0;try{p(),await C.pushQuizToGithub(l.value,o.value)?(m(`成功推送题库: ${l.value}`,"success"),t("sync-complete",{action:"push",quiz:l.value,success:!0})):m("推送题库失败","error")}catch(k){m(`推送题库失败: ${k.message}`,"error")}finally{r.value=!1}}return(k,g)=>(T(),rt(se,{title:"仓库配置",show:h.show,onClose:g[9]||(g[9]=A=>k.$emit("close"))},{footer:M(()=>[u("button",{class:"modal__button modal__button--secondary",onClick:g[8]||(g[8]=A=>k.$emit("close"))},"取消"),u("button",{class:"modal__button modal__button--primary",onClick:y,disabled:!f.value},"保存配置",8,ws)]),default:M(()=>{var A,B,Q;return[u("div",es,[g[12]||(g[12]=u("h3",{class:"modal__section-title"},"当前题库信息",-1)),(A=h.currentQuiz)!=null&&A.exists?(T(),R("div",ss,[u("div",ns,[g[10]||(g[10]=u("span",{class:"modal__info-label"},"题库名称:",-1)),u("span",is,G(h.currentQuiz.name||"未命名题库"),1)]),u("div",rs,[g[11]||(g[11]=u("span",{class:"modal__info-label"},"来源类型:",-1)),u("span",os,G(S(h.currentQuiz.source)),1)])])):(T(),R("div",ts," 未处于刷题页面或未加载题库。 "))]),(B=h.currentQuiz)!=null&&B.exists?(T(),R("div",as,[u("div",ls,[g[13]||(g[13]=u("label",{for:"syncQuizName",class:"modal__form-label"},"同步题库名称",-1)),g[14]||(g[14]=u("div",{class:"modal__form-description"},"推送到远程仓库时使用的文件名",-1)),q(u("input",{type:"text",id:"syncQuizName","onUpdate:modelValue":g[0]||(g[0]=$=>l.value=$),placeholder:"例如: my-quiz",class:"modal__form-control"},null,512),[[F,l.value]])]),h.currentQuiz.isLocal?(T(),R("div",us,[g[16]||(g[16]=u("label",{class:"modal__form-label"},"创建远程仓库版本",-1)),u("label",cs,[q(u("input",{type:"checkbox","onUpdate:modelValue":g[1]||(g[1]=$=>a.value=$)},null,512),[[I,a.value]]),g[15]||(g[15]=u("span",{class:"modal__toggle-slider"},null,-1))])])):j("",!0),h.currentQuiz.isLocal?(T(),R("div",ps,"将本地题库推送到远程仓库，创建线上副本")):j("",!0)])):j("",!0),g[25]||(g[25]=u("div",{class:"modal__separator"},null,-1)),g[26]||(g[26]=u("h3",{class:"modal__section-title"},"GitHub 仓库设置",-1)),u("div",hs,[g[17]||(g[17]=u("label",{for:"githubOwner",class:"modal__form-label"},"GitHub 用户名或组织",-1)),q(u("input",{type:"text",id:"githubOwner","onUpdate:modelValue":g[2]||(g[2]=$=>i.value.owner=$),placeholder:"例如: username",class:"modal__form-control"},null,512),[[F,i.value.owner]])]),u("div",gs,[g[18]||(g[18]=u("label",{for:"githubRepo",class:"modal__form-label"},"仓库名称",-1)),q(u("input",{type:"text",id:"githubRepo","onUpdate:modelValue":g[3]||(g[3]=$=>i.value.repo=$),placeholder:"例如: quiz-data",class:"modal__form-control"},null,512),[[F,i.value.repo]])]),u("div",fs,[g[19]||(g[19]=u("label",{for:"githubBranch",class:"modal__form-label"},"分支名称",-1)),q(u("input",{type:"text",id:"githubBranch","onUpdate:modelValue":g[4]||(g[4]=$=>i.value.branch=$),placeholder:"例如: main",class:"modal__form-control"},null,512),[[F,i.value.branch]])]),u("div",ds,[g[20]||(g[20]=u("label",{for:"githubPath",class:"modal__form-label"},"仓库路径 (可选)",-1)),q(u("input",{type:"text",id:"githubPath","onUpdate:modelValue":g[5]||(g[5]=$=>i.value.path=$),placeholder:"例如: quizzes/",class:"modal__form-control"},null,512),[[F,i.value.path]])]),u("div",ms,[g[21]||(g[21]=u("label",{for:"githubToken",class:"modal__form-label"},"个人访问令牌 (PAT)",-1)),g[22]||(g[22]=u("div",{class:"modal__form-description"},"用于读写私有仓库或进行推送操作",-1)),q(u("input",{type:"password",id:"githubToken","onUpdate:modelValue":g[6]||(g[6]=$=>i.value.token=$),placeholder:"ghp_xxxxxx",class:"modal__form-control"},null,512),[[F,i.value.token]])]),u("div",bs,[g[24]||(g[24]=u("label",{class:"modal__form-label"},"强制同步 (覆盖远程)",-1)),u("label",Ss,[q(u("input",{type:"checkbox","onUpdate:modelValue":g[7]||(g[7]=$=>o.value=$)},null,512),[[I,o.value]]),g[23]||(g[23]=u("span",{class:"modal__toggle-slider"},null,-1))])]),g[27]||(g[27]=u("div",{class:"modal__form-description"},"同步时不检查冲突，直接覆盖远程仓库内容",-1)),u("div",ks,[u("button",{class:"modal__button modal__button--primary",onClick:x,disabled:r.value},G(r.value?"测试中...":"测试连接"),9,ys),(Q=h.currentQuiz)!=null&&Q.exists?(T(),R("button",{key:0,class:"modal__button modal__button--success",onClick:b,disabled:r.value||!f.value},G(r.value?"推送中...":"推送到GitHub"),9,xs)):j("",!0)])]}),_:1},8,["show"]))}}),vs={class:"modal__settings-tabs"},_s={key:0,class:"modal__tab-container"},zs={class:"modal__settings-group"},$s={class:"modal__setting-item"},As={class:"modal__toggle-switch"},qs={class:"modal__setting-item"},Cs={class:"modal__toggle-switch"},Ps={class:"modal__settings-group"},Is={class:"modal__setting-item"},Ts={class:"modal__toggle-switch"},Rs={class:"modal__setting-item"},Ls={class:"modal__toggle-switch"},Ns={class:"modal__setting-item"},Es={class:"modal__toggle-switch"},Qs={class:"modal__setting-item"},Ds={class:"modal__toggle-switch"},Os={class:"modal__settings-group"},Bs={class:"modal__setting-item"},Ms={class:"modal__toggle-switch"},js={class:"modal__setting-item"},Gs={class:"modal__toggle-switch"},Fs={class:"modal__settings-group"},Us={class:"modal__setting-item"},Js={class:"modal__toggle-switch"},Zs={class:"modal__setting-item"},Vs={class:"modal__toggle-switch"},Hs={key:1,class:"modal__tab-container"},Ws={class:"modal__settings-group"},Ks={class:"modal__setting-item"},Xs={class:"modal__form-input-group"},Ys={class:"modal__setting-item"},en=["value"],tn={class:"modal__setting-item"},sn={class:"modal__toggle-switch"},nn={class:"modal__settings-group"},rn={class:"modal__setting-item"},on={class:"modal__toggle-switch"},an={class:"modal__body"},ln={class:"modal__body"},gn=fe({__name:"modal-settings",props:{show:{type:Boolean},"ui-settings":{},"quiz-settings":{},"debug-enabled":{type:Boolean}},emits:["close","save"],setup(h,{emit:e}){const t=[{name:"系统默认 (sans-serif)",value:"sans-serif"},{name:"系统默认 (serif)",value:"serif"},{name:"系统默认 (monospace)",value:"monospace"},{name:"苹方 (PingFang SC)",value:"'PingFang SC', sans-serif"},{name:"微软雅黑 (Microsoft YaHei)",value:"'Microsoft YaHei', sans-serif"},{name:"思源黑体 (Noto Sans SC)",value:"'Noto Sans SC', sans-serif"},{name:"霞鹜文楷 (LXGW WenKai)",value:"'LXGW WenKai', cursive"},{name:"JetBrains Mono",value:"'JetBrains Mono', monospace"},{name:"Fira Code",value:"'Fira Code', monospace"},{name:"IBM Plex Sans",value:"'IBM Plex Sans', sans-serif"},{name:"Roboto Mono",value:"'Roboto Mono', monospace"},{name:"更纱黑体 (Sarasa Gothic)",value:"'Sarasa Gothic SC', sans-serif"}],s=h,n=e,i=O("quiz"),r=O(!1),o=O(!1),l=O(""),a=Re(JSON.parse(JSON.stringify(C.getSettings()))),c=()=>{Object.assign(a,JSON.parse(JSON.stringify(C.getSettings())))};Le(()=>{C.addListener("settings",c)}),Ne(()=>{C.removeListener("settings",c)}),he(()=>s.show,y=>{if(y){const p=JSON.parse(JSON.stringify(C.getSettings()));s["ui-settings"]&&(p.uiSettings={...p.uiSettings,...s["ui-settings"]}),s["quiz-settings"]&&(p.quizSettings={...p.quizSettings,...s["quiz-settings"]}),s["debug-enabled"]!==void 0&&(p.debugEnabled=s["debug-enabled"]),Object.assign(a,p)}},{immediate:!0});function d(){C.updateSettings(JSON.parse(JSON.stringify(a))),n("save",JSON.parse(JSON.stringify(a))),n("close")}function f(){r.value=!0}function S(y){const p=y.target;!p.files||p.files.length}function _(){const y=document.getElementById("importFileInput");if(!y.files||y.files.length===0){m("请选择要导入的配置文件","warning");return}const p=y.files[0];C.importConfigFromFile(p).then(b=>{b&&(r.value=!1,setTimeout(()=>{window.location.reload()},1500))}).catch(b=>{m("导入配置失败："+b.message,"error")})}function x(){try{C.exportConfig(),o.value=!0,l.value=new Date().toISOString()}catch(y){console.error("导出配置失败:",y)}}return(y,p)=>(T(),R($e,null,[le(se,{show:y.show,title:"设置","content-class":"modal__content--settings",onClose:p[17]||(p[17]=b=>y.$emit("close"))},{footer:M(()=>[u("button",{onClick:p[16]||(p[16]=b=>y.$emit("close")),class:"modal__button modal__button--secondary"},"取消"),u("button",{onClick:d,class:"modal__button modal__button--primary"},"保存设置")]),default:M(()=>[u("div",vs,[u("button",{class:pe(["modal__settings-tab",{"modal__settings-tab--active":i.value==="quiz"}]),onClick:p[0]||(p[0]=b=>i.value="quiz")},"刷题设置",2),u("button",{class:pe(["modal__settings-tab",{"modal__settings-tab--active":i.value==="general"}]),onClick:p[1]||(p[1]=b=>i.value="general")},"通用设置",2)]),i.value==="quiz"?(T(),R("div",_s,[u("div",zs,[p[26]||(p[26]=u("h3",{class:"modal__settings-group-title"},"模式",-1)),u("div",$s,[p[23]||(p[23]=u("span",{class:"modal__setting-item-name"},"随机刷题",-1)),u("label",As,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[2]||(p[2]=b=>a.quizSettings.randomMode=b)},null,512),[[I,a.quizSettings.randomMode]]),p[22]||(p[22]=u("span",{class:"modal__toggle-slider"},null,-1))])]),u("div",qs,[p[25]||(p[25]=u("span",{class:"modal__setting-item-name"},"背题模式",-1)),u("label",Cs,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[3]||(p[3]=b=>a.quizSettings.reviewMode=b)},null,512),[[I,a.quizSettings.reviewMode]]),p[24]||(p[24]=u("span",{class:"modal__toggle-slider"},null,-1))])])]),u("div",Ps,[p[35]||(p[35]=u("h3",{class:"modal__settings-group-title"},"交互",-1)),u("div",Is,[p[28]||(p[28]=u("span",{class:"modal__setting-item-name"},"选择后自动提交",-1)),u("label",Ts,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[4]||(p[4]=b=>a.quizSettings.autoSubmit=b)},null,512),[[I,a.quizSettings.autoSubmit]]),p[27]||(p[27]=u("span",{class:"modal__toggle-slider"},null,-1))])]),u("div",Rs,[p[30]||(p[30]=u("span",{class:"modal__setting-item-name"},"提交后自动下一题",-1)),u("label",Ls,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[5]||(p[5]=b=>a.quizSettings.autoNext=b)},null,512),[[I,a.quizSettings.autoNext]]),p[29]||(p[29]=u("span",{class:"modal__toggle-slider"},null,-1))])]),u("div",Ns,[p[32]||(p[32]=u("span",{class:"modal__setting-item-name"},"允许跳过未答题目",-1)),u("label",Es,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[6]||(p[6]=b=>a.quizSettings.allowSkip=b)},null,512),[[I,a.quizSettings.allowSkip]]),p[31]||(p[31]=u("span",{class:"modal__toggle-slider"},null,-1))])]),u("div",Qs,[p[34]||(p[34]=u("span",{class:"modal__setting-item-name"},"滑动手势切换",-1)),u("label",Ds,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[7]||(p[7]=b=>a.quizSettings.swipeGestureEnabled=b)},null,512),[[I,a.quizSettings.swipeGestureEnabled]]),p[33]||(p[33]=u("span",{class:"modal__toggle-slider"},null,-1))])])]),u("div",Os,[p[40]||(p[40]=u("h3",{class:"modal__settings-group-title"},"显示",-1)),u("div",Bs,[p[37]||(p[37]=u("span",{class:"modal__setting-item-name"},"回答后显示笔记",-1)),u("label",Ms,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[8]||(p[8]=b=>a.quizSettings.showNotesAfterAnswer=b)},null,512),[[I,a.quizSettings.showNotesAfterAnswer]]),p[36]||(p[36]=u("span",{class:"modal__toggle-slider"},null,-1))])]),u("div",js,[p[39]||(p[39]=u("span",{class:"modal__setting-item-name"},"显示进度条/正确率",-1)),u("label",Gs,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[9]||(p[9]=b=>a.quizSettings.showProgress=b)},null,512),[[I,a.quizSettings.showProgress]]),p[38]||(p[38]=u("span",{class:"modal__toggle-slider"},null,-1))])])]),u("div",Fs,[p[45]||(p[45]=u("h3",{class:"modal__settings-group-title"},"答案行为",-1)),u("div",Us,[p[42]||(p[42]=u("span",{class:"modal__setting-item-name"},"提交后不允许更改",-1)),u("label",Js,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[10]||(p[10]=b=>a.quizSettings.lockAnswerAfterSubmit=b)},null,512),[[I,a.quizSettings.lockAnswerAfterSubmit]]),p[41]||(p[41]=u("span",{class:"modal__toggle-slider"},null,-1))])]),u("div",Zs,[p[44]||(p[44]=u("span",{class:"modal__setting-item-name"},"提交后立即显示正确答案",-1)),u("label",Vs,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[11]||(p[11]=b=>a.quizSettings.showCorrectAnswerImmediately=b)},null,512),[[I,a.quizSettings.showCorrectAnswerImmediately]]),p[43]||(p[43]=u("span",{class:"modal__toggle-slider"},null,-1))])])])])):j("",!0),i.value==="general"?(T(),R("div",Hs,[u("div",Ws,[p[50]||(p[50]=u("h3",{class:"modal__settings-group-title"},"显示",-1)),u("div",Ks,[p[46]||(p[46]=u("span",{class:"modal__setting-item-name"},"字体大小",-1)),u("div",Xs,[q(u("input",{type:"range","onUpdate:modelValue":p[12]||(p[12]=b=>a.uiSettings.fontSize=b),min:"12",max:"20",step:"1"},null,512),[[F,a.uiSettings.fontSize,void 0,{number:!0}]]),u("span",null,G(a.uiSettings.fontSize)+"px",1)])]),u("div",Ys,[p[47]||(p[47]=u("span",{class:"modal__setting-item-name"},"字体选择",-1)),q(u("select",{"onUpdate:modelValue":p[13]||(p[13]=b=>a.uiSettings.fontFamily=b),class:"modal__select-styled"},[(T(),R($e,null,ot(t,b=>u("option",{key:b.value,value:b.value},G(b.name),9,en)),64))],512),[[at,a.uiSettings.fontFamily]])]),u("div",tn,[p[49]||(p[49]=u("span",{class:"modal__setting-item-name"},"启用动画效果",-1)),u("label",sn,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[14]||(p[14]=b=>a.uiSettings.animationEnabled=b)},null,512),[[I,a.uiSettings.animationEnabled]]),p[48]||(p[48]=u("span",{class:"modal__toggle-slider"},null,-1))])])]),u("div",{class:"modal__settings-group"},[p[53]||(p[53]=u("h3",{class:"modal__settings-group-title"},"数据管理",-1)),u("div",{class:"modal__setting-item"},[p[51]||(p[51]=u("span",{class:"modal__setting-item-name"},"导出配置",-1)),u("button",{class:"modal__button modal__button--secondary",onClick:x}," 导出为JSON ")]),u("div",{class:"modal__setting-item"},[p[52]||(p[52]=u("span",{class:"modal__setting-item-name"},"导入配置",-1)),u("button",{class:"modal__button modal__button--secondary",onClick:f}," 选择文件导入 ")])]),u("div",nn,[p[56]||(p[56]=u("h3",{class:"modal__settings-group-title"},"调试",-1)),u("div",rn,[p[55]||(p[55]=u("span",{class:"modal__setting-item-name"},"调试模式",-1)),u("label",on,[q(u("input",{type:"checkbox","onUpdate:modelValue":p[15]||(p[15]=b=>a.debugEnabled=b)},null,512),[[I,a.debugEnabled]]),p[54]||(p[54]=u("span",{class:"modal__toggle-slider"},null,-1))])])])])):j("",!0)]),_:1},8,["show"]),le(se,{show:r.value,title:"导入配置",onClose:p[19]||(p[19]=b=>r.value=!1)},{footer:M(()=>[u("button",{onClick:p[18]||(p[18]=b=>r.value=!1),class:"modal__button modal__button--secondary"},"取消"),u("button",{onClick:_,class:"modal__button modal__button--primary"},"导入")]),default:M(()=>[u("div",an,[p[57]||(p[57]=u("p",null,"选择要导入的配置文件：",-1)),u("input",{type:"file",id:"importFileInput",accept:".json",onChange:S},null,32)])]),_:1},8,["show"]),le(se,{show:o.value,title:"导出成功",onClose:p[21]||(p[21]=b=>o.value=!1)},{footer:M(()=>[u("button",{onClick:p[20]||(p[20]=b=>o.value=!1),class:"modal__button modal__button--primary"},"关闭")]),default:M(()=>[u("div",ln,[p[58]||(p[58]=u("p",null,"配置文件已成功导出为JSON文件。",-1)),u("p",null,"导出时间："+G(l.value),1)])]),_:1},8,["show"])],64))}});export{Ve as Q,se as _,Zt as a,Vt as b,C as c,hn as d,gn as e,z as m,pn as p};
