var lt=Object.defineProperty;var ut=(m,t,e)=>t in m?lt(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e;var k=(m,t,e)=>ut(m,typeof t!="symbol"?t+"":t,e);import{g as Y,h as ct,s as c,d as W,c as q,f as x,b as A,w as gt,e as i,t as I,i as H,n as R,r as P,o as X,j as tt,k as V,l as mt,m as dt,p as N,q as S,v as O,x as _,F as K,y as U,z as pt,A as ft}from"./index-BWRWW1gk.js";class ht{canParse(t){if(!t||typeof t!="object")return!1;const e=t;if(!Array.isArray(e.chapters)||e.chapters.length===0)return!1;const s=e.chapters[0];if(!s.title||!Array.isArray(s.questions))return!1;if(s.questions.length>0){const n=s.questions[0];if(!n.title||!Array.isArray(n.options))return!1}return!0}parse(t){return t}}class St{canParse(t){return typeof t=="string"&&!this.isJson(t)}isJson(t){try{return JSON.parse(t),!0}catch{return!1}}parse(t,e){if(typeof t!="string")throw new Error("TextFormatParser只能处理字符串数据");const n=t.split(`
`).filter(g=>g.trim()),r=e?e.replace(/\.(txt|json)$/,""):n[0]||"未命名题库",l=[];let p={title:"默认章节",questions:[]},d=null;for(let g=1;g<n.length;g++){const h=n[g].trim();if(h.startsWith("## "))p.questions.length>0&&l.push(p),p={title:h.substring(3),questions:[]},d=null;else if(h.match(/^\d+\./))d&&p.questions.push(d),d={id:`q-${Date.now()}-${Math.random().toString(36).slice(2)}`,title:h.substring(h.indexOf(".")+1).trim(),options:[],answer:0,explanation:""};else if(h.startsWith("- ")&&d)d.options.push(h.substring(2).trim());else if(h.startsWith("答案:")&&d){const v=h.substring(3).trim();d.answer=parseInt(v)-1||0}else h.startsWith("解析:")&&d&&(d.explanation=h.substring(3).trim())}return d&&p.questions.push(d),p.questions.length>0&&l.push(p),{title:r,chapters:l,description:"从文本导入",lastModified:Date.now()}}}class Z{canParse(t){if(!t||typeof t!="object")return!1;const e=t;if(Array.isArray(e.questions)&&e.questions.length>0)return!0;if(Array.isArray(t)&&t.length>0){const s=t[0];if(s&&typeof s=="object")return s.question!==void 0||s.title!==void 0||s.stem!==void 0||s.options!==void 0||s.answer!==void 0}return!1}parse(t,e){const s=t;let n=s.title||"题库";e?n=e.replace(/\.(json|txt)$/,""):s.fileName&&typeof s.fileName=="string"?n=s.fileName.replace(/\.(json|txt)$/,""):s.name&&typeof s.name=="string"&&(n=s.name),n.includes("[")&&n.includes("]")&&(n=n.replace(/\[|\]/g,""));const r=[],l={title:"默认章节",questions:[]};return this.processQuestions(s,l),l.questions.length>0&&r.push(l),this.processChapters(s,r),{title:n,description:typeof s.description=="string"?s.description:"导入的题库",author:typeof s.author=="string"?s.author:"",version:typeof s.version=="string"?s.version:"1.0",lastModified:Date.now(),chapters:r.length>0?r:[l]}}processQuestions(t,e){Array.isArray(t.questions)?t.questions.forEach((s,n)=>{if(!s||typeof s!="object")return;const r=s;this.createQuestion(r,n,e)}):Array.isArray(t)&&t.forEach((s,n)=>{if(!s||typeof s!="object")return;const r=s;this.createQuestion(r,n,e)})}processChapters(t,e){Array.isArray(t.chapters)&&t.chapters.length>0&&t.chapters.forEach((s,n)=>{if(!s||typeof s!="object")return;const r=s;if(r.title&&Array.isArray(r.questions)&&r.questions.length>0){const l={title:typeof r.title=="string"?r.title:`第${n+1}章`,questions:[]};r.questions.forEach((p,d)=>{if(!p||typeof p!="object")return;const g=p;this.createQuestion(g,d,l)}),l.questions.length>0&&e.push(l)}})}createQuestion(t,e,s){const n={id:typeof t.id=="string"||typeof t.id=="number"?String(t.id):`q-${Date.now()}-${e}`,title:"",options:[],answer:0,explanation:""};typeof t.question=="string"?n.title=t.question:typeof t.title=="string"?n.title=t.title:typeof t.stem=="string"?n.title=t.stem:typeof t.content=="string"?n.title=t.content:n.title=`第${e+1}题`,(n.title.includes("<p>")||n.title.includes("</p>"))&&(n.title=n.title.replace(/<\/?p>/g,"")),typeof t.analysis=="string"?n.explanation=t.analysis:typeof t.explanation=="string"?n.explanation=t.explanation:typeof t.parse=="string"?n.explanation=t.parse:typeof t.comment=="string"&&(n.explanation=t.comment),n.options=this.extractOptions(t),n.answer=this.extractAnswer(t,n.options.length),s.questions.push(n)}extractOptions(t){if(Array.isArray(t.options))return this.processOptionsArray(t.options);if(t.options&&typeof t.options=="object")return this.processOptionsObject(t.options);if(Array.isArray(t.choices))return this.processOptionsArray(t.choices);if(t.choices&&typeof t.choices=="object")return this.processOptionsObject(t.choices);const e=[],s=["A","B","C","D","E","F","G","H"];for(const n of s)n in t&&typeof t[n]=="string"&&e.push(t[n]);return e.length>=2?e:["选项A","选项B","选项C","选项D"]}processOptionsArray(t){return t.map(e=>{if(typeof e=="string")return e;if(typeof e=="number")return String(e);if(e===null)return"";if(typeof e=="object"){const s=e;if(typeof s.text=="string")return s.text;if(typeof s.content=="string")return s.content;if(typeof s.label=="string")return s.label;if(typeof s.value=="string")return s.value;if(typeof s.option=="string")return s.option;const n=Object.keys(s);return n.length===1&&typeof s[n[0]]=="string"?s[n[0]]:JSON.stringify(e)}return String(e)})}processOptionsObject(t){let e=Object.keys(t);return e=e.sort((s,n)=>/^[A-Z]$/.test(s)&&/^[A-Z]$/.test(n)?s.charCodeAt(0)-n.charCodeAt(0):/^\d+$/.test(s)&&/^\d+$/.test(n)?parseInt(s)-parseInt(n):s.localeCompare(n)),e.map(s=>{const n=t[s];if(typeof n=="string")return n;if(typeof n=="number")return String(n);if(n===null)return"";if(typeof n=="object"){const r=n;return typeof r.text=="string"?r.text:typeof r.content=="string"?r.content:typeof r.label=="string"?r.label:typeof r.value=="string"?r.value:JSON.stringify(n)}return String(n)})}extractAnswer(t,e){let s;return t.answer!==void 0?s=t.answer:t.correct!==void 0?s=t.correct:t.rightAnswer!==void 0?s=t.rightAnswer:t.correctAnswer!==void 0&&(s=t.correctAnswer),this.processAnswer(s,e)}processAnswer(t,e){if(typeof t=="number")return Math.min(Math.max(0,t),e-1);if(typeof t=="string"){if(/^[A-Z]$/.test(t)){const s=t.charCodeAt(0)-65;return Math.min(Math.max(0,s),e-1)}if(/^\d+$/.test(t)){const s=parseInt(t)-1;return Math.min(Math.max(0,s),e-1)}if(/^[A-Z]+$/.test(t))return Array.from(t).map(s=>{const n=s.charCodeAt(0)-65;return Math.min(Math.max(0,n),e-1)});if(t.includes(","))return t.split(",").map(s=>/^[A-Z]$/.test(s)?s.charCodeAt(0)-65:/^\d+$/.test(s)?parseInt(s)-1:0)}return Array.isArray(t)?t.map(s=>{if(typeof s=="number")return Math.min(Math.max(0,s),e-1);if(typeof s=="string"){if(/^[A-Z]$/.test(s))return s.charCodeAt(0)-65;if(/^\d+$/.test(s))return parseInt(s)-1}return 0}):0}}class vt{constructor(){k(this,"parsers",[]);this.register(new ht),this.register(new St),this.register(new Z)}register(t){this.parsers.push(t)}parse(t,e){let s=t;if(typeof t=="string")try{s=JSON.parse(t)}catch{}for(const n of this.parsers)if(n.canParse(s))return n.parse(s,e);return new Z().parse(s,e)}}const et=new vt;function Qe(m,t){return et.parse(m,t)}var st=(m=>(m.NORMAL="normal",m.RANDOM="random",m.EXAM="exam",m.WRONG="wrong",m.REVIEW="review",m.RANGE="range",m))(st||{}),yt=(m=>(m.LOCAL="local",m.ONLINE_IMPORT="online-import",m.REMOTE_IMPORT="remote-import",m.ONLINE="online",m.REMOTE="remote",m))(yt||{}),bt=(m=>(m.CACHE="cache",m.ONLINE="online",m.REMOTE="remote",m))(bt||{});const J="app_settings",it={darkMode:window.matchMedia("(prefers-color-scheme: dark)").matches,themeColor:"default",customColor:"#4caf50",fontSize:14,fontFamily:"sans-serif",animationEnabled:!1},nt={autoSubmit:!1,autoNext:!1,allowSkip:!1,showNotesAfterAnswer:!1,lockAnswerAfterSubmit:!1,showCorrectAnswerImmediately:!1,showProgress:!1,swipeGestureEnabled:!1,randomMode:!1,reviewMode:!1,viewWrongAfterAll:!1,canEditQuestion:!1},C={enabled:!1,autoGenerate:!1,streamOutput:!1,autoSync:!1,apiUrl:"",apiKey:"",model:"",systemPrompt:"",temperature:.7,maxTokens:2e3,topP:1},ot={owner:"",repo:"",branch:"main",path:"",token:"",forceSync:!1,syncQuizName:"",createRemoteRepo:!1},T={uiSettings:it,quizSettings:nt,debugEnabled:!1,githubConfig:ot,lastSyncTimestamp:0,apiPresets:[$(C)],activeApiPresetName:"Default"},G={chapterIndex:"all",mode:"normal",rangeStart:1,rangeEnd:50,randomize:!1,wrongOnly:!1};function $(m,t="Default"){return{name:t,...m}}class _t{constructor(){k(this,"settings");k(this,"version","1.0");k(this,"listeners",new Map);k(this,"quizState",Y({quizData:null,config:{...G},lastLoaded:{name:"",source:""},stats:{totalAnswered:0,correctCount:0,wrongCount:0,dailyActivity:[0,0,0,0,0,0,0]}}));k(this,"state",ct(this.quizState));this.settings=this.loadSettings(),this.applyTheme(),this.initQuizFromStorage()}loadSettings(){try{const t=localStorage.getItem(J);if(t){const e=JSON.parse(t);return e.apiConfig&&!e.apiPresets&&(e.apiPresets=[$(e.apiConfig)],e.activeApiPresetName="Default",delete e.apiConfig),(!e.apiPresets||e.apiPresets.length===0)&&(e.apiPresets=[$(C)],e.activeApiPresetName="Default"),(!e.activeApiPresetName||!e.apiPresets.some(s=>s.name===e.activeApiPresetName))&&(e.activeApiPresetName=e.apiPresets[0].name),this.mergeWithDefaults(e)}return{...T}}catch(t){console.error("加载配置失败:",t);const e={...T};return(!e.apiPresets||e.apiPresets.length===0)&&(e.apiPresets=[$(C)],e.activeApiPresetName="Default"),(!e.activeApiPresetName||!e.apiPresets.some(s=>s.name===e.activeApiPresetName))&&(e.activeApiPresetName=e.apiPresets[0].name),e}}mergeWithDefaults(t){var n;const e=t.apiPresets&&t.apiPresets.length>0?t.apiPresets.map(r=>({...C,...r})):[...T.apiPresets],s=t.activeApiPresetName&&e.some(r=>r.name===t.activeApiPresetName)?t.activeApiPresetName:((n=e[0])==null?void 0:n.name)||"Default";return{uiSettings:{...it,...t.uiSettings},quizSettings:{...nt,...t.quizSettings},debugEnabled:t.debugEnabled??T.debugEnabled,githubConfig:{...ot,...t.githubConfig},lastSyncTimestamp:t.lastSyncTimestamp??0,apiPresets:e,activeApiPresetName:s}}saveSettings(){try{localStorage.setItem(J,JSON.stringify(this.settings)),this.notifyListeners("settings")}catch(t){console.error("保存配置失败:",t),c("保存配置失败: "+t.message,"error")}}applyTheme(){const{darkMode:t,fontSize:e,fontFamily:s}=this.settings.uiSettings;document.documentElement.setAttribute("theme",t?"dark":"light"),document.documentElement.style.setProperty("--font-size",`${e}px`),document.documentElement.style.setProperty("--font-family",s)}addListener(t,e){var s;this.listeners.has(t)||this.listeners.set(t,[]),(s=this.listeners.get(t))==null||s.push(e)}removeListener(t,e){if(this.listeners.has(t)){const s=this.listeners.get(t),n=(s==null?void 0:s.indexOf(e))??-1;n!==-1&&s&&s.splice(n,1)}}notifyListeners(t){const e=this.listeners.get(t);e&&e.forEach(s=>s()),t!=="settings"&&this.notifyListeners("settings")}getSettings(){const t={...this.settings};return(!t.apiPresets||t.apiPresets.length===0)&&(t.apiPresets=[$(C)],t.activeApiPresetName="Default"),(!t.activeApiPresetName||!t.apiPresets.some(e=>e.name===t.activeApiPresetName))&&(t.activeApiPresetName=t.apiPresets[0].name),t}updateSettings(t,e=!0){var n;const s={...this.settings,...t};Array.isArray(s.apiPresets)||(s.apiPresets=[...this.settings.apiPresets],s.apiPresets.length===0&&(s.apiPresets=[$(C)])),(!s.activeApiPresetName||!s.apiPresets.some(r=>r.name===s.activeApiPresetName))&&(s.activeApiPresetName=((n=s.apiPresets[0])==null?void 0:n.name)||"Default"),this.settings=s,this.saveSettings(),this.applyTheme(),e&&c("设置已保存","success"),this.notifyListeners("settings"),this.notifyListeners("api")}getUiSettings(){return{...this.settings.uiSettings}}updateUiSettings(t,e=!0){this.settings.uiSettings={...this.settings.uiSettings,...t},this.saveSettings(),this.applyTheme(),this.notifyListeners("ui"),e&&c("界面设置已保存","success")}toggleDarkMode(){const t=!this.settings.uiSettings.darkMode;this.updateUiSettings({darkMode:t})}setFontSize(t){this.updateUiSettings({fontSize:t})}getQuizSettings(){return{...this.settings.quizSettings}}updateQuizSettings(t,e=!0){this.settings.quizSettings={...this.settings.quizSettings,...t},this.saveSettings(),this.notifyListeners("quiz"),e&&c("测验设置已保存","success")}getApiConfig(){const t=this.settings.apiPresets.find(n=>n.name===this.settings.activeApiPresetName);if(!t)return console.warn(`活动预设 "${this.settings.activeApiPresetName}" 未找到，返回第一个预设。`),this.settings.apiPresets[0]?{...this.settings.apiPresets[0]}:{...C};const{name:e,...s}=t;return s}updateApiConfig(t,e=!0){const s=this.settings.apiPresets.findIndex(n=>n.name===this.settings.activeApiPresetName);if(s===-1){console.error(`无法更新：活动预设 "${this.settings.activeApiPresetName}" 未找到。`),c("更新API配置失败：未找到活动预设","error");return}this.settings.apiPresets[s]={...this.settings.apiPresets[s],...t},this.saveSettings(),this.notifyListeners("api"),e&&c(`API预设 "${this.settings.activeApiPresetName}" 已保存`,"success")}getApiPresets(){return JSON.parse(JSON.stringify(this.settings.apiPresets))}getActiveApiPresetName(){return this.settings.activeApiPresetName}addApiPreset(t,e){if(!t||t.trim()==="")return c("预设名称不能为空","error"),!1;if(t=t.trim(),this.settings.apiPresets.some(r=>r.name===t))return c(`预设名称 "${t}" 已存在`,"error"),!1;const s=e||this.settings.activeApiPresetName,n=this.settings.apiPresets.find(r=>r.name===s);if(n){const r={...n,name:t};this.settings.apiPresets.push(r)}else{console.error(`无法复制配置：源预设 "${s}" 未找到。将使用默认配置创建。`);const r=$({...C},t);this.settings.apiPresets.push(r)}return this.saveSettings(),this.notifyListeners("api"),c(`已添加预设 "${t}"`,"success"),!0}deleteApiPreset(t){if(this.settings.apiPresets.length<=1)return c("无法删除最后一个预设","warning"),!1;const e=this.settings.apiPresets.findIndex(s=>s.name===t);return e===-1?(c(`未找到要删除的预设 "${t}"`,"error"),!1):(this.settings.apiPresets.splice(e,1),this.settings.activeApiPresetName===t&&(this.settings.activeApiPresetName=this.settings.apiPresets[0].name,this.notifyListeners("api")),this.saveSettings(),this.notifyListeners("api"),c(`已删除预设 "${t}"`,"success"),!0)}setActiveApiPreset(t){return this.settings.apiPresets.some(s=>s.name===t)?(this.settings.activeApiPresetName!==t&&(this.settings.activeApiPresetName=t,this.saveSettings(),this.notifyListeners("api")),!0):(c(`未找到预设 "${t}"`,"error"),!1)}renameApiPreset(t,e){if(!e||e.trim()==="")return c("新预设名称不能为空","error"),!1;if(e=e.trim(),t===e)return!0;if(this.settings.apiPresets.some(n=>n.name===e))return c(`预设名称 "${e}" 已存在`,"error"),!1;const s=this.settings.apiPresets.findIndex(n=>n.name===t);return s===-1?(c(`未找到要重命名的预设 "${t}"`,"error"),!1):(this.settings.apiPresets[s].name=e,this.settings.activeApiPresetName===t&&(this.settings.activeApiPresetName=e),this.saveSettings(),this.notifyListeners("api"),c(`预设 "${t}" 已重命名为 "${e}"`,"success"),!0)}getGithubConfig(){return{...this.settings.githubConfig}}updateGithubConfig(t,e=!0){const s={owner:t.owner??this.settings.githubConfig.owner,repo:t.repo??this.settings.githubConfig.repo,branch:t.branch??this.settings.githubConfig.branch,path:t.path??this.settings.githubConfig.path,token:t.token??this.settings.githubConfig.token,forceSync:t.forceSync??this.settings.githubConfig.forceSync,syncQuizName:t.syncQuizName??this.settings.githubConfig.syncQuizName,createRemoteRepo:t.createRemoteRepo??this.settings.githubConfig.createRemoteRepo};this.settings.githubConfig=s,this.saveSettings(),this.settings.lastSyncTimestamp=Date.now(),this.notifyListeners("github"),e&&c("GitHub设置已保存","success")}getLastSyncTimestamp(){return this.settings.lastSyncTimestamp||0}updateSyncTimestamp(){this.settings.lastSyncTimestamp=Date.now(),this.saveSettings()}isDebugEnabled(){return!!this.settings.debugEnabled}setDebugEnabled(t,e=!0){this.settings.debugEnabled=t,this.saveSettings(),e&&c(t?"调试模式已启用":"调试模式已禁用","info")}exportConfig(){try{const t={timestamp:new Date().toISOString(),version:this.version,exportDate:new Date().toISOString(),generalSettings:{uiSettings:this.settings.uiSettings,debugEnabled:this.settings.debugEnabled},quizSettings:this.settings.quizSettings,apiPresets:this.settings.apiPresets,activeApiPresetName:this.settings.activeApiPresetName,repoSettings:this.settings.githubConfig,stats:{}},e=localStorage.getItem("userStats");e&&(t.stats=JSON.parse(e),t.statisticsData=JSON.parse(e));const s=JSON.stringify(t,null,2),n="data:application/json;charset=utf-8,"+encodeURIComponent(s),r=`elyxira-config-${new Date().toISOString().split("T")[0]}.json`,l=document.createElement("a");return l.setAttribute("href",n),l.setAttribute("download",r),l.click(),c("配置已导出","success"),r}catch(t){throw console.error("导出配置失败:",t),c(`导出配置失败: ${t.message}`,"error"),t}}importConfig(t){try{if(!this.validateConfigData(t))return c("无效的配置文件格式或版本不兼容","error"),!1;const e=t,s={...this.settings};if(e.generalSettings&&(e.generalSettings.uiSettings&&(s.uiSettings={...this.settings.uiSettings,...e.generalSettings.uiSettings}),s.debugEnabled="debugEnabled"in e.generalSettings?!!e.generalSettings.debugEnabled:this.settings.debugEnabled),e.quizSettings&&(s.quizSettings={...this.settings.quizSettings,...e.quizSettings}),e.apiPresets&&Array.isArray(e.apiPresets)&&e.apiPresets.length>0)s.apiPresets=e.apiPresets.map(n=>{const r=typeof n.name=="string"&&n.name.trim()?n.name.trim():`Imported-${Date.now()}`;return{...C,...n,name:r}}),e.activeApiPresetName&&s.apiPresets.some(n=>n.name===e.activeApiPresetName)?s.activeApiPresetName=e.activeApiPresetName:s.activeApiPresetName=s.apiPresets[0].name;else if("apiSettings"in e&&e.apiSettings){console.warn("导入旧版配置格式，将 apiSettings 转换为 'Imported Default' 预设。");const n=e.apiSettings;s.apiPresets=[$({...C,...n},"Imported Default")],s.activeApiPresetName="Imported Default"}return e.repoSettings&&(s.githubConfig={...this.settings.githubConfig,...e.repoSettings}),this.settings=s,this.saveSettings(),this.applyTheme(),(e.stats||e.statisticsData)&&localStorage.setItem("userStats",JSON.stringify(e.stats||e.statisticsData)),this.notifyListeners("settings"),this.notifyListeners("ui"),this.notifyListeners("quiz"),this.notifyListeners("api"),this.notifyListeners("github"),c("配置已成功导入","success"),!0}catch(e){return console.error("导入配置失败:",e),c("导入配置失败："+e.message,"error"),!1}}validateConfigData(t){if(!t||typeof t!="object")return!1;const e=t;return"timestamp"in e&&"version"in e&&typeof e.timestamp=="string"&&typeof e.version=="string"}resetAllSettings(){this.settings={...T},localStorage.removeItem(J),localStorage.removeItem("userStats"),localStorage.removeItem("quizStats"),localStorage.removeItem("quizData"),localStorage.removeItem("lastLoadedQuiz"),localStorage.removeItem("cachedQuizList"),this.saveSettings(),this.applyTheme(),this.quizState.quizData=null,this.quizState.config={...G},this.quizState.lastLoaded={name:"",source:""},this.quizState.stats={totalAnswered:0,correctCount:0,wrongCount:0,dailyActivity:[0,0,0,0,0,0,0]},this.notifyListeners("settings"),this.notifyListeners("ui"),this.notifyListeners("quiz"),this.notifyListeners("api"),this.notifyListeners("github"),c("所有设置已重置为默认值","success")}clearQuizCache(){try{let t=0;for(let e=localStorage.length-1;e>=0;e--){const s=localStorage.key(e);s&&(s.startsWith("quizCache_")||s==="cachedQuizList")&&(localStorage.removeItem(s),t++)}return t>0?c(`已清除 ${t} 项题库缓存`,"success"):c("没有找到题库缓存","info"),t>0}catch(t){return console.error("清除题库缓存失败:",t),c(`清除缓存失败: ${t.message}`,"error"),!1}}getCacheStats(){let t=0;const e=[];for(let s=0;s<localStorage.length;s++){const n=localStorage.key(s);if(n){const r=localStorage.getItem(n)||"",l=(n.length+r.length)*2;t+=l,n.startsWith("quizCache_")&&e.push({key:n.replace("quizCache_",""),size:l})}}return{totalSize:t,items:e}}saveQuizToStorage(t,e){const s=`quizCache_${t}`;localStorage.setItem(s,JSON.stringify(e))}loadQuizFromStorage(t){const e=`quizCache_${t}`,s=localStorage.getItem(e);if(!s)return null;try{return JSON.parse(s)}catch(n){return console.error(`解析缓存题库失败: ${t}`,n),null}}removeQuizFromStorage(t){const e=`quizCache_${t}`;localStorage.removeItem(e)}saveQuizList(t){localStorage.setItem("cachedQuizList",JSON.stringify(t))}loadQuizList(){const t=localStorage.getItem("cachedQuizList");if(!t)return[];try{return JSON.parse(t)}catch(e){return console.error("解析题库列表失败",e),[]}}saveLastLoadedQuiz(t,e){this.quizState.lastLoaded.name=t,this.quizState.lastLoaded.source=e,localStorage.setItem("lastLoadedQuiz",JSON.stringify({name:t,source:e}))}getLastLoadedQuiz(){if(this.quizState.lastLoaded.name)return{...this.quizState.lastLoaded};const t=localStorage.getItem("lastLoadedQuiz");if(!t)return null;try{const e=JSON.parse(t);return this.quizState.lastLoaded=e,e}catch{return null}}clearAllQuizStorage(){this.loadQuizList().forEach(e=>{const s=`quizCache_${e.name}`;localStorage.removeItem(s)}),localStorage.removeItem("cachedQuizList"),localStorage.removeItem("lastLoadedQuiz"),localStorage.removeItem("quizData"),localStorage.removeItem("quizNotes"),this.quizState.quizData=null,this.quizState.lastLoaded={name:"",source:""},this.quizState.config={...G},c("已清除所有题库缓存","success")}clearLegacyNotes(){localStorage.removeItem("quizNotes")}getQuizData(){return this.quizState.quizData}setQuizData(t){this.quizState.quizData=t}getQuizConfig(){return{...this.quizState.config}}setQuizConfig(t){this.quizState.config={...this.quizState.config,...t},this.saveQuizConfigToStorage()}saveQuizConfigToStorage(){localStorage.setItem("selectedChapter",this.quizState.config.chapterIndex),localStorage.setItem("quizMode",this.quizState.config.mode),localStorage.setItem("rangeStart",this.quizState.config.rangeStart.toString()),localStorage.setItem("rangeEnd",this.quizState.config.rangeEnd.toString())}initQuizFromStorage(){try{const t=localStorage.getItem("quizData");if(t)this.quizState.quizData=JSON.parse(t);else return!1;const e=localStorage.getItem("lastLoadedQuiz");e&&(this.quizState.lastLoaded=JSON.parse(e));const s=localStorage.getItem("selectedChapter");s&&(this.quizState.config.chapterIndex=s);const n=localStorage.getItem("quizMode");n&&Object.values(st).includes(n)&&(this.quizState.config.mode=n);const r=localStorage.getItem("rangeStart");r&&(this.quizState.config.rangeStart=parseInt(r));const l=localStorage.getItem("rangeEnd");return l&&(this.quizState.config.rangeEnd=parseInt(l)),this.loadQuizStatsFromStorage(),!0}catch(t){return console.error("从本地存储恢复状态失败:",t),!1}}saveQuizState(){this.quizState.quizData&&(localStorage.setItem("quizData",JSON.stringify(this.quizState.quizData)),this.saveQuizConfigToStorage(),localStorage.setItem("lastLoadedQuiz",JSON.stringify(this.quizState.lastLoaded)),this.quizState.lastLoaded.name&&this.saveQuizToStorage(this.quizState.lastLoaded.name,this.quizState.quizData))}loadQuizStatsFromStorage(){try{const t=localStorage.getItem("quizStats");if(t){const e=JSON.parse(t);this.quizState.stats={...this.quizState.stats,...e}}}catch(t){console.error("加载统计数据失败:",t)}}saveQuizStatsToStorage(){localStorage.setItem("quizStats",JSON.stringify(this.quizState.stats))}updateQuizStats(t){typeof t=="boolean"?(this.quizState.stats.totalAnswered++,t?this.quizState.stats.correctCount++:this.quizState.stats.wrongCount++):(t.totalAnswered!==void 0&&(this.quizState.stats.totalAnswered=t.totalAnswered),t.correctCount!==void 0&&(this.quizState.stats.correctCount=t.correctCount),t.wrongCount!==void 0&&(this.quizState.stats.wrongCount=t.wrongCount));const e=new Date().getDay();this.quizState.stats.dailyActivity[e]++,this.saveQuizStatsToStorage()}getQuizChapters(){return!this.quizState.quizData||!this.quizState.quizData.chapters?[]:this.quizState.quizData.chapters.map(t=>t.title)}getQuizTotalQuestions(){return!this.quizState.quizData||!this.quizState.quizData.chapters?0:this.quizState.quizData.chapters.reduce((t,e)=>{var s;return t+(((s=e.questions)==null?void 0:s.length)||0)},0)}getQuizAnsweredCount(){return this.quizState.stats.totalAnswered}getQuizCorrectCount(){return this.quizState.stats.correctCount}getQuizAccuracyRate(){const t=this.quizState.stats.totalAnswered;return t===0?"0%":Math.round(this.quizState.stats.correctCount/t*100)+"%"}clearCurrentQuiz(){this.quizState.quizData=null,this.quizState.lastLoaded={name:"",source:""},localStorage.removeItem("quizData"),localStorage.removeItem("lastLoadedQuiz")}async syncQuizFromGithub(t){try{const e=this.getGithubConfig();if(!this.validateGithubConfig(e))return c("GitHub配置不完整","error"),null;const s=e.path||"quizzes",n=`https://api.github.com/repos/${e.owner}/${e.repo}/contents/${s}?ref=${e.branch}`,r=await fetch(n,{headers:{Authorization:`token ${e.token}`,Accept:"application/vnd.github.v3+json"}});if(!r.ok)return c(`获取远程题库列表失败 (${r.status})`,"error"),null;const l=await r.json(),p=Array.isArray(l)?l.filter(f=>f.type==="file"&&(f.name.endsWith(".json")||f.name.endsWith(".txt"))):[];if(p.length===0)return c("远程仓库中未找到任何题库文件","error"),null;let d=p.find(f=>f.name===`${t}.json`||f.name===`${t}.txt`);if(d||(d=p.find(f=>f.name.toLowerCase().includes(t.toLowerCase()))),!d){if(c(`远程仓库中未找到匹配的题库：${t}`,"error"),p.length>0){const f=p.map(o=>o.name.replace(/\.(json|txt)$/,"")).join(", ");console.info(`远程仓库中可用的题库: ${f}`)}return null}const g=await fetch(d.download_url);if(!g.ok)return c("下载题库内容失败","error"),null;const h=await g.text();let v;try{v=JSON.parse(h)}catch{return c("解析题库数据失败：无效的JSON格式","error"),null}if(!this.validateQuizData(v))return c("无效的题库数据格式","error"),null;const b=d.name.replace(/\.(json|txt)$/,"");this.saveQuizToStorage(b,v);const w=this.loadQuizList(),L=w.findIndex(f=>f.name===b&&f.source==="remote-import"),D={id:`remote-import-${Date.now()}`,name:b,path:"localStorage",source:"remote-import",info:`从GitHub同步：${e.owner}/${e.repo}`,title:v.title||b,lastModified:Date.now(),data:v};return L>=0?w[L]=D:w.push(D),this.saveQuizList(w),this.updateSyncTimestamp(),c(`成功从GitHub同步题库：${b}`,"success"),v}catch(e){return c(`同步题库失败：${e.message}`,"error"),null}}async pushQuizToGithub(t,e){try{const s=this.getGithubConfig();if(!this.validateGithubConfig(s))return c("GitHub配置不完整","error"),!1;const n=this.loadQuizFromStorage(t);if(!n)return c(`本地未找到题库：${t}`,"error"),!1;const r=`quizzes/${t}.json`,l=`https://api.github.com/repos/${s.owner}/${s.repo}/contents/${r}`;let p=null;try{const b=await fetch(`${l}?ref=${s.branch}`,{headers:{Authorization:`token ${s.token}`,Accept:"application/vnd.github.v3+json"}});b.ok&&(p=(await b.json()).sha)}catch{}const d=JSON.stringify(n,null,2),g=btoa(unescape(encodeURIComponent(d))),h={message:p?`更新题库：${t}`:`添加题库：${t}`,content:g,branch:s.branch};p&&(h.sha=p);const v=await fetch(l,{method:"PUT",headers:{Authorization:`token ${s.token}`,"Content-Type":"application/json",Accept:"application/vnd.github.v3+json"},body:JSON.stringify(h)});if(!v.ok){const b=await v.json();return c(`推送题库失败 (${v.status}): ${b.message||"未知错误"}`,"error"),!1}return this.updateSyncTimestamp(),c(`成功推送题库到GitHub：${t}`,"success"),!0}catch(s){return c(`推送题库失败：${s.message}`,"error"),!1}}validateGithubConfig(t){return!!(t.owner&&t.repo&&t.token&&t.branch)}validateQuizData(t){if(!t||typeof t!="object")return!1;const e=t;if(!Array.isArray(e.chapters))return!1;for(const s of e.chapters){if(typeof s!="object"||typeof s.title!="string"||!Array.isArray(s.questions))return!1;for(const n of s.questions)if(typeof n!="object"||typeof n.title!="string"||!Array.isArray(n.options)||n.answer===void 0)return!1}return!0}saveGeneralSettings(t){this.updateUiSettings(t.uiSettings,!1),this.updateQuizSettings(t.quizSettings,!1),this.setDebugEnabled(t.debugEnabled,!1),this.notifyListeners("settings"),c("通用设置已保存","success")}parseTextQuiz(t){const e=t.split(`
`).filter(p=>p.trim()),s=e[0]||"未命名题库",n=[];let r={title:"默认章节",questions:[]},l=null;for(let p=1;p<e.length;p++){const d=e[p].trim();if(d.startsWith("## "))r.questions.length>0&&n.push(r),r={title:d.substring(3),questions:[]},l=null;else if(d.match(/^\d+\./))l&&r.questions.push(l),l={id:`q-${Date.now()}-${Math.random().toString(36).slice(2)}`,title:d.substring(d.indexOf(".")+1).trim(),options:[],answer:0,explanation:""};else if(d.startsWith("- ")&&l)l.options.push(d.substring(2).trim());else if(d.startsWith("答案:")&&l){const g=d.substring(3).trim();l.answer=parseInt(g)-1||0}else d.startsWith("解析:")&&l&&(l.explanation=d.substring(3).trim())}return l&&r.questions.push(l),r.questions.length>0&&n.push(r),{title:s,chapters:n,description:"从文本导入",lastModified:Date.now()}}enhancedValidQuizData(t){try{const e=et.parse(t);return!e||!Array.isArray(e.chapters)||e.chapters.length===0?(console.error("验证失败: 解析后数据缺少有效章节"),!1):(e.chapters.some(n=>Array.isArray(n.questions)&&n.questions.length>0)||console.warn("解析后数据中没有题目"),!0)}catch(e){return console.error("题库数据验证失败:",e),!1}}async importConfigFromFile(t){return new Promise((e,s)=>{const n=new FileReader;n.onload=r=>{try{if(r.target&&typeof r.target.result=="string"){const l=JSON.parse(r.target.result);this.importConfig(l)?e(!0):s(new Error("Invalid config file format or content."))}else s(new Error("Failed to read file content."))}catch(l){console.error("Error parsing config file:",l),s(new Error("Failed to parse config file. Ensure it is valid JSON."))}},n.onerror=r=>{console.error("Error reading file:",r),s(new Error("Failed to read the selected file."))},n.readAsText(t)})}}const z=new _t,zt={class:"modal__header"},At={class:"modal__title"},qt={class:"modal__body"},wt={key:0,class:"modal__footer"},F=W({__name:"modal-base",props:{show:Boolean,title:{type:String,default:"提示"},contentClass:{type:String,default:""}},emits:["close"],setup(m){return(t,e)=>m.show?(A(),q("div",{key:0,class:"modal modal--active",onClick:e[1]||(e[1]=gt(s=>t.$emit("close"),["self"]))},[i("div",{class:R(["modal__content",m.contentClass])},[i("div",zt,[i("h2",At,I(m.title),1),i("button",{class:"modal__close",onClick:e[0]||(e[0]=s=>t.$emit("close")),title:"关闭"},"×")]),i("div",qt,[H(t.$slots,"default")]),t.$slots.footer?(A(),q("div",wt,[H(t.$slots,"footer")])):x("",!0)],2)])):x("",!0)}}),Ct={class:"modal__section"},Pt={key:0,class:"modal__info-message"},$t={key:1,class:"modal__info-grid"},Nt={class:"modal__info-item"},xt={class:"modal__info-value"},It={class:"modal__info-item"},kt={class:"modal__info-value"},Ot={key:0,class:"modal__section"},Lt={class:"modal__form-group"},Dt={key:0,class:"modal__form-group modal__form-group--switch"},Qt={class:"modal__toggle-switch"},Et={key:1,class:"modal__form-description"},Tt={class:"modal__form-group"},jt={class:"modal__form-group"},Mt={class:"modal__form-group"},Ft={class:"modal__form-group"},Ut={class:"modal__form-group"},Jt={class:"modal__form-group modal__form-group--switch"},Gt={class:"modal__toggle-switch"},Rt={class:"modal__form-actions"},Vt=["disabled"],Wt=["disabled"],Bt=["disabled"],Ee=W({__name:"modal-quiz-sync",props:{show:{type:Boolean,default:!1},currentQuiz:{type:Object,default:()=>({name:"",source:"",isLocal:!0,exists:!1})}},emits:["close","sync-complete","save"],setup(m,{emit:t}){const e=t,s=m,n={local:"本地题库",online:"在线题库",remote:"远程题库","online-import":"从在线导入","remote-import":"从远程导入"},r=P({owner:"",repo:"",branch:"main",path:"",token:"",forceSync:!0}),l=P(!1),p=P(!0),d=P(""),g=P(!1),h=()=>{const a=z.getGithubConfig();r.value={...a},p.value=!!a.forceSync,d.value=a.syncQuizName||"",g.value=!!a.createRemoteRepo};X(()=>{w(),z.addListener("github",h)}),tt(()=>{z.removeListener("github",h)}),V(()=>s.currentQuiz,a=>{a!=null&&a.exists&&a.name&&!d.value&&(d.value=a.name)},{immediate:!0,deep:!0}),V(()=>s.show,a=>{a&&w()},{immediate:!0});const v=mt(()=>!!r.value.owner&&!!r.value.repo);function b(a){if(!a)return"未知来源";const u=a.toLowerCase();return n[u]||a||"未知来源"}function w(){const a=z.getGithubConfig();r.value={...a},p.value=!!a.forceSync,d.value=a.syncQuizName||"",g.value=!!a.createRemoteRepo}async function L(){if(!v.value){c("请填写必要的配置信息","error");return}l.value=!0;try{const{owner:a,repo:u,branch:Q,path:j,token:E}=r.value,y={};E&&(y.Authorization=`token ${E}`);const rt=`https://api.github.com/repos/${a}/${u}/contents/${j}?ref=${Q}`,M=await fetch(rt,{headers:y});if(!M.ok){const at=await M.json();throw new Error(`GitHub API错误 (${M.status}): ${at.message||"未知错误"}`)}const B=await M.json();Array.isArray(B)?c(`成功连接到仓库，发现 ${B.length} 个文件`,"success"):c("连接成功，但路径不是一个目录","warning")}catch(a){c(`连接失败: ${a.message}`,"error")}finally{l.value=!1}}function D(){f(),e("close")}function f(){if(!v.value)return;const a={...r.value,forceSync:p.value,syncQuizName:d.value,createRemoteRepo:g.value};z.updateGithubConfig(a),e("save",a)}async function o(){if(!v.value){c("请填写必要的配置信息","error");return}if(!d.value){c("请填写同步题库名称","error");return}l.value=!0;try{f(),await z.pushQuizToGithub(d.value,p.value)?(c(`成功推送题库: ${d.value}`,"success"),e("sync-complete",{action:"push",quiz:d.value,success:!0})):c("推送题库失败","error")}catch(a){c(`推送题库失败: ${a.message}`,"error")}finally{l.value=!1}}return(a,u)=>(A(),dt(F,{title:"仓库配置",show:m.show,onClose:u[9]||(u[9]=Q=>a.$emit("close"))},{footer:N(()=>[i("button",{class:"modal__button modal__button--secondary",onClick:u[8]||(u[8]=Q=>a.$emit("close"))},"取消"),i("button",{class:"modal__button modal__button--primary",onClick:D,disabled:!v.value},"保存配置",8,Bt)]),default:N(()=>{var Q,j,E;return[i("div",Ct,[u[12]||(u[12]=i("h3",{class:"modal__section-title"},"当前题库信息",-1)),(Q=m.currentQuiz)!=null&&Q.exists?(A(),q("div",$t,[i("div",Nt,[u[10]||(u[10]=i("span",{class:"modal__info-label"},"题库名称:",-1)),i("span",xt,I(m.currentQuiz.name||"未命名题库"),1)]),i("div",It,[u[11]||(u[11]=i("span",{class:"modal__info-label"},"来源类型:",-1)),i("span",kt,I(b(m.currentQuiz.source)),1)])])):(A(),q("div",Pt," 未处于刷题页面或未加载题库。 "))]),(j=m.currentQuiz)!=null&&j.exists?(A(),q("div",Ot,[i("div",Lt,[u[13]||(u[13]=i("label",{for:"syncQuizName",class:"modal__form-label"},"同步题库名称",-1)),u[14]||(u[14]=i("div",{class:"modal__form-description"},"推送到远程仓库时使用的文件名",-1)),S(i("input",{type:"text",id:"syncQuizName","onUpdate:modelValue":u[0]||(u[0]=y=>d.value=y),placeholder:"例如: my-quiz",class:"modal__form-control"},null,512),[[O,d.value]])]),m.currentQuiz.isLocal?(A(),q("div",Dt,[u[16]||(u[16]=i("label",{class:"modal__form-label"},"创建远程仓库版本",-1)),i("label",Qt,[S(i("input",{type:"checkbox","onUpdate:modelValue":u[1]||(u[1]=y=>g.value=y)},null,512),[[_,g.value]]),u[15]||(u[15]=i("span",{class:"modal__toggle-slider"},null,-1))])])):x("",!0),m.currentQuiz.isLocal?(A(),q("div",Et,"将本地题库推送到远程仓库，创建线上副本")):x("",!0)])):x("",!0),u[25]||(u[25]=i("div",{class:"modal__separator"},null,-1)),u[26]||(u[26]=i("h3",{class:"modal__section-title"},"GitHub 仓库设置",-1)),i("div",Tt,[u[17]||(u[17]=i("label",{for:"githubOwner",class:"modal__form-label"},"GitHub 用户名或组织",-1)),S(i("input",{type:"text",id:"githubOwner","onUpdate:modelValue":u[2]||(u[2]=y=>r.value.owner=y),placeholder:"例如: username",class:"modal__form-control"},null,512),[[O,r.value.owner]])]),i("div",jt,[u[18]||(u[18]=i("label",{for:"githubRepo",class:"modal__form-label"},"仓库名称",-1)),S(i("input",{type:"text",id:"githubRepo","onUpdate:modelValue":u[3]||(u[3]=y=>r.value.repo=y),placeholder:"例如: quiz-data",class:"modal__form-control"},null,512),[[O,r.value.repo]])]),i("div",Mt,[u[19]||(u[19]=i("label",{for:"githubBranch",class:"modal__form-label"},"分支名称",-1)),S(i("input",{type:"text",id:"githubBranch","onUpdate:modelValue":u[4]||(u[4]=y=>r.value.branch=y),placeholder:"例如: main",class:"modal__form-control"},null,512),[[O,r.value.branch]])]),i("div",Ft,[u[20]||(u[20]=i("label",{for:"githubPath",class:"modal__form-label"},"仓库路径 (可选)",-1)),S(i("input",{type:"text",id:"githubPath","onUpdate:modelValue":u[5]||(u[5]=y=>r.value.path=y),placeholder:"例如: quizzes/",class:"modal__form-control"},null,512),[[O,r.value.path]])]),i("div",Ut,[u[21]||(u[21]=i("label",{for:"githubToken",class:"modal__form-label"},"个人访问令牌 (PAT)",-1)),u[22]||(u[22]=i("div",{class:"modal__form-description"},"用于读写私有仓库或进行推送操作",-1)),S(i("input",{type:"password",id:"githubToken","onUpdate:modelValue":u[6]||(u[6]=y=>r.value.token=y),placeholder:"ghp_xxxxxx",class:"modal__form-control"},null,512),[[O,r.value.token]])]),i("div",Jt,[u[24]||(u[24]=i("label",{class:"modal__form-label"},"强制同步 (覆盖远程)",-1)),i("label",Gt,[S(i("input",{type:"checkbox","onUpdate:modelValue":u[7]||(u[7]=y=>p.value=y)},null,512),[[_,p.value]]),u[23]||(u[23]=i("span",{class:"modal__toggle-slider"},null,-1))])]),u[27]||(u[27]=i("div",{class:"modal__form-description"},"同步时不检查冲突，直接覆盖远程仓库内容",-1)),i("div",Rt,[i("button",{class:"modal__button modal__button--primary",onClick:L,disabled:l.value},I(l.value?"测试中...":"测试连接"),9,Vt),(E=m.currentQuiz)!=null&&E.exists?(A(),q("button",{key:0,class:"modal__button modal__button--success",onClick:o,disabled:l.value||!v.value},I(l.value?"推送中...":"推送到GitHub"),9,Wt)):x("",!0)])]}),_:1},8,["show"]))}}),Ht={class:"modal__settings-tabs"},Kt={key:0,class:"modal__tab-container"},Zt={class:"modal__settings-group"},Yt={class:"modal__setting-item"},Xt={class:"modal__toggle-switch"},te={class:"modal__setting-item"},ee={class:"modal__toggle-switch"},se={class:"modal__settings-group"},ie={class:"modal__setting-item"},ne={class:"modal__toggle-switch"},oe={class:"modal__setting-item"},re={class:"modal__toggle-switch"},ae={class:"modal__setting-item"},le={class:"modal__toggle-switch"},ue={class:"modal__setting-item"},ce={class:"modal__toggle-switch"},ge={class:"modal__settings-group"},me={class:"modal__setting-item"},de={class:"modal__toggle-switch"},pe={class:"modal__setting-item"},fe={class:"modal__toggle-switch"},he={class:"modal__settings-group"},Se={class:"modal__setting-item"},ve={class:"modal__toggle-switch"},ye={class:"modal__setting-item"},be={class:"modal__toggle-switch"},_e={key:1,class:"modal__tab-container"},ze={class:"modal__settings-group"},Ae={class:"modal__setting-item"},qe={class:"modal__form-input-group"},we={class:"modal__setting-item"},Ce=["value"],Pe={class:"modal__setting-item"},$e={class:"modal__toggle-switch"},Ne={class:"modal__settings-group"},xe={class:"modal__setting-item"},Ie={class:"modal__toggle-switch"},ke={class:"modal__body"},Oe={class:"modal__body"},Te=W({__name:"modal-settings",props:{show:{type:Boolean}},emits:["close","save"],setup(m,{emit:t}){const e=[{name:"系统默认 (sans-serif)",value:"sans-serif"},{name:"系统默认 (serif)",value:"serif"},{name:"系统默认 (monospace)",value:"monospace"},{name:"苹方 (PingFang SC)",value:"'PingFang SC', sans-serif"},{name:"微软雅黑 (Microsoft YaHei)",value:"'Microsoft YaHei', sans-serif"},{name:"思源黑体 (Noto Sans SC)",value:"'Noto Sans SC', sans-serif"},{name:"霞鹜文楷 (LXGW WenKai)",value:"'LXGW WenKai', cursive"},{name:"JetBrains Mono",value:"'JetBrains Mono', monospace"},{name:"Fira Code",value:"'Fira Code', monospace"},{name:"IBM Plex Sans",value:"'IBM Plex Sans', sans-serif"},{name:"Roboto Mono",value:"'Roboto Mono', monospace"},{name:"更纱黑体 (Sarasa Gothic)",value:"'Sarasa Gothic SC', sans-serif"}],s=m,n=t,r=P("quiz"),l=P(!1),p=P(!1),d=P(""),g=Y(JSON.parse(JSON.stringify(z.getSettings()))),h=()=>{Object.assign(g,JSON.parse(JSON.stringify(z.getSettings())))};X(()=>{z.addListener("settings",h)}),tt(()=>{z.removeListener("settings",h)}),V(()=>s.show,f=>{f&&Object.assign(g,JSON.parse(JSON.stringify(z.getSettings())))},{immediate:!0});function v(){z.updateSettings(JSON.parse(JSON.stringify(g))),n("save",JSON.parse(JSON.stringify(g))),n("close")}function b(){l.value=!0}function w(f){const o=f.target;!o.files||o.files.length}function L(){const f=document.getElementById("importFileInput");if(!f.files||f.files.length===0){c("请选择要导入的配置文件","warning");return}const o=f.files[0];z.importConfigFromFile(o).then(a=>{a&&(l.value=!1,setTimeout(()=>{window.location.reload()},1500))}).catch(a=>{c("导入配置失败："+a.message,"error")})}function D(){try{z.exportConfig(),p.value=!0,d.value=new Date().toISOString()}catch(f){console.error("导出配置失败:",f)}}return(f,o)=>(A(),q(K,null,[U(F,{show:f.show,title:"设置","content-class":"modal__content--settings",onClose:o[17]||(o[17]=a=>f.$emit("close"))},{footer:N(()=>[i("button",{onClick:o[16]||(o[16]=a=>f.$emit("close")),class:"modal__button modal__button--secondary"},"取消"),i("button",{onClick:v,class:"modal__button modal__button--primary"},"保存设置")]),default:N(()=>[i("div",Ht,[i("button",{class:R(["modal__settings-tab",{"modal__settings-tab--active":r.value==="quiz"}]),onClick:o[0]||(o[0]=a=>r.value="quiz")},"刷题设置",2),i("button",{class:R(["modal__settings-tab",{"modal__settings-tab--active":r.value==="general"}]),onClick:o[1]||(o[1]=a=>r.value="general")},"通用设置",2)]),r.value==="quiz"?(A(),q("div",Kt,[i("div",Zt,[o[26]||(o[26]=i("h3",{class:"modal__settings-group-title"},"模式",-1)),i("div",Yt,[o[23]||(o[23]=i("span",{class:"modal__setting-item-name"},"随机刷题",-1)),i("label",Xt,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=a=>g.quizSettings.randomMode=a)},null,512),[[_,g.quizSettings.randomMode]]),o[22]||(o[22]=i("span",{class:"modal__toggle-slider"},null,-1))])]),i("div",te,[o[25]||(o[25]=i("span",{class:"modal__setting-item-name"},"背题模式",-1)),i("label",ee,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[3]||(o[3]=a=>g.quizSettings.reviewMode=a)},null,512),[[_,g.quizSettings.reviewMode]]),o[24]||(o[24]=i("span",{class:"modal__toggle-slider"},null,-1))])])]),i("div",se,[o[35]||(o[35]=i("h3",{class:"modal__settings-group-title"},"交互",-1)),i("div",ie,[o[28]||(o[28]=i("span",{class:"modal__setting-item-name"},"选择后自动提交",-1)),i("label",ne,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=a=>g.quizSettings.autoSubmit=a)},null,512),[[_,g.quizSettings.autoSubmit]]),o[27]||(o[27]=i("span",{class:"modal__toggle-slider"},null,-1))])]),i("div",oe,[o[30]||(o[30]=i("span",{class:"modal__setting-item-name"},"提交后自动下一题",-1)),i("label",re,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[5]||(o[5]=a=>g.quizSettings.autoNext=a)},null,512),[[_,g.quizSettings.autoNext]]),o[29]||(o[29]=i("span",{class:"modal__toggle-slider"},null,-1))])]),i("div",ae,[o[32]||(o[32]=i("span",{class:"modal__setting-item-name"},"允许跳过未答题目",-1)),i("label",le,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=a=>g.quizSettings.allowSkip=a)},null,512),[[_,g.quizSettings.allowSkip]]),o[31]||(o[31]=i("span",{class:"modal__toggle-slider"},null,-1))])]),i("div",ue,[o[34]||(o[34]=i("span",{class:"modal__setting-item-name"},"滑动手势切换",-1)),i("label",ce,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=a=>g.quizSettings.swipeGestureEnabled=a)},null,512),[[_,g.quizSettings.swipeGestureEnabled]]),o[33]||(o[33]=i("span",{class:"modal__toggle-slider"},null,-1))])])]),i("div",ge,[o[40]||(o[40]=i("h3",{class:"modal__settings-group-title"},"显示",-1)),i("div",me,[o[37]||(o[37]=i("span",{class:"modal__setting-item-name"},"回答后显示笔记",-1)),i("label",de,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[8]||(o[8]=a=>g.quizSettings.showNotesAfterAnswer=a)},null,512),[[_,g.quizSettings.showNotesAfterAnswer]]),o[36]||(o[36]=i("span",{class:"modal__toggle-slider"},null,-1))])]),i("div",pe,[o[39]||(o[39]=i("span",{class:"modal__setting-item-name"},"显示进度条/正确率",-1)),i("label",fe,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[9]||(o[9]=a=>g.quizSettings.showProgress=a)},null,512),[[_,g.quizSettings.showProgress]]),o[38]||(o[38]=i("span",{class:"modal__toggle-slider"},null,-1))])])]),i("div",he,[o[45]||(o[45]=i("h3",{class:"modal__settings-group-title"},"答案行为",-1)),i("div",Se,[o[42]||(o[42]=i("span",{class:"modal__setting-item-name"},"提交后不允许更改",-1)),i("label",ve,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[10]||(o[10]=a=>g.quizSettings.lockAnswerAfterSubmit=a)},null,512),[[_,g.quizSettings.lockAnswerAfterSubmit]]),o[41]||(o[41]=i("span",{class:"modal__toggle-slider"},null,-1))])]),i("div",ye,[o[44]||(o[44]=i("span",{class:"modal__setting-item-name"},"提交后立即显示正确答案",-1)),i("label",be,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[11]||(o[11]=a=>g.quizSettings.showCorrectAnswerImmediately=a)},null,512),[[_,g.quizSettings.showCorrectAnswerImmediately]]),o[43]||(o[43]=i("span",{class:"modal__toggle-slider"},null,-1))])])])])):x("",!0),r.value==="general"?(A(),q("div",_e,[i("div",ze,[o[50]||(o[50]=i("h3",{class:"modal__settings-group-title"},"显示",-1)),i("div",Ae,[o[46]||(o[46]=i("span",{class:"modal__setting-item-name"},"字体大小",-1)),i("div",qe,[S(i("input",{type:"range","onUpdate:modelValue":o[12]||(o[12]=a=>g.uiSettings.fontSize=a),min:"12",max:"20",step:"1"},null,512),[[O,g.uiSettings.fontSize,void 0,{number:!0}]]),i("span",null,I(g.uiSettings.fontSize)+"px",1)])]),i("div",we,[o[47]||(o[47]=i("span",{class:"modal__setting-item-name"},"字体选择",-1)),S(i("select",{"onUpdate:modelValue":o[13]||(o[13]=a=>g.uiSettings.fontFamily=a),class:"modal__select-styled"},[(A(),q(K,null,pt(e,a=>i("option",{key:a.value,value:a.value},I(a.name),9,Ce)),64))],512),[[ft,g.uiSettings.fontFamily]])]),i("div",Pe,[o[49]||(o[49]=i("span",{class:"modal__setting-item-name"},"启用动画效果",-1)),i("label",$e,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[14]||(o[14]=a=>g.uiSettings.animationEnabled=a)},null,512),[[_,g.uiSettings.animationEnabled]]),o[48]||(o[48]=i("span",{class:"modal__toggle-slider"},null,-1))])])]),i("div",{class:"modal__settings-group"},[o[53]||(o[53]=i("h3",{class:"modal__settings-group-title"},"数据管理",-1)),i("div",{class:"modal__setting-item"},[o[51]||(o[51]=i("span",{class:"modal__setting-item-name"},"导出配置",-1)),i("button",{class:"modal__button modal__button--secondary",onClick:D}," 导出为JSON ")]),i("div",{class:"modal__setting-item"},[o[52]||(o[52]=i("span",{class:"modal__setting-item-name"},"导入配置",-1)),i("button",{class:"modal__button modal__button--secondary",onClick:b}," 选择文件导入 ")])]),i("div",Ne,[o[56]||(o[56]=i("h3",{class:"modal__settings-group-title"},"调试",-1)),i("div",xe,[o[55]||(o[55]=i("span",{class:"modal__setting-item-name"},"调试模式",-1)),i("label",Ie,[S(i("input",{type:"checkbox","onUpdate:modelValue":o[15]||(o[15]=a=>g.debugEnabled=a)},null,512),[[_,g.debugEnabled]]),o[54]||(o[54]=i("span",{class:"modal__toggle-slider"},null,-1))])])])])):x("",!0)]),_:1},8,["show"]),U(F,{show:l.value,title:"导入配置",onClose:o[19]||(o[19]=a=>l.value=!1)},{footer:N(()=>[i("button",{onClick:o[18]||(o[18]=a=>l.value=!1),class:"modal__button modal__button--secondary"},"取消"),i("button",{onClick:L,class:"modal__button modal__button--primary"},"导入")]),default:N(()=>[i("div",ke,[o[57]||(o[57]=i("p",null,"选择要导入的配置文件：",-1)),i("input",{type:"file",id:"importFileInput",accept:".json",onChange:w},null,32)])]),_:1},8,["show"]),U(F,{show:p.value,title:"导出成功",onClose:o[21]||(o[21]=a=>p.value=!1)},{footer:N(()=>[i("button",{onClick:o[20]||(o[20]=a=>p.value=!1),class:"modal__button modal__button--primary"},"关闭")]),default:N(()=>[i("div",Oe,[o[58]||(o[58]=i("p",null,"配置文件已成功导出为JSON文件。",-1)),i("p",null,"导出时间："+I(d.value),1)])]),_:1},8,["show"])],64))}});export{st as Q,F as _,yt as a,bt as b,z as c,Ee as d,Te as e,Qe as p};
